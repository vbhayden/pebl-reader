var globalPebl="object"==typeof globalPebl?globalPebl:{};globalPebl.extension=globalPebl.extension||{},globalPebl.extension.PeblExternalResourcesWidget=function(e){var t={};function r(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,o){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(r.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(o,a,function(t){return e[t]}.bind(null,a));return o},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/dist/",r(r.s=4)}([function(e,t){e.exports=Vue},function(e,t,r){var o=r(2);"string"==typeof o&&(o=[[e.i,o,""]]),o.locals&&(e.exports=o.locals);(0,r(5).default)("917b5598",o,!0,{})},function(e,t,r){(e.exports=r(3)(!1)).push([e.i,'.externalResourcesModal{position:fixed;top:10vh;left:0;right:0;min-height:400px;height:80vh;background-color:var(--background-light);z-index:5000;box-shadow:var(--boxshadow-2);max-width:700px;margin:0 auto;display:flex;flex-direction:column;-webkit-box-shadow:0 4px 5px 0 rgba(0,0,0,0.14),0 1px 10px 0 rgba(0,0,0,0.12),0 2px 4px -1px rgba(0,0,0,0.3);box-shadow:0 4px 5px 0 rgba(0,0,0,0.14),0 1px 10px 0 rgba(0,0,0,0.12),0 2px 4px -1px rgba(0,0,0,0.3)}.externalResourcesModalHeader{display:flex;background-color:var(--primary-color-light);justify-content:space-between;align-items:center;color:#fff;padding:1em;font-size:1rem;font-family:var(--font-family-secondary)}.externalResourcesModalCloseButton{width:1em;height:1em;font-size:1.5em;display:flex;align-items:center;justify-content:center;cursor:pointer}.externalResourcesModalBody{overflow:auto;padding:1em}.externalResourceIconWrapper{position:relative;float:left}.externalResourceIcon{position:relative;height:auto;width:20px;opacity:0.33}.responsive-wrapper{position:relative;height:100%;-webkit-overflow-scrolling:touch;overflow:auto}.dynamicPageHeader{position:fixed;width:100%;left:0;top:50px;background-color:var(--primary-color-light);color:white;height:50px}.dynamicPageHeaderLink{box-sizing:border-box;position:relative;left:1em;top:15px;width:80%;display:block;text-decoration:none;font-family:sans-serif;color:white;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;opacity:0.33}.dynamicPageHeaderLink:before{content:"Source: ";font-weight:bold}.dynamicPageHeaderLink:hover{opacity:1}.dynamicPage{position:fixed;width:100%;left:0;top:100px;z-index:5000;bottom:0;background-color:white;-webkit-box-shadow:rgba(0,0,0,0.137255) 0px 4px 5px 0px,rgba(0,0,0,0.117647) 0px 1px 10px 0px,rgba(0,0,0,0.298039) 0px 2px 4px -1px;box-shadow:rgba(0,0,0,0.137255) 0px 4px 5px 0px,rgba(0,0,0,0.117647) 0px 1px 10px 0px,rgba(0,0,0,0.298039) 0px 2px 4px -1px}.dynamicPageFrame{position:relative;height:99%;border:none;width:100%;margin:0}i.dynamicPageCloseButton{cursor:pointer;position:fixed;top:65px;right:20px;color:white;font-size:2em}.externalResourcesButton{background-color:var(--primary-color) !important;width:240px;margin-top:.5rem;padding:.5rem;font-weight:500;border:none;color:#fff !important;cursor:pointer;text-align:center}.externalResourcesButton:hover{background-color:var(--primary-color-dark) !important}.externalResource{cursor:pointer}.externalResource:hover{color:var(--secondary-color-light) !important}.externalResourcesAddResourceModal{position:fixed;top:10vh;left:0;right:0;background-color:var(--background-light);z-index:5000;box-shadow:var(--boxshadow-2);max-width:700px;margin:0 auto;display:flex;flex-direction:column;-webkit-box-shadow:0 4px 5px 0 rgba(0,0,0,0.14),0 1px 10px 0 rgba(0,0,0,0.12),0 2px 4px -1px rgba(0,0,0,0.3);box-shadow:0 4px 5px 0 rgba(0,0,0,0.14),0 1px 10px 0 rgba(0,0,0,0.12),0 2px 4px -1px rgba(0,0,0,0.3)}.externalResourcesAddResourceModalHeader{display:flex;background-color:var(--primary-color-light);justify-content:space-between;align-items:center;color:#fff;padding:1em;font-size:1rem;font-family:var(--font-family-secondary)}.externalResourcesAddResourceModalBody{padding:1em;font-family:var(--font-family-secondary);overflow:auto;-webkit-overflow-scrolling:touch}.externalResourcesAddResourceModalBody p{padding-bottom:1em;font-family:var(--font-family-secondary)}.externalResourcesAddResourceModalSuccess{display:none;overflow:auto;-webkit-overflow-scrolling:touch;padding:1em}.externalResourcesAddResourceModalCloseButton{width:1em;height:1em;font-size:1.5em;display:flex;align-items:center;justify-content:center;cursor:pointer}.AddResources_inputContainer{margin:1em 0}.AddResources_inputContainer input{box-sizing:border-box;padding:0.5em;margin:0.5em 0;width:100%}\n',""])},function(e,t){e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var r=function(e,t){var r=e[1]||"",o=e[3];if(!o)return r;if(t&&"function"==typeof btoa){var a=(i=o,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),n=o.sources.map((function(e){return"/*# sourceURL="+o.sourceRoot+e+" */"}));return[r].concat(n).concat([a]).join("\n")}var i;return[r].join("\n")}(t,e);return t[2]?"@media "+t[2]+"{"+r+"}":r})).join("")},t.i=function(e,r){"string"==typeof e&&(e=[[null,e,""]]);for(var o={},a=0;a<this.length;a++){var n=this[a][0];"number"==typeof n&&(o[n]=!0)}for(a=0;a<e.length;a++){var i=e[a];"number"==typeof i[0]&&o[i[0]]||(r&&!i[2]?i[2]=r:r&&(i[2]="("+i[2]+") and ("+r+")"),t.push(i))}},t}},function(e,t,r){"use strict";r.r(t),r.d(t,"insertExtensions",(function(){return u})),r.d(t,"createExternalResourcesButton",(function(){return p})),r.d(t,"createDynamicPage",(function(){return g})),r.d(t,"createExternalResourcesModal",(function(){return f}));r(1);var o=r(0),a=r.n(o);function n(e,t,r,o,a,n,i,s){var l=typeof(e=e||{}).default;"object"!==l&&"function"!==l||(e=e.default);var d,c="function"==typeof e?e.options:e;if(t&&(c.render=t,c.staticRenderFns=r,c._compiled=!0),o&&(c.functional=!0),n&&(c._scopeId=n),i?(d=function(e){(e=e||this.$vnode&&this.$vnode.ssrContext||this.parent&&this.parent.$vnode&&this.parent.$vnode.ssrContext)||"undefined"==typeof __VUE_SSR_CONTEXT__||(e=__VUE_SSR_CONTEXT__),a&&a.call(this,e),e&&e._registeredComponents&&e._registeredComponents.add(i)},c._ssrRegister=d):a&&(d=s?function(){a.call(this,this.$root.$options.shadowRoot)}:a),d)if(c.functional){c._injectStyles=d;var u=c.render;c.render=function(e,t){return d.call(t),u(e,t)}}else{var p=c.beforeCreate;c.beforeCreate=p?[].concat(p,d):[d]}return{exports:e,options:c}}var i=n(a.a.extend({name:"DynamicPage",props:["globalPebl","globalReadium","dynamicPageTitle","dynamicPageUrl","hideSource"],mounted(){},computed:{},data:()=>({}),methods:{closeDynamicPage:function(){this.$emit("closeDynamicPage"),jQuery("#dynamicPageWrapper").remove(),this.$destroy()}}}),(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{attrs:{id:"dynamicPageWrapper"}},[r("div",{staticClass:"dynamicPageHeader",attrs:{id:"dynamicPageHeader"}},[e.hideSource?e._e():r("a",{staticClass:"dynamicPageHeaderLink",attrs:{id:"dynamicPageHeaderLink",href:e.dynamicPageUrl}},[e._v(e._s(e.dynamicPageUrl))])]),e._v(" "),r("div",{staticClass:"dynamicPage",attrs:{id:"dynamicPage","resource-id":e.dynamicPageUrl,title:e.dynamicPageTitle}},[r("div",{staticClass:"responsive-wrapper"},[r("iframe",{staticClass:"dynamicPageFrame",attrs:{id:"dynamicPageFrame",src:e.dynamicPageUrl}})])]),e._v(" "),r("i",{staticClass:"dynamicPageCloseButton fa fa-times",attrs:{id:"dynamicPageCloseButton"},on:{click:e.closeDynamicPage}})])}),[],!1,null,null,null).exports,s=n(a.a.extend({name:"Popup",props:["globalPebl","globalReadium","insertID","resources","showAllResources","enablePulling"],components:{DynamicPage:i},mounted(){this.globalPebl.emitEvent(this.globalPebl.events.eventDisplayed,{type:"resource",activityType:"external-resources",activityId:this.insertID}),this.getAdditionalResources(),this.globalPebl.subscribeSingularEvent(this.globalPebl.events.updatedToc,"externalResources",!1,()=>{this.getAdditionalResources()}),setTimeout((function(){$(".externalResourcesModalBody").attr("style","transform: translate3d(0px, 0px, 0px);")}),1e3)},computed:{allResources:function(){return this.resources.concat(this.additionalResources)}},data:()=>({brTag:"<br/>",additionalResources:[],addResourceModal:!1,addResourceSuccess:!1,dynamicPage:!1,addResourceTitle:"",addResourceUrl:"",hideSource:!1,dynamicPageUrl:"",dynamicPageTitle:""}),methods:{showAddResourceModal:function(){this.addResourceModal=!0,this.addResourceSuccess=!1,this.addResourceTitle="",this.addResourceUrl=""},closeAddResourceModal:function(){this.addResourceModal=!1},addResource:function(){this.globalPebl.user.getUser(e=>{var t=this.addResourceUrl,r=this.addResourceTitle;t.trim().length>0&&r.trim().length>0&&e?(t.match(/^http?:\/\//i)||t.match(/^https?:\/\//i)||(t="https://"+t),this.pullResource(e.identity,t,"html",r,this.insertID),this.addResourceSuccess=!0):window.alert("Please fill out both fields.")})},pullResource:function(e,t,r,o,a){this.globalPebl.storage.getCurrentBook(n=>{var i={target:e,location:"Section1",card:a,book:n,externalURL:t,docType:r,name:o,url:t,activityType:"external-resources"};this.globalPebl.emitEvent(this.globalPebl.events.newReference,i)})},closeExternalResourcesModal:function(){jQuery("#externalResourcesModal").remove(),this.globalPebl.emitEvent(this.globalPebl.events.eventUndisplayed,{type:"resource",activityType:"external-resources",activityId:this.insertID})},handleResourceClick:function(e,t){e.preventDefault(),t.url&&(this.globalPebl.emitEvent(this.globalPebl.events.eventAccessed,{name:t.title,type:"resource",description:t.url,activityType:"external-resources",activityId:this.insertID}),t.externalOnly?window.open(t.url,"_blank"):this.createDynamicPage(t.url,t.title))},createDynamicPage:function(e,t){this.closeDynamicPage(),this.dynamicPage=!0,this.dynamicPageTitle=t,this.dynamicPageUrl=e},closeDynamicPage:function(){this.dynamicPage=!1,this.dynamicPageUrl="",this.dynamicPageTitle=""},getAdditionalResources:function(){this.additionalResources=[],this.globalPebl.utils.getToc(e=>{if(e&&e.Section1)for(var t in e.Section1){var r=e.Section1[t];if(r.externalURL&&r.documentName&&(r.card===this.insertID||this.showAllResources)){var o={url:r.externalURL,title:r.documentName,id:r.pageKey,additionalResource:!0,enabled:!0};this.additionalResources.push(o)}}})}}}),(function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"externalResourcesModal peblModal",attrs:{id:"externalResourcesModal","data-theme-target":e.insertID}},[r("div",{staticClass:"externalResourcesModalHeader"},[r("span",[e._v("External Resources")]),e._v(" "),r("i",{staticClass:"fa fa-times externalResourcesModalCloseButton",on:{click:e.closeExternalResourcesModal}})]),e._v(" "),r("div",{staticClass:"externalResourcesModalBody"},[e._l(e.allResources,(function(t){return[t.enabled||e.showAllResources?r("div",{key:t,staticClass:"externalResource",class:{additionalResource:t.additionalResource},attrs:{"data-url":t.url},on:{click:function(r){return e.handleResourceClick(r,t)}}},[r("span",[e._v(e._s(t.title))]),e._v(" "),e._m(0,!0)]):e._e()]}))],2),e._v(" "),r("button",{on:{click:e.showAddResourceModal}},[e._v("Add a Resource to Your E-Book")]),e._v(" "),e.addResourceModal?r("div",{staticClass:"externalResourcesAddResourceModal peblModal",attrs:{id:"externalResourcesAddResourceModal"}},[r("div",{staticClass:"externalResourcesAddResourceModalHeader"},[r("span",{staticClass:"externalResourcesAddResourceModalHeaderText"},[e._v("Add Resource")]),e._v(" "),r("i",{staticClass:"externalResourcesAddResourceModalCloseButton fa fa-times",on:{click:e.closeAddResourceModal}})]),e._v(" "),e.addResourceSuccess?e._e():r("div",{staticClass:"externalResourcesAddResourceModalBody"},[r("p",{staticClass:"externalResourcesAddResourceModalDescription"},[e._v("Enter a title and URL below to add a resource to your Additional Resources. Your resource will be added to the list based on your current place in the book.")]),e._v(" "),r("div",{staticClass:"AddResources_inputContainer"},[r("label",{attrs:{for:"externalResourcesAddResourceTitle"}},[e._v("Resource Title: ")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.addResourceTitle,expression:"addResourceTitle"}],attrs:{id:"externalResourcesAddResourceTitle"},domProps:{value:e.addResourceTitle},on:{input:function(t){t.target.composing||(e.addResourceTitle=t.target.value)}}})]),e._v(" "),r("div",{staticClass:"AddResources_inputContainer"},[r("label",{attrs:{for:"externalResourcesAddResourceUrl"}},[e._v("Resource URL: ")]),e._v(" "),r("input",{directives:[{name:"model",rawName:"v-model",value:e.addResourceUrl,expression:"addResourceUrl"}],attrs:{id:"externalResourcesAddResourceUrl"},domProps:{value:e.addResourceUrl},on:{input:function(t){t.target.composing||(e.addResourceUrl=t.target.value)}}})]),e._v(" "),r("button",{on:{click:e.addResource}},[e._v("Add Resource")])]),e._v(" "),e.addResourceSuccess?r("div",{staticClass:"externalResourcesAddResourceModalSuccess"},[r("p",[e._v("Your resource will be added to your Additional Resources shortly.")]),e._v(" "),r("button",{on:{click:e.showAddResourceModal}},[e._v("Add Another Resource")])]):e._e()]):e._e(),e._v(" "),e.dynamicPage?r("DynamicPage",{attrs:{globalPebl:e.globalPebl,globalReadium:e.globalReadium,dynamicPageTitle:e.dynamicPageTitle,dynamicPageUrl:e.dynamicPageUrl,hideSource:e.hideSource},on:{closeDynamicPage:e.closeDynamicPage}}):e._e()],1)}),[function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"externalResourceIconWrapper"},[t("i",{staticClass:"externalResourceIcon fa fa-external-link-square-alt"})])}],!1,null,null,null).exports,l=n(a.a.extend({name:"Widget",props:["globalPebl","globalReadium","insertID","buttonText","resources","enablePulling","propertiesObject"],mounted(){},computed:{},data:()=>({brTag:"<br/>"}),methods:{createExternalResourcesModal:function(){jQuery(".peblModal").remove();let e=this.globalPebl.utils.getUuid(),t=document.createElement("div");t.id=e,document.body.appendChild(t),new a.a({el:'[id="'+e+'"]',render:e=>e(s,{props:{globalPebl:this.globalPebl,globalReadium:this.globalReadium,insertID:this.insertID,resources:this.resources,showAllResources:!1,enablePulling:this.enablePulling}})})}}}),(function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{"data-theme-target":this.insertID,contenteditable:"false","data-propertiesobject":this.propertiesObject}},[t("button",{staticClass:"externalResourcesButton",on:{click:this.createExternalResourcesModal}},[this._v(this._s(this.buttonText))])])}),[],!1,null,null,null).exports,d=window.parent&&window.parent.PeBL?window.parent.PeBL:window.PeBL?window.PeBL:null,c=window.parent.READIUM;function u(){jQuery('.peblExtension[data-peblextension="externalResources"], .peblExtension[data-peblExtension="externalResources"]').each((function(){var e=this.getAttribute("id");p('[id="'+e+'"]',e,this.getAttribute("data-buttonText")||this.getAttribute("data-buttontext"),JSON.parse(this.getAttribute("data-externalResources")||this.getAttribute("data-externalresources")),this.getAttribute("data-enablePulling")||this.getAttribute("data-enablepulling"),this.hasAttribute("data-propertiesobject")?this.getAttribute("data-propertiesobject"):void 0)}))}function p(e,t,r,o,n,i){new a.a({el:e,render:e=>e(l,{props:{globalPebl:d,globalReadium:c,insertID:t,buttonText:r,resources:o,enablePulling:n,propertiesObject:i}})})}function g(e,t,r){let o=d.utils.getUuid(),n=document.createElement("div");n.id=o,document.body.appendChild(n),new a.a({el:'[id="'+o+'"]',render:o=>o(i,{props:{globalPebl:d,globalReadium:c,dynamicPageTitle:t,dynamicPageUrl:e,hideSource:r}})}).$on("closeDynamicPage",()=>{})}function f(e,t,r){jQuery(".peblModal").remove();let o=d.utils.getUuid(),n=document.createElement("div");n.id=o,document.body.appendChild(n),new a.a({el:'[id="'+o+'"]',render:o=>o(s,{props:{globalPebl:d,globalReadium:c,insertID:t,resources:e,showAllResources:!0,enablePulling:r}})})}jQuery(document).ready(()=>{window.parent.PeBLConfig&&window.parent.PeBLConfig.isAuthoring?document.addEventListener("pebleditorready",()=>{u()}):u(),d.subscribeSingularEvent(d.events.eventNextPage,"externalResources",!1,(function(){jQuery(".peblModal").remove()})),d.subscribeSingularEvent(d.events.eventPrevPage,"externalResources",!1,(function(){jQuery(".peblModal").remove()}))}),jQuery(document).mouseup(e=>{var t=jQuery(".peblModal");t.is(e.target)||0!==t.has(e.target).length||t.remove()})},function(e,t,r){"use strict";function o(e,t){for(var r=[],o={},a=0;a<t.length;a++){var n=t[a],i=n[0],s={id:e+":"+a,css:n[1],media:n[2],sourceMap:n[3]};o[i]?o[i].parts.push(s):r.push(o[i]={id:i,parts:[s]})}return r}r.r(t),r.d(t,"default",(function(){return g}));var a="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!a)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var n={},i=a&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,d=!1,c=function(){},u=null,p="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function g(e,t,r,a){d=r,u=a||{};var i=o(e,t);return f(i),function(t){for(var r=[],a=0;a<i.length;a++){var s=i[a];(l=n[s.id]).refs--,r.push(l)}t?f(i=o(e,t)):i=[];for(a=0;a<r.length;a++){var l;if(0===(l=r[a]).refs){for(var d=0;d<l.parts.length;d++)l.parts[d]();delete n[l.id]}}}}function f(e){for(var t=0;t<e.length;t++){var r=e[t],o=n[r.id];if(o){o.refs++;for(var a=0;a<o.parts.length;a++)o.parts[a](r.parts[a]);for(;a<r.parts.length;a++)o.parts.push(b(r.parts[a]));o.parts.length>r.parts.length&&(o.parts.length=r.parts.length)}else{var i=[];for(a=0;a<r.parts.length;a++)i.push(b(r.parts[a]));n[r.id]={id:r.id,refs:1,parts:i}}}}function m(){var e=document.createElement("style");return e.type="text/css",i.appendChild(e),e}function b(e){var t,r,o=document.querySelector('style[data-vue-ssr-id~="'+e.id+'"]');if(o){if(d)return c;o.parentNode.removeChild(o)}if(p){var a=l++;o=s||(s=m()),t=v.bind(null,o,a,!1),r=v.bind(null,o,a,!0)}else o=m(),t=y.bind(null,o),r=function(){o.parentNode.removeChild(o)};return t(e),function(o){if(o){if(o.css===e.css&&o.media===e.media&&o.sourceMap===e.sourceMap)return;t(e=o)}else r()}}var h,x=(h=[],function(e,t){return h[e]=t,h.filter(Boolean).join("\n")});function v(e,t,r,o){var a=r?"":o.css;if(e.styleSheet)e.styleSheet.cssText=x(t,a);else{var n=document.createTextNode(a),i=e.childNodes;i[t]&&e.removeChild(i[t]),i.length?e.insertBefore(n,i[t]):e.appendChild(n)}}function y(e,t){var r=t.css,o=t.media,a=t.sourceMap;if(o&&e.setAttribute("media",o),u.ssrId&&e.setAttribute("data-vue-ssr-id",t.id),a&&(r+="\n/*# sourceURL="+a.sources[0]+" */",r+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(a))))+" */"),e.styleSheet)e.styleSheet.cssText=r;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(r))}}}]);