!function(e){var t={};function i(n){if(t[n])return t[n].exports;var s=t[n]={i:n,l:!1,exports:{}};return e[n].call(s.exports,s,s.exports,i),s.l=!0,s.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(n,s,function(t){return e[t]}.bind(null,s));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=19)}([function(e,t,i){"use strict";var n="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;function s(e,t){return Object.prototype.hasOwnProperty.call(e,t)}t.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var i=t.shift();if(i){if("object"!=typeof i)throw new TypeError(i+"must be non-object");for(var n in i)s(i,n)&&(e[n]=i[n])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var o={arraySet:function(e,t,i,n,s){if(t.subarray&&e.subarray)e.set(t.subarray(i,i+n),s);else for(var o=0;o<n;o++)e[s+o]=t[i+o]},flattenChunks:function(e){var t,i,n,s,o,a;for(n=0,t=0,i=e.length;t<i;t++)n+=e[t].length;for(a=new Uint8Array(n),s=0,t=0,i=e.length;t<i;t++)o=e[t],a.set(o,s),s+=o.length;return a}},a={arraySet:function(e,t,i,n,s){for(var o=0;o<n;o++)e[s+o]=t[i+o]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,o)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,a))},t.setTyped(n)},function(e,t,i){"use strict";e.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(e,t,i){"use strict";e.exports=function(e,t,i,n){for(var s=65535&e|0,o=e>>>16&65535|0,a=0;0!==i;){i-=a=i>2e3?2e3:i;do{o=o+(s=s+t[n++]|0)|0}while(--a);s%=65521,o%=65521}return s|o<<16|0}},function(e,t,i){"use strict";var n=function(){for(var e,t=[],i=0;i<256;i++){e=i;for(var n=0;n<8;n++)e=1&e?3988292384^e>>>1:e>>>1;t[i]=e}return t}();e.exports=function(e,t,i,s){var o=n,a=s+i;e^=-1;for(var r=s;r<a;r++)e=e>>>8^o[255&(e^t[r])];return-1^e}},function(e,t,i){"use strict";var n=i(0),s=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){s=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new n.Buf8(256),r=0;r<256;r++)a[r]=r>=252?6:r>=248?5:r>=240?4:r>=224?3:r>=192?2:1;function d(e,t){if(t<65534&&(e.subarray&&o||!e.subarray&&s))return String.fromCharCode.apply(null,n.shrinkBuf(e,t));for(var i="",a=0;a<t;a++)i+=String.fromCharCode(e[a]);return i}a[254]=a[254]=1,t.string2buf=function(e){var t,i,s,o,a,r=e.length,d=0;for(o=0;o<r;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<r&&56320==(64512&(s=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(s-56320),o++),d+=i<128?1:i<2048?2:i<65536?3:4;for(t=new n.Buf8(d),a=0,o=0;a<d;o++)55296==(64512&(i=e.charCodeAt(o)))&&o+1<r&&56320==(64512&(s=e.charCodeAt(o+1)))&&(i=65536+(i-55296<<10)+(s-56320),o++),i<128?t[a++]=i:i<2048?(t[a++]=192|i>>>6,t[a++]=128|63&i):i<65536?(t[a++]=224|i>>>12,t[a++]=128|i>>>6&63,t[a++]=128|63&i):(t[a++]=240|i>>>18,t[a++]=128|i>>>12&63,t[a++]=128|i>>>6&63,t[a++]=128|63&i);return t},t.buf2binstring=function(e){return d(e,e.length)},t.binstring2buf=function(e){for(var t=new n.Buf8(e.length),i=0,s=t.length;i<s;i++)t[i]=e.charCodeAt(i);return t},t.buf2string=function(e,t){var i,n,s,o,r=t||e.length,l=new Array(2*r);for(n=0,i=0;i<r;)if((s=e[i++])<128)l[n++]=s;else if((o=a[s])>4)l[n++]=65533,i+=o-1;else{for(s&=2===o?31:3===o?15:7;o>1&&i<r;)s=s<<6|63&e[i++],o--;o>1?l[n++]=65533:s<65536?l[n++]=s:(s-=65536,l[n++]=55296|s>>10&1023,l[n++]=56320|1023&s)}return d(l,n)},t.utf8border=function(e,t){var i;for((t=t||e.length)>e.length&&(t=e.length),i=t-1;i>=0&&128==(192&e[i]);)i--;return i<0?t:0===i?t:i+a[e[i]]>t?i:t}},function(e,t,i){"use strict";e.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},function(e,t,i){"use strict";e.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(e,t,i){"use strict";var n={};(0,i(0).assign)(n,i(8),i(11),i(6)),e.exports=n},function(e,t,i){"use strict";var n=i(9),s=i(0),o=i(4),a=i(1),r=i(5),d=Object.prototype.toString,l=0,c=-1,p=0,u=8;function h(e){if(!(this instanceof h))return new h(e);this.options=s.assign({level:c,method:u,chunkSize:16384,windowBits:15,memLevel:8,strategy:p,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new r,this.strm.avail_out=0;var i=n.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(i!==l)throw new Error(a[i]);if(t.header&&n.deflateSetHeader(this.strm,t.header),t.dictionary){var g;if(g="string"==typeof t.dictionary?o.string2buf(t.dictionary):"[object ArrayBuffer]"===d.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,(i=n.deflateSetDictionary(this.strm,g))!==l)throw new Error(a[i]);this._dict_set=!0}}function g(e,t){var i=new h(t);if(i.push(e,!0),i.err)throw i.msg||a[i.err];return i.result}h.prototype.push=function(e,t){var i,a,r=this.strm,c=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?4:0,"string"==typeof e?r.input=o.string2buf(e):"[object ArrayBuffer]"===d.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new s.Buf8(c),r.next_out=0,r.avail_out=c),1!==(i=n.deflate(r,a))&&i!==l)return this.onEnd(i),this.ended=!0,!1;0!==r.avail_out&&(0!==r.avail_in||4!==a&&2!==a)||("string"===this.options.to?this.onData(o.buf2binstring(s.shrinkBuf(r.output,r.next_out))):this.onData(s.shrinkBuf(r.output,r.next_out)))}while((r.avail_in>0||0===r.avail_out)&&1!==i);return 4===a?(i=n.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===l):2!==a||(this.onEnd(l),r.avail_out=0,!0)},h.prototype.onData=function(e){this.chunks.push(e)},h.prototype.onEnd=function(e){e===l&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Deflate=h,t.deflate=g,t.deflateRaw=function(e,t){return(t=t||{}).raw=!0,g(e,t)},t.gzip=function(e,t){return(t=t||{}).gzip=!0,g(e,t)}},function(e,t,i){"use strict";var n,s=i(0),o=i(10),a=i(2),r=i(3),d=i(1),l=0,c=1,p=3,u=4,h=5,g=0,b=1,v=-2,f=-3,m=-5,y=-1,x=1,w=2,A=3,k=4,_=0,G=2,T=8,S=9,E=15,C=8,I=286,P=30,O=19,j=2*I+1,B=15,U=3,R=258,M=R+U+1,N=32,D=42,z=69,L=73,V=91,q=103,X=113,F=666,H=1,Q=2,K=3,J=4,Z=3;function W(e,t){return e.msg=d[t],t}function $(e){return(e<<1)-(e>4?9:0)}function Y(e){for(var t=e.length;--t>=0;)e[t]=0}function ee(e){var t=e.state,i=t.pending;i>e.avail_out&&(i=e.avail_out),0!==i&&(s.arraySet(e.output,t.pending_buf,t.pending_out,i,e.next_out),e.next_out+=i,t.pending_out+=i,e.total_out+=i,e.avail_out-=i,t.pending-=i,0===t.pending&&(t.pending_out=0))}function te(e,t){o._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,ee(e.strm)}function ie(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function se(e,t,i,n){var o=e.avail_in;return o>n&&(o=n),0===o?0:(e.avail_in-=o,s.arraySet(t,e.input,e.next_in,o,i),1===e.state.wrap?e.adler=a(e.adler,t,o,i):2===e.state.wrap&&(e.adler=r(e.adler,t,o,i)),e.next_in+=o,e.total_in+=o,o)}function oe(e,t){var i,n,s=e.max_chain_length,o=e.strstart,a=e.prev_length,r=e.nice_match,d=e.strstart>e.w_size-M?e.strstart-(e.w_size-M):0,l=e.window,c=e.w_mask,p=e.prev,u=e.strstart+R,h=l[o+a-1],g=l[o+a];e.prev_length>=e.good_match&&(s>>=2),r>e.lookahead&&(r=e.lookahead);do{if(l[(i=t)+a]===g&&l[i+a-1]===h&&l[i]===l[o]&&l[++i]===l[o+1]){o+=2,i++;do{}while(l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&l[++o]===l[++i]&&o<u);if(n=R-(u-o),o=u-R,n>a){if(e.match_start=t,a=n,n>=r)break;h=l[o+a-1],g=l[o+a]}}}while((t=p[t&c])>d&&0!=--s);return a<=e.lookahead?a:e.lookahead}function ae(e){var t,i,n,o,a,r=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-M)){s.arraySet(e.window,e.window,r,r,0),e.match_start-=r,e.strstart-=r,e.block_start-=r,t=i=e.hash_size;do{n=e.head[--t],e.head[t]=n>=r?n-r:0}while(--i);t=i=r;do{n=e.prev[--t],e.prev[t]=n>=r?n-r:0}while(--i);o+=r}if(0===e.strm.avail_in)break;if(i=se(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=i,e.lookahead+e.insert>=U)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+U-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<U)););}while(e.lookahead<M&&0!==e.strm.avail_in)}function re(e,t){for(var i,n;;){if(e.lookahead<M){if(ae(e),e.lookahead<M&&t===l)return H;if(0===e.lookahead)break}if(i=0,e.lookahead>=U&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==i&&e.strstart-i<=e.w_size-M&&(e.match_length=oe(e,i)),e.match_length>=U)if(n=o._tr_tally(e,e.strstart-e.match_start,e.match_length-U),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=U){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else n=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(n&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=e.strstart<U-1?e.strstart:U-1,t===u?(te(e,!0),0===e.strm.avail_out?K:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Q}function de(e,t){for(var i,n,s;;){if(e.lookahead<M){if(ae(e),e.lookahead<M&&t===l)return H;if(0===e.lookahead)break}if(i=0,e.lookahead>=U&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=U-1,0!==i&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-M&&(e.match_length=oe(e,i),e.match_length<=5&&(e.strategy===x||e.match_length===U&&e.strstart-e.match_start>4096)&&(e.match_length=U-1)),e.prev_length>=U&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-U,n=o._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-U),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+U-1])&e.hash_mask,i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=U-1,e.strstart++,n&&(te(e,!1),0===e.strm.avail_out))return H}else if(e.match_available){if((n=o._tr_tally(e,0,e.window[e.strstart-1]))&&te(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return H}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(n=o._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<U-1?e.strstart:U-1,t===u?(te(e,!0),0===e.strm.avail_out?K:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Q}function le(e,t,i,n,s){this.good_length=e,this.max_lazy=t,this.nice_length=i,this.max_chain=n,this.func=s}function ce(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=G,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?D:X,e.adler=2===t.wrap?0:1,t.last_flush=l,o._tr_init(t),g):W(e,v)}function pe(e){var t=ce(e);return t===g&&function(e){e.window_size=2*e.w_size,Y(e.head),e.max_lazy_match=n[e.level].max_lazy,e.good_match=n[e.level].good_length,e.nice_match=n[e.level].nice_length,e.max_chain_length=n[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=U-1,e.match_available=0,e.ins_h=0}(e.state),t}function ue(e,t,i,n,o,a){if(!e)return v;var r=1;if(t===y&&(t=6),n<0?(r=0,n=-n):n>15&&(r=2,n-=16),o<1||o>S||i!==T||n<8||n>15||t<0||t>9||a<0||a>k)return W(e,v);8===n&&(n=9);var d=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=T,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new s.Buf16(2*j),this.dyn_dtree=new s.Buf16(2*(2*P+1)),this.bl_tree=new s.Buf16(2*(2*O+1)),Y(this.dyn_ltree),Y(this.dyn_dtree),Y(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new s.Buf16(B+1),this.heap=new s.Buf16(2*I+1),Y(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new s.Buf16(2*I+1),Y(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return e.state=d,d.strm=e,d.wrap=r,d.gzhead=null,d.w_bits=n,d.w_size=1<<d.w_bits,d.w_mask=d.w_size-1,d.hash_bits=o+7,d.hash_size=1<<d.hash_bits,d.hash_mask=d.hash_size-1,d.hash_shift=~~((d.hash_bits+U-1)/U),d.window=new s.Buf8(2*d.w_size),d.head=new s.Buf16(d.hash_size),d.prev=new s.Buf16(d.w_size),d.lit_bufsize=1<<o+6,d.pending_buf_size=4*d.lit_bufsize,d.pending_buf=new s.Buf8(d.pending_buf_size),d.d_buf=1*d.lit_bufsize,d.l_buf=3*d.lit_bufsize,d.level=t,d.strategy=a,d.method=i,pe(e)}n=[new le(0,0,0,0,function(e,t){var i=65535;for(i>e.pending_buf_size-5&&(i=e.pending_buf_size-5);;){if(e.lookahead<=1){if(ae(e),0===e.lookahead&&t===l)return H;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var n=e.block_start+i;if((0===e.strstart||e.strstart>=n)&&(e.lookahead=e.strstart-n,e.strstart=n,te(e,!1),0===e.strm.avail_out))return H;if(e.strstart-e.block_start>=e.w_size-M&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:J):(e.strstart>e.block_start&&(te(e,!1),e.strm.avail_out),H)}),new le(4,4,8,4,re),new le(4,5,16,8,re),new le(4,6,32,32,re),new le(4,4,16,16,de),new le(8,16,32,32,de),new le(8,16,128,128,de),new le(8,32,128,256,de),new le(32,128,258,1024,de),new le(32,258,258,4096,de)],t.deflateInit=function(e,t){return ue(e,t,T,E,C,_)},t.deflateInit2=ue,t.deflateReset=pe,t.deflateResetKeep=ce,t.deflateSetHeader=function(e,t){return e&&e.state?2!==e.state.wrap?v:(e.state.gzhead=t,g):v},t.deflate=function(e,t){var i,s,a,d;if(!e||!e.state||t>h||t<0)return e?W(e,v):v;if(s=e.state,!e.output||!e.input&&0!==e.avail_in||s.status===F&&t!==u)return W(e,0===e.avail_out?m:v);if(s.strm=e,i=s.last_flush,s.last_flush=t,s.status===D)if(2===s.wrap)e.adler=0,ie(s,31),ie(s,139),ie(s,8),s.gzhead?(ie(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),ie(s,255&s.gzhead.time),ie(s,s.gzhead.time>>8&255),ie(s,s.gzhead.time>>16&255),ie(s,s.gzhead.time>>24&255),ie(s,9===s.level?2:s.strategy>=w||s.level<2?4:0),ie(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(ie(s,255&s.gzhead.extra.length),ie(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=r(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=z):(ie(s,0),ie(s,0),ie(s,0),ie(s,0),ie(s,0),ie(s,9===s.level?2:s.strategy>=w||s.level<2?4:0),ie(s,Z),s.status=X);else{var f=T+(s.w_bits-8<<4)<<8;f|=(s.strategy>=w||s.level<2?0:s.level<6?1:6===s.level?2:3)<<6,0!==s.strstart&&(f|=N),f+=31-f%31,s.status=X,ne(s,f),0!==s.strstart&&(ne(s,e.adler>>>16),ne(s,65535&e.adler)),e.adler=1}if(s.status===z)if(s.gzhead.extra){for(a=s.pending;s.gzindex<(65535&s.gzhead.extra.length)&&(s.pending!==s.pending_buf_size||(s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),ee(e),a=s.pending,s.pending!==s.pending_buf_size));)ie(s,255&s.gzhead.extra[s.gzindex]),s.gzindex++;s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),s.gzindex===s.gzhead.extra.length&&(s.gzindex=0,s.status=L)}else s.status=L;if(s.status===L)if(s.gzhead.name){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),ee(e),a=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,ie(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),0===d&&(s.gzindex=0,s.status=V)}else s.status=V;if(s.status===V)if(s.gzhead.comment){a=s.pending;do{if(s.pending===s.pending_buf_size&&(s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),ee(e),a=s.pending,s.pending===s.pending_buf_size)){d=1;break}d=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,ie(s,d)}while(0!==d);s.gzhead.hcrc&&s.pending>a&&(e.adler=r(e.adler,s.pending_buf,s.pending-a,a)),0===d&&(s.status=q)}else s.status=q;if(s.status===q&&(s.gzhead.hcrc?(s.pending+2>s.pending_buf_size&&ee(e),s.pending+2<=s.pending_buf_size&&(ie(s,255&e.adler),ie(s,e.adler>>8&255),e.adler=0,s.status=X)):s.status=X),0!==s.pending){if(ee(e),0===e.avail_out)return s.last_flush=-1,g}else if(0===e.avail_in&&$(t)<=$(i)&&t!==u)return W(e,m);if(s.status===F&&0!==e.avail_in)return W(e,m);if(0!==e.avail_in||0!==s.lookahead||t!==l&&s.status!==F){var y=s.strategy===w?function(e,t){for(var i;;){if(0===e.lookahead&&(ae(e),0===e.lookahead)){if(t===l)return H;break}if(e.match_length=0,i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,i&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Q}(s,t):s.strategy===A?function(e,t){for(var i,n,s,a,r=e.window;;){if(e.lookahead<=R){if(ae(e),e.lookahead<=R&&t===l)return H;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=U&&e.strstart>0&&(n=r[s=e.strstart-1])===r[++s]&&n===r[++s]&&n===r[++s]){a=e.strstart+R;do{}while(n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&n===r[++s]&&s<a);e.match_length=R-(a-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=U?(i=o._tr_tally(e,1,e.match_length-U),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(i=o._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),i&&(te(e,!1),0===e.strm.avail_out))return H}return e.insert=0,t===u?(te(e,!0),0===e.strm.avail_out?K:J):e.last_lit&&(te(e,!1),0===e.strm.avail_out)?H:Q}(s,t):n[s.level].func(s,t);if(y!==K&&y!==J||(s.status=F),y===H||y===K)return 0===e.avail_out&&(s.last_flush=-1),g;if(y===Q&&(t===c?o._tr_align(s):t!==h&&(o._tr_stored_block(s,0,0,!1),t===p&&(Y(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),ee(e),0===e.avail_out))return s.last_flush=-1,g}return t!==u?g:s.wrap<=0?b:(2===s.wrap?(ie(s,255&e.adler),ie(s,e.adler>>8&255),ie(s,e.adler>>16&255),ie(s,e.adler>>24&255),ie(s,255&e.total_in),ie(s,e.total_in>>8&255),ie(s,e.total_in>>16&255),ie(s,e.total_in>>24&255)):(ne(s,e.adler>>>16),ne(s,65535&e.adler)),ee(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?g:b)},t.deflateEnd=function(e){var t;return e&&e.state?(t=e.state.status)!==D&&t!==z&&t!==L&&t!==V&&t!==q&&t!==X&&t!==F?W(e,v):(e.state=null,t===X?W(e,f):g):v},t.deflateSetDictionary=function(e,t){var i,n,o,r,d,l,c,p,u=t.length;if(!e||!e.state)return v;if(2===(r=(i=e.state).wrap)||1===r&&i.status!==D||i.lookahead)return v;for(1===r&&(e.adler=a(e.adler,t,u,0)),i.wrap=0,u>=i.w_size&&(0===r&&(Y(i.head),i.strstart=0,i.block_start=0,i.insert=0),p=new s.Buf8(i.w_size),s.arraySet(p,t,u-i.w_size,i.w_size,0),t=p,u=i.w_size),d=e.avail_in,l=e.next_in,c=e.input,e.avail_in=u,e.next_in=0,e.input=t,ae(i);i.lookahead>=U;){n=i.strstart,o=i.lookahead-(U-1);do{i.ins_h=(i.ins_h<<i.hash_shift^i.window[n+U-1])&i.hash_mask,i.prev[n&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=n,n++}while(--o);i.strstart=n,i.lookahead=U-1,ae(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=U-1,i.match_available=0,e.next_in=l,e.input=c,e.avail_in=d,i.wrap=r,g},t.deflateInfo="pako deflate (from Nodeca project)"},function(e,t,i){"use strict";var n=i(0),s=4,o=0,a=1,r=2;function d(e){for(var t=e.length;--t>=0;)e[t]=0}var l=0,c=1,p=2,u=29,h=256,g=h+1+u,b=30,v=19,f=2*g+1,m=15,y=16,x=7,w=256,A=16,k=17,_=18,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],S=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],E=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],C=new Array(2*(g+2));d(C);var I=new Array(2*b);d(I);var P=new Array(512);d(P);var O=new Array(256);d(O);var j=new Array(u);d(j);var B,U,R,M=new Array(b);function N(e,t,i,n,s){this.static_tree=e,this.extra_bits=t,this.extra_base=i,this.elems=n,this.max_length=s,this.has_stree=e&&e.length}function D(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function z(e){return e<256?P[e]:P[256+(e>>>7)]}function L(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function V(e,t,i){e.bi_valid>y-i?(e.bi_buf|=t<<e.bi_valid&65535,L(e,e.bi_buf),e.bi_buf=t>>y-e.bi_valid,e.bi_valid+=i-y):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=i)}function q(e,t,i){V(e,i[2*t],i[2*t+1])}function X(e,t){var i=0;do{i|=1&e,e>>>=1,i<<=1}while(--t>0);return i>>>1}function F(e,t,i){var n,s,o=new Array(m+1),a=0;for(n=1;n<=m;n++)o[n]=a=a+i[n-1]<<1;for(s=0;s<=t;s++){var r=e[2*s+1];0!==r&&(e[2*s]=X(o[r]++,r))}}function H(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<b;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*w]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Q(e){e.bi_valid>8?L(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function K(e,t,i,n){var s=2*t,o=2*i;return e[s]<e[o]||e[s]===e[o]&&n[t]<=n[i]}function J(e,t,i){for(var n=e.heap[i],s=i<<1;s<=e.heap_len&&(s<e.heap_len&&K(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!K(t,n,e.heap[s],e.depth));)e.heap[i]=e.heap[s],i=s,s<<=1;e.heap[i]=n}function Z(e,t,i){var n,s,o,a,r=0;if(0!==e.last_lit)do{n=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],s=e.pending_buf[e.l_buf+r],r++,0===n?q(e,s,t):(q(e,(o=O[s])+h+1,t),0!==(a=G[o])&&V(e,s-=j[o],a),q(e,o=z(--n),i),0!==(a=T[o])&&V(e,n-=M[o],a))}while(r<e.last_lit);q(e,w,t)}function W(e,t){var i,n,s,o=t.dyn_tree,a=t.stat_desc.static_tree,r=t.stat_desc.has_stree,d=t.stat_desc.elems,l=-1;for(e.heap_len=0,e.heap_max=f,i=0;i<d;i++)0!==o[2*i]?(e.heap[++e.heap_len]=l=i,e.depth[i]=0):o[2*i+1]=0;for(;e.heap_len<2;)o[2*(s=e.heap[++e.heap_len]=l<2?++l:0)]=1,e.depth[s]=0,e.opt_len--,r&&(e.static_len-=a[2*s+1]);for(t.max_code=l,i=e.heap_len>>1;i>=1;i--)J(e,o,i);s=d;do{i=e.heap[1],e.heap[1]=e.heap[e.heap_len--],J(e,o,1),n=e.heap[1],e.heap[--e.heap_max]=i,e.heap[--e.heap_max]=n,o[2*s]=o[2*i]+o[2*n],e.depth[s]=(e.depth[i]>=e.depth[n]?e.depth[i]:e.depth[n])+1,o[2*i+1]=o[2*n+1]=s,e.heap[1]=s++,J(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var i,n,s,o,a,r,d=t.dyn_tree,l=t.max_code,c=t.stat_desc.static_tree,p=t.stat_desc.has_stree,u=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,g=t.stat_desc.max_length,b=0;for(o=0;o<=m;o++)e.bl_count[o]=0;for(d[2*e.heap[e.heap_max]+1]=0,i=e.heap_max+1;i<f;i++)(o=d[2*d[2*(n=e.heap[i])+1]+1]+1)>g&&(o=g,b++),d[2*n+1]=o,n>l||(e.bl_count[o]++,a=0,n>=h&&(a=u[n-h]),r=d[2*n],e.opt_len+=r*(o+a),p&&(e.static_len+=r*(c[2*n+1]+a)));if(0!==b){do{for(o=g-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[g]--,b-=2}while(b>0);for(o=g;0!==o;o--)for(n=e.bl_count[o];0!==n;)(s=e.heap[--i])>l||(d[2*s+1]!==o&&(e.opt_len+=(o-d[2*s+1])*d[2*s],d[2*s+1]=o),n--)}}(e,t),F(o,l,e.bl_count)}function $(e,t,i){var n,s,o=-1,a=t[1],r=0,d=7,l=4;for(0===a&&(d=138,l=3),t[2*(i+1)+1]=65535,n=0;n<=i;n++)s=a,a=t[2*(n+1)+1],++r<d&&s===a||(r<l?e.bl_tree[2*s]+=r:0!==s?(s!==o&&e.bl_tree[2*s]++,e.bl_tree[2*A]++):r<=10?e.bl_tree[2*k]++:e.bl_tree[2*_]++,r=0,o=s,0===a?(d=138,l=3):s===a?(d=6,l=3):(d=7,l=4))}function Y(e,t,i){var n,s,o=-1,a=t[1],r=0,d=7,l=4;for(0===a&&(d=138,l=3),n=0;n<=i;n++)if(s=a,a=t[2*(n+1)+1],!(++r<d&&s===a)){if(r<l)do{q(e,s,e.bl_tree)}while(0!=--r);else 0!==s?(s!==o&&(q(e,s,e.bl_tree),r--),q(e,A,e.bl_tree),V(e,r-3,2)):r<=10?(q(e,k,e.bl_tree),V(e,r-3,3)):(q(e,_,e.bl_tree),V(e,r-11,7));r=0,o=s,0===a?(d=138,l=3):s===a?(d=6,l=3):(d=7,l=4)}}d(M);var ee=!1;function te(e,t,i,s){V(e,(l<<1)+(s?1:0),3),function(e,t,i,s){Q(e),s&&(L(e,i),L(e,~i)),n.arraySet(e.pending_buf,e.window,t,i,e.pending),e.pending+=i}(e,t,i,!0)}t._tr_init=function(e){ee||(function(){var e,t,i,n,s,o=new Array(m+1);for(i=0,n=0;n<u-1;n++)for(j[n]=i,e=0;e<1<<G[n];e++)O[i++]=n;for(O[i-1]=n,s=0,n=0;n<16;n++)for(M[n]=s,e=0;e<1<<T[n];e++)P[s++]=n;for(s>>=7;n<b;n++)for(M[n]=s<<7,e=0;e<1<<T[n]-7;e++)P[256+s++]=n;for(t=0;t<=m;t++)o[t]=0;for(e=0;e<=143;)C[2*e+1]=8,e++,o[8]++;for(;e<=255;)C[2*e+1]=9,e++,o[9]++;for(;e<=279;)C[2*e+1]=7,e++,o[7]++;for(;e<=287;)C[2*e+1]=8,e++,o[8]++;for(F(C,g+1,o),e=0;e<b;e++)I[2*e+1]=5,I[2*e]=X(e,5);B=new N(C,G,h+1,g,m),U=new N(I,T,0,b,m),R=new N(new Array(0),S,0,v,x)}(),ee=!0),e.l_desc=new D(e.dyn_ltree,B),e.d_desc=new D(e.dyn_dtree,U),e.bl_desc=new D(e.bl_tree,R),e.bi_buf=0,e.bi_valid=0,H(e)},t._tr_stored_block=te,t._tr_flush_block=function(e,t,i,n){var d,l,u=0;e.level>0?(e.strm.data_type===r&&(e.strm.data_type=function(e){var t,i=4093624447;for(t=0;t<=31;t++,i>>>=1)if(1&i&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<h;t++)if(0!==e.dyn_ltree[2*t])return a;return o}(e)),W(e,e.l_desc),W(e,e.d_desc),u=function(e){var t;for($(e,e.dyn_ltree,e.l_desc.max_code),$(e,e.dyn_dtree,e.d_desc.max_code),W(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*E[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),d=e.opt_len+3+7>>>3,(l=e.static_len+3+7>>>3)<=d&&(d=l)):d=l=i+5,i+4<=d&&-1!==t?te(e,t,i,n):e.strategy===s||l===d?(V(e,(c<<1)+(n?1:0),3),Z(e,C,I)):(V(e,(p<<1)+(n?1:0),3),function(e,t,i,n){var s;for(V(e,t-257,5),V(e,i-1,5),V(e,n-4,4),s=0;s<n;s++)V(e,e.bl_tree[2*E[s]+1],3);Y(e,e.dyn_ltree,t-1),Y(e,e.dyn_dtree,i-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,u+1),Z(e,e.dyn_ltree,e.dyn_dtree)),H(e),n&&Q(e)},t._tr_tally=function(e,t,i){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&i,e.last_lit++,0===t?e.dyn_ltree[2*i]++:(e.matches++,t--,e.dyn_ltree[2*(O[i]+h+1)]++,e.dyn_dtree[2*z(t)]++),e.last_lit===e.lit_bufsize-1},t._tr_align=function(e){V(e,c<<1,3),q(e,w,C),function(e){16===e.bi_valid?(L(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}(e)}},function(e,t,i){"use strict";var n=i(12),s=i(0),o=i(4),a=i(6),r=i(1),d=i(5),l=i(15),c=Object.prototype.toString;function p(e){if(!(this instanceof p))return new p(e);this.options=s.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new d,this.strm.avail_out=0;var i=n.inflateInit2(this.strm,t.windowBits);if(i!==a.Z_OK)throw new Error(r[i]);if(this.header=new l,n.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=o.string2buf(t.dictionary):"[object ArrayBuffer]"===c.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(i=n.inflateSetDictionary(this.strm,t.dictionary))!==a.Z_OK))throw new Error(r[i])}function u(e,t){var i=new p(t);if(i.push(e,!0),i.err)throw i.msg||r[i.err];return i.result}p.prototype.push=function(e,t){var i,r,d,l,p,u=this.strm,h=this.options.chunkSize,g=this.options.dictionary,b=!1;if(this.ended)return!1;r=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,"string"==typeof e?u.input=o.binstring2buf(e):"[object ArrayBuffer]"===c.call(e)?u.input=new Uint8Array(e):u.input=e,u.next_in=0,u.avail_in=u.input.length;do{if(0===u.avail_out&&(u.output=new s.Buf8(h),u.next_out=0,u.avail_out=h),(i=n.inflate(u,a.Z_NO_FLUSH))===a.Z_NEED_DICT&&g&&(i=n.inflateSetDictionary(this.strm,g)),i===a.Z_BUF_ERROR&&!0===b&&(i=a.Z_OK,b=!1),i!==a.Z_STREAM_END&&i!==a.Z_OK)return this.onEnd(i),this.ended=!0,!1;u.next_out&&(0!==u.avail_out&&i!==a.Z_STREAM_END&&(0!==u.avail_in||r!==a.Z_FINISH&&r!==a.Z_SYNC_FLUSH)||("string"===this.options.to?(d=o.utf8border(u.output,u.next_out),l=u.next_out-d,p=o.buf2string(u.output,d),u.next_out=l,u.avail_out=h-l,l&&s.arraySet(u.output,u.output,d,l,0),this.onData(p)):this.onData(s.shrinkBuf(u.output,u.next_out)))),0===u.avail_in&&0===u.avail_out&&(b=!0)}while((u.avail_in>0||0===u.avail_out)&&i!==a.Z_STREAM_END);return i===a.Z_STREAM_END&&(r=a.Z_FINISH),r===a.Z_FINISH?(i=n.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===a.Z_OK):r!==a.Z_SYNC_FLUSH||(this.onEnd(a.Z_OK),u.avail_out=0,!0)},p.prototype.onData=function(e){this.chunks.push(e)},p.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=s.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},t.Inflate=p,t.inflate=u,t.inflateRaw=function(e,t){return(t=t||{}).raw=!0,u(e,t)},t.ungzip=u},function(e,t,i){"use strict";var n=i(0),s=i(2),o=i(3),a=i(13),r=i(14),d=0,l=1,c=2,p=4,u=5,h=6,g=0,b=1,v=2,f=-2,m=-3,y=-4,x=-5,w=8,A=1,k=2,_=3,G=4,T=5,S=6,E=7,C=8,I=9,P=10,O=11,j=12,B=13,U=14,R=15,M=16,N=17,D=18,z=19,L=20,V=21,q=22,X=23,F=24,H=25,Q=26,K=27,J=28,Z=29,W=30,$=31,Y=32,ee=852,te=592,ie=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function se(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=A,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new n.Buf32(ee),t.distcode=t.distdyn=new n.Buf32(te),t.sane=1,t.back=-1,g):f}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,se(e)):f}function ae(e,t){var i,n;return e&&e.state?(n=e.state,t<0?(i=0,t=-t):(i=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?f:(null!==n.window&&n.wbits!==t&&(n.window=null),n.wrap=i,n.wbits=t,oe(e))):f}function re(e,t){var i,s;return e?(s=new function(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new n.Buf16(320),this.work=new n.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0},e.state=s,s.window=null,(i=ae(e,t))!==g&&(e.state=null),i):f}var de,le,ce=!0;function pe(e){if(ce){var t;for(de=new n.Buf32(512),le=new n.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(r(l,e.lens,0,288,de,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;r(c,e.lens,0,32,le,0,e.work,{bits:5}),ce=!1}e.lencode=de,e.lenbits=9,e.distcode=le,e.distbits=5}function ue(e,t,i,s){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new n.Buf8(a.wsize)),s>=a.wsize?(n.arraySet(a.window,t,i-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>s&&(o=s),n.arraySet(a.window,t,i-s,o,a.wnext),(s-=o)?(n.arraySet(a.window,t,i-s,s,0),a.wnext=s,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}t.inflateReset=oe,t.inflateReset2=ae,t.inflateResetKeep=se,t.inflateInit=function(e){return re(e,ie)},t.inflateInit2=re,t.inflate=function(e,t){var i,ee,te,ie,se,oe,ae,re,de,le,ce,he,ge,be,ve,fe,me,ye,xe,we,Ae,ke,_e,Ge,Te=0,Se=new n.Buf8(4),Ee=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return f;(i=e.state).mode===j&&(i.mode=B),se=e.next_out,te=e.output,ae=e.avail_out,ie=e.next_in,ee=e.input,oe=e.avail_in,re=i.hold,de=i.bits,le=oe,ce=ae,ke=g;e:for(;;)switch(i.mode){case A:if(0===i.wrap){i.mode=B;break}for(;de<16;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(2&i.wrap&&35615===re){i.check=0,Se[0]=255&re,Se[1]=re>>>8&255,i.check=o(i.check,Se,2,0),re=0,de=0,i.mode=k;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&re)<<8)+(re>>8))%31){e.msg="incorrect header check",i.mode=W;break}if((15&re)!==w){e.msg="unknown compression method",i.mode=W;break}if(de-=4,Ae=8+(15&(re>>>=4)),0===i.wbits)i.wbits=Ae;else if(Ae>i.wbits){e.msg="invalid window size",i.mode=W;break}i.dmax=1<<Ae,e.adler=i.check=1,i.mode=512&re?P:j,re=0,de=0;break;case k:for(;de<16;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(i.flags=re,(255&i.flags)!==w){e.msg="unknown compression method",i.mode=W;break}if(57344&i.flags){e.msg="unknown header flags set",i.mode=W;break}i.head&&(i.head.text=re>>8&1),512&i.flags&&(Se[0]=255&re,Se[1]=re>>>8&255,i.check=o(i.check,Se,2,0)),re=0,de=0,i.mode=_;case _:for(;de<32;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.head&&(i.head.time=re),512&i.flags&&(Se[0]=255&re,Se[1]=re>>>8&255,Se[2]=re>>>16&255,Se[3]=re>>>24&255,i.check=o(i.check,Se,4,0)),re=0,de=0,i.mode=G;case G:for(;de<16;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.head&&(i.head.xflags=255&re,i.head.os=re>>8),512&i.flags&&(Se[0]=255&re,Se[1]=re>>>8&255,i.check=o(i.check,Se,2,0)),re=0,de=0,i.mode=T;case T:if(1024&i.flags){for(;de<16;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.length=re,i.head&&(i.head.extra_len=re),512&i.flags&&(Se[0]=255&re,Se[1]=re>>>8&255,i.check=o(i.check,Se,2,0)),re=0,de=0}else i.head&&(i.head.extra=null);i.mode=S;case S:if(1024&i.flags&&((he=i.length)>oe&&(he=oe),he&&(i.head&&(Ae=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),n.arraySet(i.head.extra,ee,ie,he,Ae)),512&i.flags&&(i.check=o(i.check,ee,he,ie)),oe-=he,ie+=he,i.length-=he),i.length))break e;i.length=0,i.mode=E;case E:if(2048&i.flags){if(0===oe)break e;he=0;do{Ae=ee[ie+he++],i.head&&Ae&&i.length<65536&&(i.head.name+=String.fromCharCode(Ae))}while(Ae&&he<oe);if(512&i.flags&&(i.check=o(i.check,ee,he,ie)),oe-=he,ie+=he,Ae)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=C;case C:if(4096&i.flags){if(0===oe)break e;he=0;do{Ae=ee[ie+he++],i.head&&Ae&&i.length<65536&&(i.head.comment+=String.fromCharCode(Ae))}while(Ae&&he<oe);if(512&i.flags&&(i.check=o(i.check,ee,he,ie)),oe-=he,ie+=he,Ae)break e}else i.head&&(i.head.comment=null);i.mode=I;case I:if(512&i.flags){for(;de<16;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(re!==(65535&i.check)){e.msg="header crc mismatch",i.mode=W;break}re=0,de=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=j;break;case P:for(;de<32;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}e.adler=i.check=ne(re),re=0,de=0,i.mode=O;case O:if(0===i.havedict)return e.next_out=se,e.avail_out=ae,e.next_in=ie,e.avail_in=oe,i.hold=re,i.bits=de,v;e.adler=i.check=1,i.mode=j;case j:if(t===u||t===h)break e;case B:if(i.last){re>>>=7&de,de-=7&de,i.mode=K;break}for(;de<3;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}switch(i.last=1&re,de-=1,3&(re>>>=1)){case 0:i.mode=U;break;case 1:if(pe(i),i.mode=L,t===h){re>>>=2,de-=2;break e}break;case 2:i.mode=N;break;case 3:e.msg="invalid block type",i.mode=W}re>>>=2,de-=2;break;case U:for(re>>>=7&de,de-=7&de;de<32;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if((65535&re)!=(re>>>16^65535)){e.msg="invalid stored block lengths",i.mode=W;break}if(i.length=65535&re,re=0,de=0,i.mode=R,t===h)break e;case R:i.mode=M;case M:if(he=i.length){if(he>oe&&(he=oe),he>ae&&(he=ae),0===he)break e;n.arraySet(te,ee,ie,he,se),oe-=he,ie+=he,ae-=he,se+=he,i.length-=he;break}i.mode=j;break;case N:for(;de<14;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(i.nlen=257+(31&re),re>>>=5,de-=5,i.ndist=1+(31&re),re>>>=5,de-=5,i.ncode=4+(15&re),re>>>=4,de-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=W;break}i.have=0,i.mode=D;case D:for(;i.have<i.ncode;){for(;de<3;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.lens[Ee[i.have++]]=7&re,re>>>=3,de-=3}for(;i.have<19;)i.lens[Ee[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,_e={bits:i.lenbits},ke=r(d,i.lens,0,19,i.lencode,0,i.work,_e),i.lenbits=_e.bits,ke){e.msg="invalid code lengths set",i.mode=W;break}i.have=0,i.mode=z;case z:for(;i.have<i.nlen+i.ndist;){for(;fe=(Te=i.lencode[re&(1<<i.lenbits)-1])>>>16&255,me=65535&Te,!((ve=Te>>>24)<=de);){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(me<16)re>>>=ve,de-=ve,i.lens[i.have++]=me;else{if(16===me){for(Ge=ve+2;de<Ge;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(re>>>=ve,de-=ve,0===i.have){e.msg="invalid bit length repeat",i.mode=W;break}Ae=i.lens[i.have-1],he=3+(3&re),re>>>=2,de-=2}else if(17===me){for(Ge=ve+3;de<Ge;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}de-=ve,Ae=0,he=3+(7&(re>>>=ve)),re>>>=3,de-=3}else{for(Ge=ve+7;de<Ge;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}de-=ve,Ae=0,he=11+(127&(re>>>=ve)),re>>>=7,de-=7}if(i.have+he>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=W;break}for(;he--;)i.lens[i.have++]=Ae}}if(i.mode===W)break;if(0===i.lens[256]){e.msg="invalid code -- missing end-of-block",i.mode=W;break}if(i.lenbits=9,_e={bits:i.lenbits},ke=r(l,i.lens,0,i.nlen,i.lencode,0,i.work,_e),i.lenbits=_e.bits,ke){e.msg="invalid literal/lengths set",i.mode=W;break}if(i.distbits=6,i.distcode=i.distdyn,_e={bits:i.distbits},ke=r(c,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,_e),i.distbits=_e.bits,ke){e.msg="invalid distances set",i.mode=W;break}if(i.mode=L,t===h)break e;case L:i.mode=V;case V:if(oe>=6&&ae>=258){e.next_out=se,e.avail_out=ae,e.next_in=ie,e.avail_in=oe,i.hold=re,i.bits=de,a(e,ce),se=e.next_out,te=e.output,ae=e.avail_out,ie=e.next_in,ee=e.input,oe=e.avail_in,re=i.hold,de=i.bits,i.mode===j&&(i.back=-1);break}for(i.back=0;fe=(Te=i.lencode[re&(1<<i.lenbits)-1])>>>16&255,me=65535&Te,!((ve=Te>>>24)<=de);){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(fe&&0==(240&fe)){for(ye=ve,xe=fe,we=me;fe=(Te=i.lencode[we+((re&(1<<ye+xe)-1)>>ye)])>>>16&255,me=65535&Te,!(ye+(ve=Te>>>24)<=de);){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}re>>>=ye,de-=ye,i.back+=ye}if(re>>>=ve,de-=ve,i.back+=ve,i.length=me,0===fe){i.mode=Q;break}if(32&fe){i.back=-1,i.mode=j;break}if(64&fe){e.msg="invalid literal/length code",i.mode=W;break}i.extra=15&fe,i.mode=q;case q:if(i.extra){for(Ge=i.extra;de<Ge;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.length+=re&(1<<i.extra)-1,re>>>=i.extra,de-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=X;case X:for(;fe=(Te=i.distcode[re&(1<<i.distbits)-1])>>>16&255,me=65535&Te,!((ve=Te>>>24)<=de);){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(0==(240&fe)){for(ye=ve,xe=fe,we=me;fe=(Te=i.distcode[we+((re&(1<<ye+xe)-1)>>ye)])>>>16&255,me=65535&Te,!(ye+(ve=Te>>>24)<=de);){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}re>>>=ye,de-=ye,i.back+=ye}if(re>>>=ve,de-=ve,i.back+=ve,64&fe){e.msg="invalid distance code",i.mode=W;break}i.offset=me,i.extra=15&fe,i.mode=F;case F:if(i.extra){for(Ge=i.extra;de<Ge;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}i.offset+=re&(1<<i.extra)-1,re>>>=i.extra,de-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=W;break}i.mode=H;case H:if(0===ae)break e;if(he=ce-ae,i.offset>he){if((he=i.offset-he)>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=W;break}he>i.wnext?(he-=i.wnext,ge=i.wsize-he):ge=i.wnext-he,he>i.length&&(he=i.length),be=i.window}else be=te,ge=se-i.offset,he=i.length;he>ae&&(he=ae),ae-=he,i.length-=he;do{te[se++]=be[ge++]}while(--he);0===i.length&&(i.mode=V);break;case Q:if(0===ae)break e;te[se++]=i.length,ae--,i.mode=V;break;case K:if(i.wrap){for(;de<32;){if(0===oe)break e;oe--,re|=ee[ie++]<<de,de+=8}if(ce-=ae,e.total_out+=ce,i.total+=ce,ce&&(e.adler=i.check=i.flags?o(i.check,te,ce,se-ce):s(i.check,te,ce,se-ce)),ce=ae,(i.flags?re:ne(re))!==i.check){e.msg="incorrect data check",i.mode=W;break}re=0,de=0}i.mode=J;case J:if(i.wrap&&i.flags){for(;de<32;){if(0===oe)break e;oe--,re+=ee[ie++]<<de,de+=8}if(re!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=W;break}re=0,de=0}i.mode=Z;case Z:ke=b;break e;case W:ke=m;break e;case $:return y;case Y:default:return f}return e.next_out=se,e.avail_out=ae,e.next_in=ie,e.avail_in=oe,i.hold=re,i.bits=de,(i.wsize||ce!==e.avail_out&&i.mode<W&&(i.mode<K||t!==p))&&ue(e,e.output,e.next_out,ce-e.avail_out)?(i.mode=$,y):(le-=e.avail_in,ce-=e.avail_out,e.total_in+=le,e.total_out+=ce,i.total+=ce,i.wrap&&ce&&(e.adler=i.check=i.flags?o(i.check,te,ce,e.next_out-ce):s(i.check,te,ce,e.next_out-ce)),e.data_type=i.bits+(i.last?64:0)+(i.mode===j?128:0)+(i.mode===L||i.mode===R?256:0),(0===le&&0===ce||t===p)&&ke===g&&(ke=x),ke)},t.inflateEnd=function(e){if(!e||!e.state)return f;var t=e.state;return t.window&&(t.window=null),e.state=null,g},t.inflateGetHeader=function(e,t){var i;return e&&e.state?0==(2&(i=e.state).wrap)?f:(i.head=t,t.done=!1,g):f},t.inflateSetDictionary=function(e,t){var i,n=t.length;return e&&e.state?0!==(i=e.state).wrap&&i.mode!==O?f:i.mode===O&&s(1,t,n,0)!==i.check?m:ue(e,t,n,n)?(i.mode=$,y):(i.havedict=1,g):f},t.inflateInfo="pako inflate (from Nodeca project)"},function(e,t,i){"use strict";e.exports=function(e,t){var i,n,s,o,a,r,d,l,c,p,u,h,g,b,v,f,m,y,x,w,A,k,_,G,T;i=e.state,n=e.next_in,G=e.input,s=n+(e.avail_in-5),o=e.next_out,T=e.output,a=o-(t-e.avail_out),r=o+(e.avail_out-257),d=i.dmax,l=i.wsize,c=i.whave,p=i.wnext,u=i.window,h=i.hold,g=i.bits,b=i.lencode,v=i.distcode,f=(1<<i.lenbits)-1,m=(1<<i.distbits)-1;e:do{g<15&&(h+=G[n++]<<g,g+=8,h+=G[n++]<<g,g+=8),y=b[h&f];t:for(;;){if(h>>>=x=y>>>24,g-=x,0===(x=y>>>16&255))T[o++]=65535&y;else{if(!(16&x)){if(0==(64&x)){y=b[(65535&y)+(h&(1<<x)-1)];continue t}if(32&x){i.mode=12;break e}e.msg="invalid literal/length code",i.mode=30;break e}w=65535&y,(x&=15)&&(g<x&&(h+=G[n++]<<g,g+=8),w+=h&(1<<x)-1,h>>>=x,g-=x),g<15&&(h+=G[n++]<<g,g+=8,h+=G[n++]<<g,g+=8),y=v[h&m];i:for(;;){if(h>>>=x=y>>>24,g-=x,!(16&(x=y>>>16&255))){if(0==(64&x)){y=v[(65535&y)+(h&(1<<x)-1)];continue i}e.msg="invalid distance code",i.mode=30;break e}if(A=65535&y,g<(x&=15)&&(h+=G[n++]<<g,(g+=8)<x&&(h+=G[n++]<<g,g+=8)),(A+=h&(1<<x)-1)>d){e.msg="invalid distance too far back",i.mode=30;break e}if(h>>>=x,g-=x,A>(x=o-a)){if((x=A-x)>c&&i.sane){e.msg="invalid distance too far back",i.mode=30;break e}if(k=0,_=u,0===p){if(k+=l-x,x<w){w-=x;do{T[o++]=u[k++]}while(--x);k=o-A,_=T}}else if(p<x){if(k+=l+p-x,(x-=p)<w){w-=x;do{T[o++]=u[k++]}while(--x);if(k=0,p<w){w-=x=p;do{T[o++]=u[k++]}while(--x);k=o-A,_=T}}}else if(k+=p-x,x<w){w-=x;do{T[o++]=u[k++]}while(--x);k=o-A,_=T}for(;w>2;)T[o++]=_[k++],T[o++]=_[k++],T[o++]=_[k++],w-=3;w&&(T[o++]=_[k++],w>1&&(T[o++]=_[k++]))}else{k=o-A;do{T[o++]=T[k++],T[o++]=T[k++],T[o++]=T[k++],w-=3}while(w>2);w&&(T[o++]=T[k++],w>1&&(T[o++]=T[k++]))}break}}break}}while(n<s&&o<r);n-=w=g>>3,h&=(1<<(g-=w<<3))-1,e.next_in=n,e.next_out=o,e.avail_in=n<s?s-n+5:5-(n-s),e.avail_out=o<r?r-o+257:257-(o-r),i.hold=h,i.bits=g}},function(e,t,i){"use strict";var n=i(0),s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],a=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],r=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];e.exports=function(e,t,i,d,l,c,p,u){var h,g,b,v,f,m,y,x,w,A=u.bits,k=0,_=0,G=0,T=0,S=0,E=0,C=0,I=0,P=0,O=0,j=null,B=0,U=new n.Buf16(16),R=new n.Buf16(16),M=null,N=0;for(k=0;k<=15;k++)U[k]=0;for(_=0;_<d;_++)U[t[i+_]]++;for(S=A,T=15;T>=1&&0===U[T];T--);if(S>T&&(S=T),0===T)return l[c++]=20971520,l[c++]=20971520,u.bits=1,0;for(G=1;G<T&&0===U[G];G++);for(S<G&&(S=G),I=1,k=1;k<=15;k++)if(I<<=1,(I-=U[k])<0)return-1;if(I>0&&(0===e||1!==T))return-1;for(R[1]=0,k=1;k<15;k++)R[k+1]=R[k]+U[k];for(_=0;_<d;_++)0!==t[i+_]&&(p[R[t[i+_]]++]=_);if(0===e?(j=M=p,m=19):1===e?(j=s,B-=257,M=o,N-=257,m=256):(j=a,M=r,m=-1),O=0,_=0,k=G,f=c,E=S,C=0,b=-1,v=(P=1<<S)-1,1===e&&P>852||2===e&&P>592)return 1;for(;;){y=k-C,p[_]<m?(x=0,w=p[_]):p[_]>m?(x=M[N+p[_]],w=j[B+p[_]]):(x=96,w=0),h=1<<k-C,G=g=1<<E;do{l[f+(O>>C)+(g-=h)]=y<<24|x<<16|w|0}while(0!==g);for(h=1<<k-1;O&h;)h>>=1;if(0!==h?(O&=h-1,O+=h):O=0,_++,0==--U[k]){if(k===T)break;k=t[i+p[_]]}if(k>S&&(O&v)!==b){for(0===C&&(C=S),f+=G,I=1<<(E=k-C);E+C<T&&!((I-=U[E+C])<=0);)E++,I<<=1;if(P+=1<<E,1===e&&P>852||2===e&&P>592)return 1;l[b=O&v]=S<<24|E<<16|f-c|0}}return 0!==O&&(l[f+O]=k-C<<24|64<<16|0),u.bits=S,0}},function(e,t,i){"use strict";e.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},function(e,t,i){(function(e,n){var s;
/*!
 * Platform.js <https://mths.be/platform>
 * Copyright 2014-2018 Benjamin Tan <https://bnjmnt4n.now.sh/>
 * Copyright 2011-2013 John-David Dalton <http://allyoucanleet.com/>
 * Available under MIT license <https://mths.be/mit>
 */(function(){"use strict";var o={function:!0,object:!0},a=o[typeof window]&&window||this,r=o[typeof t]&&t,d=o[typeof e]&&e&&!e.nodeType&&e,l=r&&d&&"object"==typeof n&&n;!l||l.global!==l&&l.window!==l&&l.self!==l||(a=l);var c=Math.pow(2,53)-1,p=/\bOpera/,u=Object.prototype,h=u.hasOwnProperty,g=u.toString;function b(e){return(e=String(e)).charAt(0).toUpperCase()+e.slice(1)}function v(e){return e=w(e),/^(?:webOS|i(?:OS|P))/.test(e)?e:b(e)}function f(e,t){for(var i in e)h.call(e,i)&&t(e[i],i,e)}function m(e){return null==e?b(e):g.call(e).slice(8,-1)}function y(e){return String(e).replace(/([ -])(?!$)/g,"$1?")}function x(e,t){var i=null;return function(e,t){var i=-1,n=e?e.length:0;if("number"==typeof n&&n>-1&&n<=c)for(;++i<n;)t(e[i],i,e);else f(e,t)}(e,function(n,s){i=t(i,n,s,e)}),i}function w(e){return String(e).replace(/^ +| +$/g,"")}var A=function e(t){var i=a,n=t&&"object"==typeof t&&"String"!=m(t);n&&(i=t,t=null);var s=i.navigator||{},o=s.userAgent||"";t||(t=o);var r,d,l=n?!!s.likeChrome:/\bChrome\b/.test(t)&&!/internal|\n/i.test(g.toString()),c=n?"Object":"ScriptBridgingProxyObject",u=n?"Object":"Environment",h=n&&i.java?"JavaPackage":m(i.java),b=n?"Object":"RuntimeObject",A=/\bJava/.test(h)&&i.java,k=A&&m(i.environment)==u,_=A?"a":"α",G=A?"b":"β",T=i.document||{},S=i.operamini||i.opera,E=p.test(E=n&&S?S["[[Class]]"]:m(S))?E:S=null,C=t,I=[],P=null,O=t==o,j=O&&S&&"function"==typeof S.version&&S.version(),B=function(e){return x(e,function(e,i){return e||RegExp("\\b"+(i.pattern||y(i))+"\\b","i").exec(t)&&(i.label||i)})}([{label:"EdgeHTML",pattern:"Edge"},"Trident",{label:"WebKit",pattern:"AppleWebKit"},"iCab","Presto","NetFront","Tasman","KHTML","Gecko"]),U=function(e){return x(e,function(e,i){return e||RegExp("\\b"+(i.pattern||y(i))+"\\b","i").exec(t)&&(i.label||i)})}(["Adobe AIR","Arora","Avant Browser","Breach","Camino","Electron","Epiphany","Fennec","Flock","Galeon","GreenBrowser","iCab","Iceweasel","K-Meleon","Konqueror","Lunascape","Maxthon",{label:"Microsoft Edge",pattern:"Edge"},"Midori","Nook Browser","PaleMoon","PhantomJS","Raven","Rekonq","RockMelt",{label:"Samsung Internet",pattern:"SamsungBrowser"},"SeaMonkey",{label:"Silk",pattern:"(?:Cloud9|Silk-Accelerated)"},"Sleipnir","SlimBrowser",{label:"SRWare Iron",pattern:"Iron"},"Sunrise","Swiftfox","Waterfox","WebPositive","Opera Mini",{label:"Opera Mini",pattern:"OPiOS"},"Opera",{label:"Opera",pattern:"OPR"},"Chrome",{label:"Chrome Mobile",pattern:"(?:CriOS|CrMo)"},{label:"Firefox",pattern:"(?:Firefox|Minefield)"},{label:"Firefox for iOS",pattern:"FxiOS"},{label:"IE",pattern:"IEMobile"},{label:"IE",pattern:"MSIE"},"Safari"]),R=D([{label:"BlackBerry",pattern:"BB10"},"BlackBerry",{label:"Galaxy S",pattern:"GT-I9000"},{label:"Galaxy S2",pattern:"GT-I9100"},{label:"Galaxy S3",pattern:"GT-I9300"},{label:"Galaxy S4",pattern:"GT-I9500"},{label:"Galaxy S5",pattern:"SM-G900"},{label:"Galaxy S6",pattern:"SM-G920"},{label:"Galaxy S6 Edge",pattern:"SM-G925"},{label:"Galaxy S7",pattern:"SM-G930"},{label:"Galaxy S7 Edge",pattern:"SM-G935"},"Google TV","Lumia","iPad","iPod","iPhone","Kindle",{label:"Kindle Fire",pattern:"(?:Cloud9|Silk-Accelerated)"},"Nexus","Nook","PlayBook","PlayStation Vita","PlayStation","TouchPad","Transformer",{label:"Wii U",pattern:"WiiU"},"Wii","Xbox One",{label:"Xbox 360",pattern:"Xbox"},"Xoom"]),M=function(e){return x(e,function(e,i,n){return e||(i[R]||i[/^[a-z]+(?: +[a-z]+\b)*/i.exec(R)]||RegExp("\\b"+y(n)+"(?:\\b|\\w*\\d)","i").exec(t))&&n})}({Apple:{iPad:1,iPhone:1,iPod:1},Archos:{},Amazon:{Kindle:1,"Kindle Fire":1},Asus:{Transformer:1},"Barnes & Noble":{Nook:1},BlackBerry:{PlayBook:1},Google:{"Google TV":1,Nexus:1},HP:{TouchPad:1},HTC:{},LG:{},Microsoft:{Xbox:1,"Xbox One":1},Motorola:{Xoom:1},Nintendo:{"Wii U":1,Wii:1},Nokia:{Lumia:1},Samsung:{"Galaxy S":1,"Galaxy S2":1,"Galaxy S3":1,"Galaxy S4":1},Sony:{PlayStation:1,"PlayStation Vita":1}}),N=function(e){return x(e,function(e,i){var n=i.pattern||y(i);return!e&&(e=RegExp("\\b"+n+"(?:/[\\d.]+|[ \\w.]*)","i").exec(t))&&(e=function(e,t,i){var n={"10.0":"10",6.4:"10 Technical Preview",6.3:"8.1",6.2:"8",6.1:"Server 2008 R2 / 7","6.0":"Server 2008 / Vista",5.2:"Server 2003 / XP 64-bit",5.1:"XP",5.01:"2000 SP1","5.0":"2000","4.0":"NT","4.90":"ME"};return t&&i&&/^Win/i.test(e)&&!/^Windows Phone /i.test(e)&&(n=n[/[\d.]+$/.exec(e)])&&(e="Windows "+n),e=String(e),t&&i&&(e=e.replace(RegExp(t,"i"),i)),e=v(e.replace(/ ce$/i," CE").replace(/\bhpw/i,"web").replace(/\bMacintosh\b/,"Mac OS").replace(/_PowerPC\b/i," OS").replace(/\b(OS X) [^ \d]+/i,"$1").replace(/\bMac (OS X)\b/,"$1").replace(/\/(\d)/," $1").replace(/_/g,".").replace(/(?: BePC|[ .]*fc[ \d.]+)$/i,"").replace(/\bx86\.64\b/gi,"x86_64").replace(/\b(Windows Phone) OS\b/,"$1").replace(/\b(Chrome OS \w+) [\d.]+\b/,"$1").split(" on ")[0])}(e,n,i.label||i)),e})}(["Windows Phone","Android","CentOS",{label:"Chrome OS",pattern:"CrOS"},"Debian","Fedora","FreeBSD","Gentoo","Haiku","Kubuntu","Linux Mint","OpenBSD","Red Hat","SuSE","Ubuntu","Xubuntu","Cygwin","Symbian OS","hpwOS","webOS ","webOS","Tablet OS","Tizen","Linux","Mac OS X","Macintosh","Mac","Windows 98;","Windows "]);function D(e){return x(e,function(e,i){var n=i.pattern||y(i);return!e&&(e=RegExp("\\b"+n+" *\\d+[.\\w_]*","i").exec(t)||RegExp("\\b"+n+" *\\w+-[\\w]*","i").exec(t)||RegExp("\\b"+n+"(?:; *(?:[a-z]+[_-])?[a-z]+\\d+|[^ ();-]*)","i").exec(t))&&((e=String(i.label&&!RegExp(n,"i").test(i.label)?i.label:e).split("/"))[1]&&!/[\d.]+/.test(e[0])&&(e[0]+=" "+e[1]),i=i.label||i,e=v(e[0].replace(RegExp(n,"i"),i).replace(RegExp("; *(?:"+i+"[_-])?","i")," ").replace(RegExp("("+i+")[-_.]?(\\w)","i"),"$1 $2"))),e})}if(B&&(B=[B]),M&&!R&&(R=D([M])),(r=/\bGoogle TV\b/.exec(R))&&(R=r[0]),/\bSimulator\b/i.test(t)&&(R=(R?R+" ":"")+"Simulator"),"Opera Mini"==U&&/\bOPiOS\b/.test(t)&&I.push("running in Turbo/Uncompressed mode"),"IE"==U&&/\blike iPhone OS\b/.test(t)?(M=(r=e(t.replace(/like iPhone OS/,""))).manufacturer,R=r.product):/^iP/.test(R)?(U||(U="Safari"),N="iOS"+((r=/ OS ([\d_]+)/i.exec(t))?" "+r[1].replace(/_/g,"."):"")):"Konqueror"!=U||/buntu/i.test(N)?M&&"Google"!=M&&(/Chrome/.test(U)&&!/\bMobile Safari\b/i.test(t)||/\bVita\b/.test(R))||/\bAndroid\b/.test(N)&&/^Chrome/.test(U)&&/\bVersion\//i.test(t)?(U="Android Browser",N=/\bAndroid\b/.test(N)?N:"Android"):"Silk"==U?(/\bMobi/i.test(t)||(N="Android",I.unshift("desktop mode")),/Accelerated *= *true/i.test(t)&&I.unshift("accelerated")):"PaleMoon"==U&&(r=/\bFirefox\/([\d.]+)\b/.exec(t))?I.push("identifying as Firefox "+r[1]):"Firefox"==U&&(r=/\b(Mobile|Tablet|TV)\b/i.exec(t))?(N||(N="Firefox OS"),R||(R=r[1])):!U||(r=!/\bMinefield\b/i.test(t)&&/\b(?:Firefox|Safari)\b/.exec(U))?(U&&!R&&/[\/,]|^[^(]+?\)/.test(t.slice(t.indexOf(r+"/")+8))&&(U=null),(r=R||M||N)&&(R||M||/\b(?:Android|Symbian OS|Tablet OS|webOS)\b/.test(N))&&(U=/[a-z]+(?: Hat)?/i.exec(/\bAndroid\b/.test(N)?N:r)+" Browser")):"Electron"==U&&(r=(/\bChrome\/([\d.]+)\b/.exec(t)||0)[1])&&I.push("Chromium "+r):N="Kubuntu",j||(j=function(e){return x(e,function(e,i){return e||(RegExp(i+"(?:-[\\d.]+/|(?: for [\\w-]+)?[ /-])([\\d.]+[^ ();/_-]*)","i").exec(t)||0)[1]||null})}(["(?:Cloud9|CriOS|CrMo|Edge|FxiOS|IEMobile|Iron|Opera ?Mini|OPiOS|OPR|Raven|SamsungBrowser|Silk(?!/[\\d.]+$))","Version",y(U),"(?:Firefox|Minefield|NetFront)"])),(r=("iCab"==B&&parseFloat(j)>3?"WebKit":/\bOpera\b/.test(U)&&(/\bOPR\b/.test(t)?"Blink":"Presto"))||/\b(?:Midori|Nook|Safari)\b/i.test(t)&&!/^(?:Trident|EdgeHTML)$/.test(B)&&"WebKit"||!B&&/\bMSIE\b/i.test(t)&&("Mac OS"==N?"Tasman":"Trident")||"WebKit"==B&&/\bPlayStation\b(?! Vita\b)/i.test(U)&&"NetFront")&&(B=[r]),"IE"==U&&(r=(/; *(?:XBLWP|ZuneWP)(\d+)/i.exec(t)||0)[1])?(U+=" Mobile",N="Windows Phone "+(/\+$/.test(r)?r:r+".x"),I.unshift("desktop mode")):/\bWPDesktop\b/i.test(t)?(U="IE Mobile",N="Windows Phone 8.x",I.unshift("desktop mode"),j||(j=(/\brv:([\d.]+)/.exec(t)||0)[1])):"IE"!=U&&"Trident"==B&&(r=/\brv:([\d.]+)/.exec(t))&&(U&&I.push("identifying as "+U+(j?" "+j:"")),U="IE",j=r[1]),O){if(function(e,t){var i=null!=e?typeof e[t]:"number";return!(/^(?:boolean|number|string|undefined)$/.test(i)||"object"==i&&!e[t])}(i,"global"))if(A&&(C=(r=A.lang.System).getProperty("os.arch"),N=N||r.getProperty("os.name")+" "+r.getProperty("os.version")),k){try{j=i.require("ringo/engine").version.join("."),U="RingoJS"}catch(e){(r=i.system)&&r.global.system==i.system&&(U="Narwhal",N||(N=r[0].os||null))}U||(U="Rhino")}else"object"==typeof i.process&&!i.process.browser&&(r=i.process)&&("object"==typeof r.versions&&("string"==typeof r.versions.electron?(I.push("Node "+r.versions.node),U="Electron",j=r.versions.electron):"string"==typeof r.versions.nw&&(I.push("Chromium "+j,"Node "+r.versions.node),U="NW.js",j=r.versions.nw)),U||(U="Node.js",C=r.arch,N=r.platform,j=(j=/[\d.]+/.exec(r.version))?j[0]:null));else m(r=i.runtime)==c?(U="Adobe AIR",N=r.flash.system.Capabilities.os):m(r=i.phantom)==b?(U="PhantomJS",j=(r=r.version||null)&&r.major+"."+r.minor+"."+r.patch):"number"==typeof T.documentMode&&(r=/\bTrident\/(\d+)/i.exec(t))?(j=[j,T.documentMode],(r=+r[1]+4)!=j[1]&&(I.push("IE "+j[1]+" mode"),B&&(B[1]=""),j[1]=r),j="IE"==U?String(j[1].toFixed(1)):j[0]):"number"==typeof T.documentMode&&/^(?:Chrome|Firefox)\b/.test(U)&&(I.push("masking as "+U+" "+j),U="IE",j="11.0",B=["Trident"],N="Windows");N=N&&v(N)}if(j&&(r=/(?:[ab]|dp|pre|[ab]\d+pre)(?:\d+\+?)?$/i.exec(j)||/(?:alpha|beta)(?: ?\d)?/i.exec(t+";"+(O&&s.appMinorVersion))||/\bMinefield\b/i.test(t)&&"a")&&(P=/b/i.test(r)?"beta":"alpha",j=j.replace(RegExp(r+"\\+?$"),"")+("beta"==P?G:_)+(/\d+\+?/.exec(r)||"")),"Fennec"==U||"Firefox"==U&&/\b(?:Android|Firefox OS)\b/.test(N))U="Firefox Mobile";else if("Maxthon"==U&&j)j=j.replace(/\.[\d.]+/,".x");else if(/\bXbox\b/i.test(R))"Xbox 360"==R&&(N=null),"Xbox 360"==R&&/\bIEMobile\b/.test(t)&&I.unshift("mobile mode");else if(!/^(?:Chrome|IE|Opera)$/.test(U)&&(!U||R||/Browser|Mobi/.test(U))||"Windows CE"!=N&&!/Mobi/i.test(t))if("IE"==U&&O)try{null===i.external&&I.unshift("platform preview")}catch(e){I.unshift("embedded")}else(/\bBlackBerry\b/.test(R)||/\bBB10\b/.test(t))&&(r=(RegExp(R.replace(/ +/g," *")+"/([.\\d]+)","i").exec(t)||0)[1]||j)?(N=((r=[r,/BB10/.test(t)])[1]?(R=null,M="BlackBerry"):"Device Software")+" "+r[0],j=null):this!=f&&"Wii"!=R&&(O&&S||/Opera/.test(U)&&/\b(?:MSIE|Firefox)\b/i.test(t)||"Firefox"==U&&/\bOS X (?:\d+\.){2,}/.test(N)||"IE"==U&&(N&&!/^Win/.test(N)&&j>5.5||/\bWindows XP\b/.test(N)&&j>8||8==j&&!/\bTrident\b/.test(t)))&&!p.test(r=e.call(f,t.replace(p,"")+";"))&&r.name&&(r="ing as "+r.name+((r=r.version)?" "+r:""),p.test(U)?(/\bIE\b/.test(r)&&"Mac OS"==N&&(N=null),r="identify"+r):(r="mask"+r,U=E?v(E.replace(/([a-z])([A-Z])/g,"$1 $2")):"Opera",/\bIE\b/.test(r)&&(N=null),O||(j=null)),B=["Presto"],I.push(r));else U+=" Mobile";(r=(/\bAppleWebKit\/([\d.]+\+?)/i.exec(t)||0)[1])&&(r=[parseFloat(r.replace(/\.(\d)$/,".0$1")),r],"Safari"==U&&"+"==r[1].slice(-1)?(U="WebKit Nightly",P="alpha",j=r[1].slice(0,-1)):j!=r[1]&&j!=(r[2]=(/\bSafari\/([\d.]+\+?)/i.exec(t)||0)[1])||(j=null),r[1]=(/\bChrome\/([\d.]+)/i.exec(t)||0)[1],537.36==r[0]&&537.36==r[2]&&parseFloat(r[1])>=28&&"WebKit"==B&&(B=["Blink"]),O&&(l||r[1])?(B&&(B[1]="like Chrome"),r=r[1]||((r=r[0])<530?1:r<532?2:r<532.05?3:r<533?4:r<534.03?5:r<534.07?6:r<534.1?7:r<534.13?8:r<534.16?9:r<534.24?10:r<534.3?11:r<535.01?12:r<535.02?"13+":r<535.07?15:r<535.11?16:r<535.19?17:r<536.05?18:r<536.1?19:r<537.01?20:r<537.11?"21+":r<537.13?23:r<537.18?24:r<537.24?25:r<537.36?26:"Blink"!=B?"27":"28")):(B&&(B[1]="like Safari"),r=(r=r[0])<400?1:r<500?2:r<526?3:r<533?4:r<534?"4+":r<535?5:r<537?6:r<538?7:r<601?8:"8"),B&&(B[1]+=" "+(r+="number"==typeof r?".x":/[.+]/.test(r)?"":"+")),"Safari"==U&&(!j||parseInt(j)>45)&&(j=r)),"Opera"==U&&(r=/\bzbov|zvav$/.exec(N))?(U+=" ",I.unshift("desktop mode"),"zvav"==r?(U+="Mini",j=null):U+="Mobile",N=N.replace(RegExp(" *"+r+"$"),"")):"Safari"==U&&/\bChrome\b/.exec(B&&B[1])&&(I.unshift("desktop mode"),U="Chrome Mobile",j=null,/\bOS X\b/.test(N)?(M="Apple",N="iOS 4.3+"):N=null),j&&0==j.indexOf(r=/[\d.]+$/.exec(N))&&t.indexOf("/"+r+"-")>-1&&(N=w(N.replace(r,""))),B&&!/\b(?:Avant|Nook)\b/.test(U)&&(/Browser|Lunascape|Maxthon/.test(U)||"Safari"!=U&&/^iOS/.test(N)&&/\bSafari\b/.test(B[1])||/^(?:Adobe|Arora|Breach|Midori|Opera|Phantom|Rekonq|Rock|Samsung Internet|Sleipnir|Web)/.test(U)&&B[1])&&(r=B[B.length-1])&&I.push(r),I.length&&(I=["("+I.join("; ")+")"]),M&&R&&R.indexOf(M)<0&&I.push("on "+M),R&&I.push((/^on /.test(I[I.length-1])?"":"on ")+R),N&&(r=/ ([\d.+]+)$/.exec(N),d=r&&"/"==N.charAt(N.length-r[0].length-1),N={architecture:32,family:r&&!d?N.replace(r[0],""):N,version:r?r[1]:null,toString:function(){var e=this.version;return this.family+(e&&!d?" "+e:"")+(64==this.architecture?" 64-bit":"")}}),(r=/\b(?:AMD|IA|Win|WOW|x86_|x)64\b/i.exec(C))&&!/\bi686\b/i.test(C)?(N&&(N.architecture=64,N.family=N.family.replace(RegExp(" *"+r),"")),U&&(/\bWOW64\b/i.test(t)||O&&/\w(?:86|32)$/.test(s.cpuClass||s.platform)&&!/\bWin64; x64\b/i.test(t))&&I.unshift("32-bit")):N&&/^OS X/.test(N.family)&&"Chrome"==U&&parseFloat(j)>=39&&(N.architecture=64),t||(t=null);var z={};return z.description=t,z.layout=B&&B[0],z.manufacturer=M,z.name=U,z.prerelease=P,z.product=R,z.ua=t,z.version=U&&j,z.os=N||{architecture:null,family:null,version:null,toString:function(){return"null"}},z.parse=e,z.toString=function(){return this.description||""},z.version&&I.unshift(j),z.name&&I.unshift(U),N&&U&&(N!=String(N).split(" ")[0]||N!=U.split(" ")[0]&&!R)&&I.push(R?"("+N+")":"on "+N),I.length&&(z.description=I.join(" ")),z}();a.platform=A,void 0===(s=function(){return A}.call(t,i,t,e))||(e.exports=s)}).call(this)}).call(this,i(17)(e),i(18))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t){var i;i=function(){return this}();try{i=i||Function("return this")()||(0,eval)("this")}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";i.r(t);const n="user-",s="peblThread://",o="pebl://",a="https://www.peblproject.com/definitions.html#";class r{constructor(e){if(this.id=e.id,this.actor=e.actor,this.verb=e.verb,this.context=e.context,this.stored=e.stored,this.timestamp=e.timestamp,this.result=e.result,this.object=e.object,this.attachments=e.attachments,this.object.definition){let e=this.object.definition.extensions;this.browserName=e[a+"browserName"],this.browserVersion=e[a+"browserVersion"],this.osName=e[a+"osName"],this.osVersion=e[a+"osVersion"],this.contextOrigin=e[a+"contextOrigin"],this.contextUrl=e[a+"contextUrl"],this.currentTeam=e[a+"currentTeam"],this.currentClass=e[a+"currentClass"]}}toXAPI(){return new r(this)}getActorId(){return this.actor.mbox||this.actor.openid||this.actor.account&&this.actor.account.name}static is(e){return!!e.verb}}class d extends r{constructor(e){super(e),this.thread=this.object.id,-1!=this.thread.indexOf(s)&&(this.thread=this.thread.substring(s.length)),this.name=this.object.definition.name["en-US"];let t=this.object.definition.extensions;this.book=t[a+"book"],this.docType=t[a+"docType"],this.location=t[a+"location"],this.card=t[a+"card"],this.url=t[a+"url"],this.target=t[a+"target"],this.externalURL=t[a+"externalURL"]}static is(e){let t=e.verb.display["en-US"];return"pushed"==t||"pulled"==t}}class l extends r{constructor(e){super(e),this.title=this.object.definition.name&&this.object.definition.name["en-US"],this.text=this.object.definition.description&&this.object.definition.description["en-US"],this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length)),this.owner=this.getActorId();let t=this.object.definition.extensions;this.type=t[a+"type"],this.cfi=t[a+"cfi"],this.idRef=t[a+"idRef"],this.style=t[a+"style"],t[a+"bookId"]&&(this.book=t[a+"bookId"]),this.pinned=e.pinned,this.pinMessage=e.pinMessage}static is(e){let t=e.verb.display["en-US"];return"commented"==t||"bookmarked"==t||"annotated"==t}}class c extends l{constructor(e){super(e);let t=this.object.definition.extensions;t&&(this.groupId=t[a+"groupId"])}static is(e){return"shared"==e.verb.display["en-US"]}}class p extends r{constructor(e){if(super(e),this.activityId=this.object.id,this.action=this.verb.display["en-US"],this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length)),this.object.definition){this.name=this.object.definition.name&&this.object.definition.name["en-US"],this.description=this.object.definition.description&&this.object.definition.description["en-US"];let e=this.object.definition.extensions;e&&(this.target=e[a+"target"],this.type=e[a+"type"],this.idref=e[a+"idref"],this.cfi=e[a+"cfi"],e[a+"bookId"]&&(this.book=e[a+"bookId"]))}}static is(e){let t=e.verb.display["en-US"];return"preferred"==t||"morphed"==t||"interacted"==t||"experienced"==t||"disliked"==t||"liked"==t||"accessed"==t||"hid"==t||"showed"==t||"displayed"==t||"undisplayed"==t||"searched"==t||"selected"==t||"unbookmarked"==t||"discarded"==t||"unshared"==t||"unannotated"==t||"submitted"==t}}class u extends r{constructor(e){super(e),this.type=this.verb.display["en-US"],this.activityId=this.object.id,this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length));let t=this.object.definition.extensions;t&&(this.firstCfi=t[a+"firstCfi"],this.lastCfi=t[a+"lastCfi"],t[a+"bookId"]&&(this.book=t[a+"bookId"]))}static is(e){let t=e.verb.display["en-US"];return"paged-next"==t||"paged-prev"==t||"paged-jump"==t||"interacted"==t||"completed"==t}}class h extends r{constructor(e){super(e),this.thread=this.object.id,-1!=this.thread.indexOf(s)&&(this.thread=this.thread.substring(s.length)),this.prompt=this.object.definition.name["en-US"],this.name=this.actor.name,this.direct=this.thread==n+this.getActorId(),this.text=this.result?this.result.response:this.object.definition.description["en-US"];let t=this.object.definition.extensions;t&&(this.access=t[a+"access"],this.type=t[a+"type"],this.replyThread=t[a+"replyThread"],this.groupId=t[a+"groupId"],this.isPrivate=t[a+"isPrivate"],this.book=t[a+"book"],this.cfi=t[a+"cfi"],this.idRef=t[a+"idRef"],this.peblAction=t[a+"peblAction"],t[a+"thread"]&&(this.thread=t[a+"thread"])),this.pinned=e.pinned,this.pinMessage=e.pinMessage}static is(e){let t=e.verb.display["en-US"];return"responded"==t||"noted"==t}}class g extends r{constructor(e){super(e),this.thread=this.context&&this.context.contextActivities&&this.context.contextActivities.parent?this.context.contextActivities.parent[0].id:"",-1!=this.thread.indexOf(s)&&(this.thread=this.thread.substring(s.length)),this.target=this.object.id}static is(e){return"voided"==e.verb.display["en-US"]}}class b extends r{constructor(e){super(e),this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length)),this.score=this.result.score.raw,this.min=this.result.score.min,this.max=this.result.score.max,this.completion=this.result.completion,this.success=this.result.success,this.response=this.result.response,this.prompt=this.object.definition.description["en-US"],this.activityId=this.object.id;let t=this.object.definition.choices;this.answers=[];for(let e of Object.keys(t))this.answers.push(t[e].description["en-US"]);let i=this.object.definition.extensions;i&&i[a+"bookId"]&&(this.book=i[a+"bookId"])}static is(e){return"attempted"==e.verb.display["en-US"]}}class v extends r{constructor(e){super(e),this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length)),this.score=this.result.score.raw,this.min=this.result.score.min,this.max=this.result.score.max,this.completion=this.result.completion,this.success=this.result.success,this.activityId=this.object.id;let t=this.object.definition.extensions;t&&t[a+"bookId"]&&(this.book=t[a+"bookId"])}static is(e){let t=e.verb.display["en-US"];return"failed"==t||"passed"==t}}class f extends r{constructor(e){super(e),this.activityId=this.object.id,this.object.definition&&(this.activityName=this.object.definition.name&&this.object.definition.name["en-US"],this.activityDescription=this.object.definition.description&&this.object.definition.description["en-US"]),this.book=this.object.id,-1!=this.book.indexOf(o)?this.book=this.book.substring(this.book.indexOf(o)+o.length):-1!=this.book.indexOf(s)&&(this.book=this.book.substring(this.book.indexOf(s)+s.length)),this.type=this.verb.display["en-US"];let t=this.object.definition.extensions;t&&t[a+"bookId"]&&(this.book=t[a+"bookId"])}static is(e){let t=e.verb.display["en-US"];return"entered"==t||"exited"==t||"logged-in"==t||"logged-out"==t||"terminated"==t||"initialized"==t||"launched"==t}}class m extends r{constructor(e){super(e),this.thread=this.object.id,-1!=this.thread.indexOf(s)&&(this.thread=this.thread.substring(s.length)),this.membershipId=this.object.definition.name["en-US"],this.description=this.object.definition.description&&this.object.definition.description["en-US"];let t=this.object.definition.extensions;this.role=t[a+"role"],this.activityType=t[a+"activityType"],this.organization=t[a+"organization"],this.organizationName=t[a+"organizationName"]}static is(e){return"joined"==e.verb.display["en-US"]}}class y extends r{constructor(e){super(e);let t=this.object.definition.extensions;this.token=this.object.definition.name["en-US"],this.programId=t[a+"programId"]}static is(e){return"invited"==e.verb.display["en-US"]}}class x extends r{constructor(e){super(e),this.thread=this.object.id;let t=this.object.definition.extensions;this.programId=this.object.definition.name["en-US"],this.previousValue=t[a+"previousValue"],this.newValue=t[a+"newValue"],this.action=t[a+"action"]}static is(e){let t=e.verb.display["en-US"];return"programLevelUp"==t||"programLevelDown"==t||"programInvited"==t||"programUninvited"==t||"programExpelled"==t||"programJoined"==t||"programActivityLaunched"==t||"programActivityCompleted"==t||"programActivityTeamCompleted"==t||"programModified"==t||"programDeleted"==t||"programCompleted"==t||"programCopied"==t||"programDiscussed"==t}}class w extends r{constructor(e){super(e);let t=this.object.definition.extensions;this.readerName=t[a+"readerName"],this.osName=t[a+"osName"],this.osVersion=t[a+"osVersion"],this.browserName=t[a+"browserName"],this.browserVersion=t[a+"browserVersion"],this.userAgent=t[a+"userAgent"],this.appVersion=t[a+"appVersion"],this.platform=t[a+"platform"],this.vendor=t[a+"vendor"],this.testResults=JSON.parse(t[a+"testResults"])}static is(e){return"compatibilityTested"==e.verb.display["en-US"]}}class A extends r{constructor(e){super(e)}}class k extends A{constructor(e){super(e);let t=this.object.definition.extensions;this.rating=this.object.definition.name["en-US"],this.idref=t[a+"idref"],this.programId=t[a+"programId"]}static is(e){return"moduleRating"==e.verb.display["en-US"]}}class _ extends A{constructor(e){super(e);let t=this.object.definition.extensions;this.feedback=this.object.definition.name["en-US"],this.willingToDiscuss=t[a+"willingToDiscuss"],this.idref=t[a+"idref"],this.programId=t[a+"programId"]}static is(e){return"moduleFeedback"==e.verb.display["en-US"]}}class G extends A{constructor(e){super(e);let t=this.object.definition.extensions;this.example=this.object.definition.name["en-US"],this.description=this.object.definition.description["en-US"],this.idref=t[a+"idref"],this.youtubeUrl=t[a+"youtubeUrl"],this.imageUrl=t[a+"imageUrl"],this.websiteUrl=t[a+"websiteUrl"],this.quotedPerson=t[a+"quotedPerson"],this.quotedTeam=t[a+"quotedTeam"]}static is(e){return"moduleExample"==e.verb.display["en-US"]}}class T extends A{constructor(e){super(e);let t=this.object.definition.extensions;this.rating=this.object.definition.name["en-US"],this.idref=t[a+"idref"],this.programId=t[a+"programId"],this.exampleId=t[a+"exampleId"]}static is(e){return"moduleExampleRating"==e.verb.display["en-US"]}}class S extends A{constructor(e){super(e);let t=this.object.definition.extensions;this.feedback=this.object.definition.name["en-US"],this.willingToDiscuss=t[a+"willingToDiscuss"],this.idref=t[a+"idref"],this.programId=t[a+"programId"],this.exampleId=t[a+"exampleId"]}static is(e){return"moduleExampleFeedback"==e.verb.display["en-US"]}}class E{constructor(e){if(this.identity=e.identity,this.name=e.name,this.homePage=e.homePage,this.preferredName=e.preferredName,e.registryEndpoint&&(this.registryEndpoint=new C(e.registryEndpoint)),this.currentTeam=e.currentTeam,this.currentTeamName=e.currentTeamName,this.currentClass=e.currentClass,this.currentClassName=e.currentClassName,this.memberships=e.memberships,this.role=e.role,this.groups=e.groups,this.endpoints=[],this.metadata=e.metadata,e.endpoints)for(let t of e.endpoints)this.endpoints.push(new C(t));null==this.homePage&&(this.homePage="acct:keycloak-server"),e.firstName&&(this.firstName=e.firstName),e.lastName&&(this.lastName=e.lastName),e.avatar&&(this.avatar=e.avatar),e.email&&(this.email=e.email),e.phoneNumber&&(this.phoneNumber=e.phoneNumber),e.streetAddress&&(this.streetAddress=e.streetAddress),e.city&&(this.city=e.city),e.state&&(this.state=e.state),e.zipCode&&(this.zipCode=e.zipCode),e.country&&(this.country=e.country)}toObject(){let e={};for(let t of this.endpoints)e[t.url]=t.toObject();let t={identity:this.identity,name:this.name,homePage:this.homePage,preferredName:this.preferredName,lrsUrls:e,metadata:{},registryEndpoint:this.registryEndpoint,currentTeam:this.currentTeam,currentTeamName:this.currentTeamName,currentClass:this.currentClass,currentClassName:this.currentClassName,memberships:this.memberships,firstName:this.firstName,lastName:this.lastName,avatar:this.avatar,email:this.email,phoneNumber:this.phoneNumber,streetAddress:this.streetAddress,city:this.city,state:this.state,zipCode:this.zipCode,country:this.country};return this.metadata&&(t.metadata=this.metadata),t}}class C{constructor(e){this.url=e.url,this.username=e.username,this.password=e.password,this.token=e.token,this.token||(this.token=btoa(this.username+":"+this.password)),this.lastSyncedBooksMine={},this.lastSyncedBooksShared={},this.lastSyncedThreads={},this.lastSyncedActivityEvents={},this.lastSyncedModules={}}toObject(e=""){return{url:e+this.url,username:this.username,password:this.password,token:this.token,lastSyncedThreads:this.lastSyncedThreads,lastSyncedBooksMine:this.lastSyncedBooksMine,lastSyncedBooksShared:this.lastSyncedBooksMine,lastSyncedActivityEvents:this.lastSyncedActivityEvents,lastSyncedModules:this.lastSyncedModules}}}class I{constructor(e){this.id=e.id,this.identity=e.identity,this.actor=e.actor,this.inviteId=e.inviteId,this.inviteLink=e.inviteLink,this.status=e.status,this.role=e.role,this.inviteRole=e.inviteRole}static is(e){return!!(e.id&&e.identity&&e.actor&&e.actor.name&&e.inviteLink&&e.status&&e.role&&e.inviteRole)}}class P{constructor(e){this.isNew=!1,this.dirtyEdits={},e.id?(this.id=e.id,this.isNew=!1):(
/*!
              Excerpt from: Math.uuid.js (v1.4)
              http://www.broofa.com
              mailto:robert@broofa.com
              Copyright (c) 2010 Robert Kieffer
              Dual licensed under the MIT and GPL licenses.
            */
this.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),this.isNew=!0),this.timestamp="string"==typeof e.timestamp?new Date(Date.parse(e.timestamp)):new Date,this.etag=e.etag,this.type=e.type,this.delete=e.delete}static is(e){return null!=(e.id&&e.type)}clearDirtyEdits(){this.dirtyEdits={}}toTransportFormat(){return{type:this.type,timestamp:this.timestamp?this.timestamp.toISOString():(new Date).toISOString(),id:this.id}}static merge(e,t){let i={},n=Object.keys(e),s=Object.keys(t);for(let t of n)i[t]=e[t];for(let e of s)null==i[e]||(i[e]=t[e]);return(e.delete&&1==e.delete||t.delete&&1==t.delete)&&(i.delete=!0),(e.completed&&1==e.completed||t.completed&&1==t.completed)&&(i.completed=!0),i}}class O extends P{constructor(e){e.type="learnlet",super(e),this._cfi=e.cfi,this._level=e.level,this.programTitle=e.name,this._description=e.description}get name(){return this.programTitle}get description(){return this._description}get level(){return this._level}get cfi(){return this._cfi}set name(e){this.dirtyEdits.name=!0,this.programTitle=e}set description(e){this.dirtyEdits.description=!0,this._description=e}set level(e){this.dirtyEdits.level=!0,this._level=e}set cfi(e){this.dirtyEdits.cfi=!0,this._cfi=e}static is(e){return"learnlet"==e.type}toTransportFormat(){let e=super.toTransportFormat(),t={};return(this.dirtyEdits.name||this.isNew)&&(e.name=this.programTitle),(this.dirtyEdits.description||this.isNew)&&(e.description=this._description),(this.dirtyEdits.description||this.isNew)&&(e.description=this._description),(this.dirtyEdits.cfi||this.isNew)&&(e.cfi=this._cfi),(this.dirtyEdits.level||this.isNew)&&(e.level=this._level),t[this.id]=e,t}}class j extends P{constructor(e){e.type="program",super(e);let t=this,i=[];if(e.members&&(i="string"==typeof e.members?JSON.parse(decodeURIComponent(e.members)):e.members?e.members:[]),i.length>0)for(let e of i)t.addMember(e);let n=Object.keys(e);for(let i of n)if(-1!==i.indexOf("member-")){let n="string"==typeof e[i]?JSON.parse(decodeURIComponent(e[i])):e[i]?e[i]:null;(null==n||r.is(n)&&m.is(n)||I.is(n))&&(t[i]=n)}if(this.programLevelStepsComplete=e.programLevelStepsComplete||0,this.programLevels=e.programLevels||[],this.programTitle=e.programTitle||"",this.programShortDescription=e.programShortDescription||"",this.programLongDescription=e.programLongDescription||"",this.programLevel=e.programLevel||0,this.programIssues=e.programIssues?e.programIssues:[],this.programCommunities=e.programCommunities?e.programCommunities:[],this.programInstitutions=e.programInstitutions?e.programInstitutions:[],this.programAvatar=e.programAvatar,this.programTeamName=e.programTeamName,this.programFocus=e.programFocus,this.completed=e.completed?new Date(e.completed):void 0,this.created=e.created?new Date(e.created):void 0,!this.created)if(this.isNew)this.created=new Date;else{let e=null,t=Object.keys(this);for(let i of t)if(-1!==i.indexOf("member-")){let t="string"==typeof this[i]?JSON.parse(decodeURIComponent(this[i])):this[i]?this[i]:null;t&&r.is(t)&&m.is(t)&&(!e||new Date(t.timestamp)<new Date(e.timestamp))&&(e=t)}e&&(this.created=new Date(e.timestamp))}this.members="string"==typeof e.members?JSON.parse(decodeURIComponent(e.members)):e.members?e.members:[]}static is(e){return"program"==e.type}toTransportFormat(){let e=super.toTransportFormat(),t=this,i=Object.keys(this);for(let n of i)-1!==n.indexOf("member-")&&(null==t[n]?e[n]=t[n]:(r.is(t[n])&&m.is(t[n])||I.is(t[n]))&&(e[n]=encodeURIComponent(JSON.stringify(t[n]))));return e.programLevelStepsComplete=this.programLevelStepsComplete,e.programLevels=this.programLevels,e.programTitle=this.programTitle,e.programShortDescription=this.programShortDescription,e.programLongDescription=this.programLongDescription,e.programLevel=this.programLevel,e.programIssues=this.programIssues,e.programAvatar=this.programAvatar,e.programTeamName=this.programTeamName,e.programFocus=this.programFocus,e.programCommunities=this.programCommunities,e.programInstitutions=this.programInstitutions,e.completed=this.completed?this.completed.toISOString():void 0,e.created=this.created?this.created.toISOString():void 0,e.members=encodeURIComponent(JSON.stringify(this.members)),e}addMember(e){this["member-"+e.id]=e}static iterateMembers(e,t){let i=Object.keys(e);for(let n of i)-1!==n.indexOf("member-")&&e[n]&&(r.is(e[n])&&m.is(e[n])?t(n,e[n]):I.is(e[n])&&t(n,e[n]))}static getMembers(e){let t=[],i=Object.keys(e);for(let n of i)-1!==n.indexOf("member-")&&e[n]&&r.is(e[n])&&m.is(e[n])&&t.push(e[n]);return t}static isMember(e,t){let i=!1,n=Object.keys(e);for(let s of n)-1!==s.indexOf("member-")&&e[s]&&e[s].identity===t&&(i=!0);return i}static isNew(e){let t=!0,i=Object.keys(e);for(let e of i)-1!==e.indexOf("member-")&&(t=!1);return t}}class B extends P{constructor(e){e.type="institution",super(e);let t=this,i=Object.keys(e);for(let n of i)if(-1!==n.indexOf("member-")){let i="string"==typeof e[n]?JSON.parse(decodeURIComponent(e[n])):e[n]?e[n]:null;(null==i||r.is(i)&&m.is(i)||I.is(i))&&(t[n]=i)}else if(-1!==n.indexOf("program-")){let i="string"==typeof e[n]?JSON.parse(decodeURIComponent(e[n])):e[n]?e[n]:null;(null==i||j.is(i))&&(t[n]=i)}this.institutionName=e.institutionName||"",this.institutionDescription=e.institutionDescription||"",this.institutionAvatar=e.institutionAvatar}static is(e){return"institution"==e.type}toTransportFormat(){let e=super.toTransportFormat(),t=this,i=Object.keys(this);for(let n of i)-1!==n.indexOf("member-")?null==t[n]?e[n]=t[n]:(r.is(t[n])&&m.is(t[n])||I.is(t[n]))&&(e[n]=encodeURIComponent(JSON.stringify(t[n]))):-1!==n.indexOf("program-")&&(null==t[n]?e[n]=t[n]:j.is(t[n])&&(e[n]=encodeURIComponent(JSON.stringify(t[n]))));return e.institutionName=this.institutionName,e.institutionDescription=this.institutionDescription,e.institutionAvatar=this.institutionAvatar,e}addMember(e){this["member-"+e.id]=e}addProgram(e){this["program-"+e.id]=e}static iterateMembers(e,t){let i=Object.keys(e);for(let n of i)-1!==n.indexOf("member-")&&e[n]&&(r.is(e[n])&&m.is(e[n])?t(n,e[n]):I.is(e[n])&&t(n,e[n]))}static isMember(e,t){let i=!1,n=Object.keys(e);for(let s of n)-1!==s.indexOf("member-")&&e[s]&&e[s].identity===t&&(i=!0);return i}static iteratePrograms(e,t){let i=Object.keys(e);for(let n of i)-1!==n.indexOf("program-")&&e[n]&&j.is(e[n])&&t(n,e[n])}static isProgram(e,t){let i=!1,n=Object.keys(e);for(let s of n)-1!==s.indexOf("program-")&&e[s]&&e[s].id===t&&(i=!0);return i}static isNew(e){let t=!0,i=Object.keys(e);for(let e of i)-1!==e.indexOf("member-")&&(t=!1);return t}}class U extends P{constructor(e){e.type="system",super(e);let t=this,i=Object.keys(e);for(let n of i)if(-1!==n.indexOf("member-")){let i="string"==typeof e[n]?JSON.parse(decodeURIComponent(e[n])):e[n]?e[n]:null;(null==i||r.is(i)&&m.is(i)||I.is(i))&&(t[n]=i)}this.systemName=e.systemName||"",this.systemDescription=e.systemDescription||""}static is(e){return"system"==e.type}toTransportFormat(){let e=super.toTransportFormat(),t=this,i=Object.keys(this);for(let n of i)-1!==n.indexOf("member-")&&(null==t[n]?e[n]=t[n]:(r.is(t[n])&&m.is(t[n])||I.is(t[n]))&&(e[n]=encodeURIComponent(JSON.stringify(t[n]))));return e.systemName=this.systemName,e.systemDescription=this.systemDescription,e}addMember(e){this["member-"+e.id]=e}static iterateMembers(e,t){let i=Object.keys(e);for(let n of i)-1!==n.indexOf("member-")&&e[n]&&(r.is(e[n])&&m.is(e[n])?t(n,e[n]):I.is(e[n])&&t(n,e[n]))}static isMember(e,t){let i=!1,n=Object.keys(e);for(let s of n)-1!==s.indexOf("member-")&&e[s]&&e[s].identity===t&&(i=!0);return i}static isNew(e){let t=!0,i=Object.keys(e);for(let e of i)-1!==e.indexOf("member-")&&(t=!1);return t}}class R extends P{static is(e){return"presence"==e.type}}const M=!1;function N(...e){M&&console.log(...e)}function D(...e){M&&console.error(...e)}const z="master",L="peblCurrentBook",V="peblCurrentBookTitle",q="peblCurrentBookId",X="peblCurrentUser";class F{constructor(e,t){this.invocationQueue=[];let i=window.indexedDB.open("pebl",28),n=this;this.pebl=e,i.onupgradeneeded=function(){let e=i.result,t=e.objectStoreNames;for(let i=0;i<t.length;i++)e.deleteObjectStore(t[i]);let n=e.createObjectStore("events",{keyPath:["identity","id"]}),s=e.createObjectStore("annotations",{keyPath:["identity","id"]}),o=e.createObjectStore("competencies",{keyPath:["url","identity"]}),a=e.createObjectStore("sharedAnnotations",{keyPath:["identity","id"]}),r=e.createObjectStore("outgoingXApi",{keyPath:["identity","id"]}),d=e.createObjectStore("outgoingActivity",{keyPath:["identity","id"]}),l=e.createObjectStore("messages",{keyPath:["identity","id"]}),c=e.createObjectStore("groups",{keyPath:["identity","id"]});e.createObjectStore("user",{keyPath:"identity"}),e.createObjectStore("state",{keyPath:"id"}),e.createObjectStore("assets"),e.createObjectStore("variables");let p=e.createObjectStore("queuedReferences",{keyPath:["identity","id"]}),u=e.createObjectStore("notifications",{keyPath:["identity","id"]}),h=e.createObjectStore("tocs",{keyPath:["identity","book","section","pageKey"]});e.createObjectStore("lrsAuth",{keyPath:"id"});let g=e.createObjectStore("activity",{keyPath:["identity","type","id"]}),b=e.createObjectStore("activityEvents",{keyPath:["id","programId"]}),v=e.createObjectStore("moduleEvents",{keyPath:["id","idref"]});g.createIndex(z,["identity","type"]),b.createIndex(z,["programId"]),v.createIndex(z,["idref"]),n.createIndex(z,["identity","book"]),s.createIndex(z,["identity","book"]),o.createIndex(z,"identity"),a.createIndex(z,"book"),d.createIndex(z,"identity"),r.createIndex(z,"identity"),c.createIndex(z,"identity"),l.createIndex(z,["identity","thread"]),p.createIndex(z,["identity","book"]),u.createIndex(z,"identity"),h.createIndex(z,["identity","book"])},i.onsuccess=function(){n.db=i.result,t();for(let e=0;e<n.invocationQueue.length;e++)n.invocationQueue[e]();n.invocationQueue=[]},i.onerror=function(e){D("error opening indexeddb",e)}}getAll(e,t,i){let n=e.openCursor(t),s=[];n.onerror=function(e){D("Error",t,e)},n.onsuccess=function(){let e=n.result;s?e?(s.push(e.value),e.continue()):null!=i&&i(s):null!=i&&i(null!=e?e.value:[])}}cleanRecord(e){let t=typeof e;if(e&&"object"==t){let t=e;for(let i of Object.keys(e)){let e=t[i],n=typeof e;if("function"==n)delete t[i];else if("array"==n)for(let t=0;t<e.length;t++)this.cleanRecord(e[t]);else"object"==n&&this.cleanRecord(e)}}else if("array"==t){let t=e;for(let e=0;e<t.length;e++)this.cleanRecord(t[e])}return e}saveSharedAnnotations(e,t,i){if(this.db)if(t instanceof c){let n=t;n.identity=e.identity;let s=this.db.transaction(["sharedAnnotations"],"readwrite").objectStore("sharedAnnotations").put(n);s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this.db.transaction(["sharedAnnotations"],"readwrite").objectStore("sharedAnnotations"),s=t.slice(0),o=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity;let s=n.put(i);s.onerror=o,s.onsuccess=o}else i&&i()};o()}else{let n=this;this.invocationQueue.push(function(){n.saveSharedAnnotations(e,t,i)})}}getSharedAnnotations(e,t,i){if(this.db){let e=this.db.transaction(["sharedAnnotations"],"readonly").objectStore("sharedAnnotations").index(z),n=t;this.getAll(e,IDBKeyRange.only(n),i)}else{let n=this;this.invocationQueue.push(function(){n.getSharedAnnotations(e,t,i)})}}removeSharedAnnotation(e,t,i){if(this.db){let n=this.db.transaction(["sharedAnnotations"],"readwrite").objectStore("sharedAnnotations").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeSharedAnnotation(e,t,i)})}}getAnnotations(e,t,i){if(this.db){let n=this.db.transaction(["annotations"],"readonly").objectStore("annotations").index(z),s=[e.identity,t];this.getAll(n,IDBKeyRange.only(s),i)}else{let n=this;this.invocationQueue.push(function(){n.getAnnotations(e,t,i)})}}saveAnnotations(e,t,i){if(this.db)if(t instanceof l){let n=t;n.identity=e.identity;let s=this.db.transaction(["annotations"],"readwrite").objectStore("annotations").put(n);s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this.db.transaction(["annotations"],"readwrite").objectStore("annotations"),s=t.slice(0),o=this,a=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity;let s=n.put(o.cleanRecord(i));s.onerror=a,s.onsuccess=a}else i&&i()};a()}else{let n=this;this.invocationQueue.push(function(){n.saveAnnotations(e,t,i)})}}removeAnnotation(e,t,i){if(this.db){let n=this.db.transaction(["annotations"],"readwrite").objectStore("annotations").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeAnnotation(e,t,i)})}}removeCurrentUser(e){if(this.db){let t=this.db.transaction(["state"],"readwrite").objectStore("state").delete(IDBKeyRange.only(X));t.onerror=function(e){D(e)},t.onsuccess=function(){e&&e()}}else{let t=this;this.invocationQueue.push(function(){t.removeCurrentUser(e)})}}saveCurrentUser(e,t){let i={id:X,value:e.identity};if(this.db){let e=this.db.transaction(["state"],"readwrite").objectStore("state").put(this.cleanRecord(i));e.onerror=function(e){D(e)},e.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveCurrentUser(e,t)})}}getCurrentUser(e){if(this.db){let t=this.db.transaction(["state"],"readonly").objectStore("state").get(X);t.onerror=function(e){D(e)},t.onsuccess=function(){let i=t.result;null!=i?e(i.value):e()}}else{let t=this;this.invocationQueue.push(function(){t.getCurrentUser(e)})}}getUserProfile(e,t){if(this.db){let i=this.db.transaction(["user"],"readonly").objectStore("user").get(e);i.onerror=function(e){D(e)},i.onsuccess=function(){let e=i.result;null!=e?t(e):t()}}else{let i=this;this.invocationQueue.push(function(){i.getUserProfile(e,t)})}}saveUserProfile(e,t){if(this.db){let i=this.db.transaction(["user"],"readwrite").objectStore("user").put(this.cleanRecord(e));i.onerror=function(e){D(e)},i.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveUserProfile(e,t)})}}saveCurrentActivity(e,t){let i={value:e,id:L};if(this.db){let e=this.db.transaction(["state"],"readwrite").objectStore("state").put(this.cleanRecord(i));e.onerror=function(e){D(e)},e.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveCurrentActivity(e,t)})}}getCurrentActivity(e){if(this.db){let t=this.db.transaction(["state"],"readonly").objectStore("state").get(L);t.onerror=function(e){D(e)},t.onsuccess=function(){let i=t.result;null!=e&&(null!=i?e(i.value):e())}}else{let t=this;this.invocationQueue.push(function(){t.getCurrentActivity(e)})}}removeCurrentActivity(e){if(this.db){let t=this.db.transaction(["state"],"readwrite").objectStore("state").delete(IDBKeyRange.only(L));t.onerror=function(e){D(e)},t.onsuccess=function(){e&&e()}}else{let t=this;this.invocationQueue.push(function(){t.removeCurrentActivity(e)})}}saveCurrentBook(e,t){let i={value:e,id:L};if(this.db){let e=this.db.transaction(["state"],"readwrite").objectStore("state").put(this.cleanRecord(i));e.onerror=function(e){D(e)},e.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveCurrentBook(e,t)})}}getCurrentBook(e){if(this.db){let t=this.db.transaction(["state"],"readonly").objectStore("state").get(L);t.onerror=function(e){D(e)},t.onsuccess=function(){let i=t.result;null!=e&&(null!=i?e(i.value):e())}}else{let t=this;this.invocationQueue.push(function(){t.getCurrentBook(e)})}}saveCurrentBookTitle(e,t){let i={value:e,id:V};if(this.db){let e=this.db.transaction(["state"],"readwrite").objectStore("state").put(this.cleanRecord(i));e.onerror=function(e){D(e)},e.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveCurrentBookTitle(e,t)})}}getCurrentBookTitle(e){if(this.db){let t=this.db.transaction(["state"],"readonly").objectStore("state").get(V);t.onerror=function(e){D(e)},t.onsuccess=function(){let i=t.result;null!=e&&(null!=i?e(i.value):e())}}else{let t=this;this.invocationQueue.push(function(){t.getCurrentBookTitle(e)})}}saveCurrentBookId(e,t){let i={value:e,id:q};if(this.db){let e=this.db.transaction(["state"],"readwrite").objectStore("state").put(this.cleanRecord(i));e.onerror=function(e){D(e)},e.onsuccess=function(){t&&t()}}else{let i=this;this.invocationQueue.push(function(){i.saveCurrentBookId(e,t)})}}getCurrentBookId(e){if(this.db){let t=this.db.transaction(["state"],"readonly").objectStore("state").get(q);t.onerror=function(e){D(e)},t.onsuccess=function(){let i=t.result;null!=e&&(null!=i?e(i.value):e())}}else{let t=this;this.invocationQueue.push(function(){t.getCurrentBookId(e)})}}saveSyncTimestamps(e,t,i,n){if(this.db){let s=this.db.transaction(["state"],"readwrite").objectStore("state").put({id:e+t,data:i});s.onerror=function(e){D(e),n(!1)},s.onsuccess=function(){n(!0)}}else this.invocationQueue.push(()=>{this.saveSyncTimestamps(e,t,i,n)})}getSyncTimestamps(e,t,i){if(this.db){let n=this.db.transaction(["state"],"readonly").objectStore("state").get(e+t);n.onerror=function(e){D(e),i(-1)},n.onsuccess=function(){n.result?i(n.result.data):i(-1)}}else this.invocationQueue.push(()=>{this.getSyncTimestamps(e,t,i)})}saveCompoundSyncTimestamps(e,t,i,n){if(this.db){let s=this.db.transaction(["state"],"readwrite").objectStore("state").put({id:e+t,data:i});s.onerror=function(e){D(e),n(!1)},s.onsuccess=function(){n(!0)}}else this.invocationQueue.push(()=>{this.saveCompoundSyncTimestamps(e,t,i,n)})}getCompoundSyncTimestamps(e,t,i){if(this.db){let n=this.db.transaction(["state"],"readonly").objectStore("state").get(e+t);n.onerror=function(e){D(e),i({})},n.onsuccess=function(){n.result?i(n.result.data):i({})}}else this.invocationQueue.push(()=>{this.getCompoundSyncTimestamps(e,t,i)})}saveEvent(e,t,i){if(this.db)if(t instanceof r){let n=t;n.identity=e.identity;let s=this.db.transaction(["events"],"readwrite").objectStore("events").put(n);s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this.db.transaction(["events"],"readwrite").objectStore("events"),s=t.slice(0),o=this,a=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity;let s=n.put(o.cleanRecord(i));s.onerror=a,s.onsuccess=a}else i&&i()};a()}else{let n=this;this.invocationQueue.push(function(){n.saveEvent(e,t,i)})}}getEvents(e,t,i){if(this.db){let n=this.db.transaction(["events"],"readonly").objectStore("events").index(z),s=[e.identity,t];this.getAll(n,IDBKeyRange.only(s),i)}else{let n=this;this.invocationQueue.push(function(){n.getEvents(e,t,i)})}}getCompetencies(e,t){if(this.db){let i=this.db.transaction(["competencies"],"readonly").objectStore("competencies").index(z),n=e.identity,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getCompetencies(e,t)})}}saveCompetencies(e,t,i){if(this.db){let n=this.db.transaction(["competencies"],"readwrite").objectStore("competencies");for(let i of Object.keys(t)){let n=t[i];n.url=i,n.identity=e.identity,t.push(n)}let s=this,o=function(){if(t.length>0){let e=t.pop(),i=n.put(s.cleanRecord(e));i.onerror=o,i.onsuccess=o}else i&&i()};o()}else{let n=this;this.invocationQueue.push(function(){n.saveCompetencies(e,t,i)})}}saveOutgoingXApi(e,t,i){if(this.db){let n=t;n.identity=e.identity;let s=this.db.transaction(["outgoingXApi"],"readwrite").objectStore("outgoingXApi").put(this.cleanRecord(n));s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.saveOutgoingXApi(e,t,i)})}}getOutgoingXApi(e,t){if(this.db){let i=this.db.transaction(["outgoingXApi"],"readonly").objectStore("outgoingXApi").index(z),n=e.identity,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getOutgoingXApi(e,t)})}}removeOutgoingXApi(e,t,i){if(this.db){let n=this.db.transaction(["outgoingXApi"],"readwrite").objectStore("outgoingXApi"),s=t.slice(0),o=function(){if(t.length>0){let t=s.pop();if(t){let i=n.delete(IDBKeyRange.only([e.identity,t.id]));i.onerror=o,i.onsuccess=o}else i&&i()}};o()}else{let n=this;this.invocationQueue.push(function(){n.removeOutgoingXApi(e,t,i)})}}saveMessages(e,t,i){if(this.db)if(t instanceof h){let n=t;n.identity=e.identity,n.isPrivate?n.thread+="_user-"+e.identity:n.groupId&&(n.thread+="_group-"+n.groupId);let s=this.db.transaction(["messages"],"readwrite").objectStore("messages").put(this.cleanRecord(n));s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this.db.transaction(["messages"],"readwrite").objectStore("messages"),s=t.slice(0),o=this,a=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity,i.isPrivate?i.thread+="_user-"+e.identity:i.groupId&&(i.thread+="_group-"+i.groupId);let s=n.put(o.cleanRecord(i));s.onerror=a,s.onsuccess=a}else i&&i()};a()}else{let n=this;this.invocationQueue.push(function(){n.saveMessages(e,t,i)})}}removeMessage(e,t,i){if(this.db){let n=this.db.transaction(["messages"],"readwrite").objectStore("messages").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeMessage(e,t,i)})}}getMessages(e,t,i){if(this.db){let n=this.db.transaction(["messages"],"readonly").objectStore("messages").index(z);this.getAll(n,IDBKeyRange.only([e.identity,t]),i)}else{let n=this;this.invocationQueue.push(function(){n.getMessages(e,t,i)})}}saveAsset(e,t,i){if(this.db){let n=this.db.transaction(["assets"],"readwrite").objectStore("assets").put(t,e);n.onerror=function(e){D(e)},n.onsuccess=function(t){i&&i(e)}}else{let n=this;this.invocationQueue.push(function(){n.saveAsset(e,t,i)})}}getAsset(e){let t=this;return new Promise((i,n)=>{if(this.db){let s=this.db.transaction(["assets"],"readonly").objectStore("assets").get(e);s.onerror=function(e){D(e),n()},s.onsuccess=function(){s.result?i(s.result):t.pebl.network.fetchAsset(e).then(e=>{i(e)}).catch(()=>{n()})}}else{let t=this;this.invocationQueue.push(function(){i(t.getAsset(e))})}})}saveVariable(e,t,i){if(this.db){let n=this.db.transaction(["variables"],"readwrite").objectStore("variables").put(t,e);n.onerror=function(e){D(e)},n.onsuccess=function(t){i&&i(e)}}else{let n=this;this.invocationQueue.push(function(){n.saveAsset(e,t,i)})}}getVariable(e){return new Promise((t,i)=>{if(this.db){let n=this.db.transaction(["variables"],"readonly").objectStore("variables").get(e);n.onerror=function(e){D(e),i()},n.onsuccess=function(){void 0!==n.result?t(n.result):i()}}else{let i=this;this.invocationQueue.push(function(){t(i.getVariable(e))})}})}saveQueuedReference(e,t,i){if(this.db){t.identity=e.identity;let n=this.db.transaction(["queuedReferences"],"readwrite").objectStore("queuedReferences").put(this.cleanRecord(t));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.saveQueuedReference(e,t,i)})}}getQueuedReference(e,t,i){if(this.db){let n=this.db.transaction(["queuedReferences"],"readonly").objectStore("queuedReferences").index(z),s=n.openCursor(IDBKeyRange.only([e.identity,t]));s.onerror=function(e){D(e)},s.onsuccess=function(){if(null==s.result){let o=n.openCursor(IDBKeyRange.only([e.identity,t]));o.onerror=function(e){D(e)},o.onsuccess=function(){i&&s.result?i(s.result.value):i()}}else i&&s.result?i(s.result.value):i()}}else{let n=this;this.invocationQueue.push(function(){n.getQueuedReference(e,t,i)})}}removeQueuedReference(e,t,i){if(this.db){let n=this.db.transaction(["queuedReferences"],"readwrite").objectStore("queuedReferences").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeQueuedReference(e,t,i)})}}saveToc(e,t,i,n){if(this.db){i.identity=e.identity,i.book=t;let s=this.db.transaction(["tocs"],"readwrite").objectStore("tocs").put(this.cleanRecord(i));s.onerror=function(e){D(e)},s.onsuccess=function(){n&&n()}}else{let s=this;this.invocationQueue.push(function(){s.saveToc(e,t,i,n)})}}getToc(e,t,i){if(null!=t)if(this.db){let n=this.db.transaction(["tocs"],"readonly").objectStore("tocs").index(z);this.getAll(n,IDBKeyRange.only([e.identity,t]),i)}else{let n=this;this.invocationQueue.push(function(){n.getToc(e,t,i)})}else i([])}removeToc(e,t,i,n,s){if(this.db){let o=this.db.transaction(["tocs"],"readwrite").objectStore("tocs").delete(IDBKeyRange.only([e.identity,t,i,n]));o.onerror=function(e){D(e)},o.onsuccess=function(){s&&s()}}else{let o=this;this.invocationQueue.push(function(){o.removeToc(e,t,i,n,s)})}}saveNotification(e,t,i){if(this.db){t.identity=e.identity;let n=this.db.transaction(["notifications"],"readwrite").objectStore("notifications").put(this.cleanRecord(t));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.saveNotification(e,t,i)})}}getNotification(e,t,i){if(this.db){let n=this.db.transaction(["notifications"],"readwrite").objectStore("notifications").get(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i(n.result)}}else{let n=this;this.invocationQueue.push(function(){n.getNotification(e,t,i)})}}getNotifications(e,t){if(this.db){let i=this.db.transaction(["notifications"],"readonly").objectStore("notifications").index(z),n=e.identity,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getNotifications(e,t)})}}removeNotification(e,t,i){if(this.db){let n=this.db.transaction(["notifications"],"readwrite").objectStore("notifications").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeNotification(e,t,i)})}}saveGroupMembership(e,t,i){if(this.db)if(t instanceof m){let n=t;n.identity=e.identity;let s=this.db.transaction(["groups"],"readwrite").objectStore("groups").put(n);s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this.db.transaction(["groups"],"readwrite").objectStore("groups"),s=t.slice(0),o=this,a=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity;let s=n.put(o.cleanRecord(i));s.onerror=a,s.onsuccess=a}else i&&i()};a()}else{let n=this;this.invocationQueue.push(function(){n.saveGroupMembership(e,t,i)})}}getGroupMembership(e,t){if(this.db){let i=this.db.transaction(["groups"],"readonly").objectStore("groups").index(z),n=e.identity,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getGroupMembership(e,t)})}}removeGroupMembership(e,t,i){if(this.db){let n=this.db.transaction(["groups"],"readwrite").objectStore("groups").delete(IDBKeyRange.only([e.identity,t]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeGroupMembership(e,t,i)})}}getActivityEvent(e,t){if(this.db){let i=this.db.transaction(["activityEvents"],"readonly").objectStore("activityEvents").index(z),n=e,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getActivityEvent(e,t)})}}saveActivityEvent(e,t,i){if(this.db)if(t instanceof x){let e=t;e.identity=e.actor.account.name;let n=this.db.transaction(["activityEvents"],"readwrite").objectStore("activityEvents").put(e);n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let e=this.db.transaction(["activityEvents"],"readwrite").objectStore("activityEvents"),n=t.slice(0),s=this,o=function(){let t=n.pop();if(t){let i=t;i.identity=i.actor.account.name;let n=e.put(s.cleanRecord(i));n.onerror=o,n.onsuccess=o}else i&&i()};o()}else{let n=this;this.invocationQueue.push(function(){n.saveActivityEvent(e,t,i)})}}getModuleEvent(e,t){if(this.db){let i=this.db.transaction(["moduleEvents"],"readonly").objectStore("moduleEvents").index(z),n=e,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getModuleEvent(e,t)})}}saveModuleEvent(e,t,i){if(this.db)if(t instanceof A){let e=t;e.identity=e.actor.account.name;let n=this.db.transaction(["moduleEvents"],"readwrite").objectStore("moduleEvents").put(e);n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let e=this.db.transaction(["moduleEvents"],"readwrite").objectStore("moduleEvents"),n=t.slice(0),s=this,o=function(){let t=n.pop();if(t){let i=t;i.identity=i.actor.account.name;let n=e.put(s.cleanRecord(i));n.onerror=o,n.onsuccess=o}else i&&i()};o()}else{let n=this;this.invocationQueue.push(function(){n.saveModuleEvent(e,t,i)})}}removeModuleEvent(e,t,i){if(this.db){let n=this.db.transaction(["moduleEvents"],"readwrite").objectStore("moduleEvents").delete(IDBKeyRange.only([t,e]));n.onerror=function(e){D(e)},n.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.removeModuleEvent(e,t,i)})}}saveActivity(e,t,i){if(this.db)if(t instanceof P||P.is(t)){let n=t instanceof P?t:function(e){let t=null;return j.is(e)?t=new j(e):O.is(e)?t=new O(e):O.is(e)?t=new R(e):B.is(e)?t=new B(e):U.is(e)?t=new U(e):new Error("Unknown activity type"),t}(t);if(n){n.identity=e.identity;let t=this.db.transaction(["activity"],"readwrite").objectStore("activity").put(n);t.onerror=function(e){D(e)},t.onsuccess=function(){i&&i()}}}else{let n=this.db.transaction(["activity"],"readwrite").objectStore("activity"),s=t.slice(0),o=this,a=function(){let t=s.pop();if(t){let i=t;i.identity=e.identity;let s=n.put(o.cleanRecord(i));s.onerror=a,s.onsuccess=a}else i&&i()};a()}else{let n=this;this.invocationQueue.push(function(){n.saveActivity(e,t,i)})}}getActivity(e,t,i){if(this.db){let n=this.db.transaction(["activity"],"readonly").objectStore("activity").index(z),s=[e.identity,t];this.getAll(n,IDBKeyRange.only(s),i)}else{let n=this;this.invocationQueue.push(function(){n.getActivity(e,t,i)})}}getActivityById(e,t,i,n){if(this.db){let s=[e.identity,t,i],o=this.db.transaction(["activity"],"readonly").objectStore("activity").get(s);o.onerror=function(e){D(e)},o.onsuccess=function(){let e=o.result;null!=e?n(e):n()}}else{let s=this;this.invocationQueue.push(function(){s.getActivityById(e,t,i,n)})}}removeActivity(e,t,i,n){if(this.db){let s=this.db.transaction(["activity"],"readwrite").objectStore("activity").delete(IDBKeyRange.only([e.identity,i,t]));s.onerror=function(e){D(e)},s.onsuccess=function(){n&&n()}}else{let s=this;this.invocationQueue.push(function(){s.removeActivity(e,t,i,n)})}}saveOutgoingActivity(e,t,i){if(this.db){let n=t;n.identity=e.identity;let s=this.db.transaction(["outgoingActivity"],"readwrite").objectStore("outgoingActivity").put(n);s.onerror=function(e){D(e)},s.onsuccess=function(){i&&i()}}else{let n=this;this.invocationQueue.push(function(){n.saveOutgoingActivity(e,t,i)})}}getOutgoingActivity(e,t){if(this.db){let i=this.db.transaction(["outgoingActivity"],"readonly").objectStore("outgoingActivity").index(z),n=e.identity,s=this;this.getAll(i,IDBKeyRange.only(n),function(e){0==e.length?s.getAll(i,IDBKeyRange.only([n]),t):t(e)})}else{let i=this;this.invocationQueue.push(function(){i.getOutgoingActivity(e,t)})}}removeOutgoingActivity(e,t,i){if(this.db){let n=this.db.transaction(["outgoingActivity"],"readwrite").objectStore("outgoingActivity").delete(IDBKeyRange.only([e.identity,t.id]));i&&(n.onerror=i,n.onsuccess=i)}else{let n=this;this.invocationQueue.push(function(){n.removeOutgoingActivity(e,t,i)})}}}class H{constructor(e){this.pebl=e}isLoggedIn(e){this.pebl.storage.getCurrentUser(function(t){e(null!=t)})}getUser(e){let t=this;this.pebl.storage.getCurrentUser(function(i){i?t.pebl.storage.getUserProfile(i,function(t){t?e(t):e()}):e()})}}const Q="annotations",K="sharedAnnotations",J="threads",Z="privateThreads",W="groupThreads",$="references";function Y(e){return K+"_"+e}const ee="_user-",te="_group-";class ie{constructor(e){this.DEFAULT_RECONNECTION_BACKOFF=1e3,this.notificationTimestamps={},this.clearedNotifications={};var t=this;this.serverReady=!1,this.pebl=e,this.reconnectionBackoff=this.DEFAULT_RECONNECTION_BACKOFF,this.active=!1,N(this.pebl.config&&this.pebl.config.PeBLServicesWSURL),this.messageHandlers={},this.messageHandlers.serverReady=((e,t)=>{this.serverReady=!0,this.pullAnnotations(),this.pullSharedAnnotations(),this.pullReferences(),this.pullSubscribedThreads()}),this.messageHandlers.setLastNotifiedDates=((e,t)=>{for(let e in t.clearedTimestamps)this.notificationTimestamps[e]=parseInt(t.clearedTimestamps[e]);for(let e of t.clearedNotifications)this.clearedNotifications[e]=!0}),this.messageHandlers.removeClearedNotifications=((e,t)=>{for(let e of t.clearedTimestamps)this.notificationTimestamps[e]=t.clearedTimestamps[e];for(let e of t.clearedNotifications)delete this.clearedNotifications[e]}),this.messageHandlers.getReferences=((e,i)=>{this.pebl.storage.getSyncTimestamps(e.identity,$,n=>{for(let s of i.data)if(g.is(s))N("TODO");else{let i=new d(s);t.pebl.storage.saveQueuedReference(e,i);let o=new Date(i.stored).getTime();!this.clearedNotifications[i.id]&&o>=(this.notificationTimestamps["r"+i.book]||0)&&(t.pebl.storage.saveNotification(e,i,()=>{}),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[i])),o>n&&(n=o)}this.pebl.storage.saveSyncTimestamps(e.identity,$,n,()=>{})})}),this.messageHandlers.newReference=((e,i)=>{this.pebl.storage.getSyncTimestamps(e.identity,$,n=>{if(g.is(i.data))N("TODO");else{let s=new d(i.data);t.pebl.storage.saveQueuedReference(e,s);let o=new Date(s.stored).getTime();!this.clearedNotifications[s.id]&&o>=(this.notificationTimestamps["r"+s.book]||0)&&(t.pebl.storage.saveNotification(e,s,()=>{}),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[s])),o>n&&(n=o),this.pebl.storage.saveSyncTimestamps(e.identity,$,n,()=>{})}})}),this.messageHandlers.getThreadedMessages=((e,t)=>{let i;i=t.data instanceof Array?t.data:[t.data],this.pebl.utils.getThreadTimestamps(e.identity,(t,n,s)=>{i.forEach(i=>{let o=i.options&&i.options.groupId,a=i.options&&i.options.isPrivate,r=i.thread;for(let d of i.data)o?this.handleGroupMessage(e,d,r,o,s):a?this.handlePrivateMessage(e,d,r,n):this.handleMessage(e,d,r,t)}),this.pebl.utils.saveThreadTimestamps(e.identity,t,n,s,()=>{})})}),this.messageHandlers.newThreadedMessage=((e,t)=>{let i=t.options&&t.options.groupId,n=t.options&&t.options.isPrivate,s=t.thread;this.pebl.utils.getThreadTimestamps(e.identity,(o,a,r)=>{i?this.handleGroupMessage(e,t.data,s,i,r):n?this.handlePrivateMessage(e,t.data,s,a):this.handleMessage(e,t.data,s,o),this.pebl.utils.saveThreadTimestamps(e.identity,o,a,r,()=>{})})}),this.messageHandlers.getSubscribedThreads=((e,i)=>{t.websocket&&1===t.websocket.readyState&&this.pebl.utils.getThreadTimestamps(e.identity,(t,n,s)=>{let o=[];for(let e of i.data.threads){let i={thread:e,options:{},timestamp:t[e]?t[e]:1};o.push(i)}for(let e of i.data.privateThreads){let t={thread:e,options:{isPrivate:!0},timestamp:n[e]?n[e]:1};o.push(t)}for(let e in i.data.groupThreads)for(let t of i.data.groupThreads[e]){let i,n={thread:t,options:{groupId:e},timestamp:i=s[e]?s[e][t]:1};o.push(n)}this.websocket&&this.websocket.send(JSON.stringify({requestType:"getThreadedMessages",identity:e.identity,requests:o}))})}),this.messageHandlers.getAnnotations=((e,t)=>{this.pebl.storage.getSyncTimestamps(e.identity,Q,i=>{let n=t.data.map(t=>{if(g.is(t)){let n=new g(t);this.pebl.storage.removeAnnotation(e,n.target);let s=new Date(n.stored).getTime();return s>i&&(i=s),n}{let n=new l(t);this.pebl.storage.saveAnnotations(e,[n]);let s=new Date(n.stored).getTime();return s>i&&(i=s),n}});this.pebl.storage.saveSyncTimestamps(e.identity,Q,i,()=>{this.pebl.emitEvent(this.pebl.events.incomingAnnotations,n)})})}),this.messageHandlers.getSharedAnnotations=((e,i)=>{for(let n of i.data)this.pebl.storage.getSyncTimestamps(e.identity,Y(n.groupId),i=>{let s;if(g.is(n)){s=new g(n),t.pebl.storage.removeSharedAnnotation(e,s.target),t.pebl.storage.removeNotification(e,s.target),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[s]);let o=new Date(s.stored).getTime();o>i&&(i=o)}else{s=new c(n),t.pebl.storage.saveSharedAnnotations(e,[s]);let o=new Date(s.stored).getTime();o>=(this.notificationTimestamps["sa"+s.book]||0)&&!this.clearedNotifications[s.id]&&(e.identity!==s.getActorId()?(this.pebl.storage.saveNotification(e,s),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[s])):this.pebl.storage.saveOutgoingXApi(e,{id:s.id,identity:e.identity,requestType:"deleteNotification",records:[{id:s.id,type:"sharedAnnotation",location:s.book,stored:s.stored}]})),o>i&&(i=o)}this.pebl.storage.saveSyncTimestamps(e.identity,Y(n.groupId),i,()=>{t.pebl.emitEvent(t.pebl.events.incomingSharedAnnotations,[s])})})}),this.messageHandlers.newAnnotation=((e,i)=>{let n;n=i.data instanceof Array?i.data:[i.data],this.pebl.storage.getSyncTimestamps(e.identity,Q,i=>{let s=n.map(n=>{g.is(n)?(n=new g(n),t.pebl.storage.removeAnnotation(e,n.target)):(n=new l(n),t.pebl.storage.saveAnnotations(e,[n]));let s=new Date(n.stored).getTime();return s>i&&(i=s),n});this.pebl.storage.saveSyncTimestamps(e.identity,Q,i,()=>{t.pebl.emitEvent(t.pebl.events.incomingAnnotations,s)})})}),this.messageHandlers.newSharedAnnotation=((e,t)=>{let i;i=t.data instanceof Array?t.data:[t.data];for(let t of i)this.pebl.storage.getSyncTimestamps(e.identity,Y(t.groupId),i=>{g.is(t)?(t=new g(t),this.pebl.storage.removeSharedAnnotation(e,t.target),this.pebl.storage.removeNotification(e,t.target),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[t])):(t=new c(t),this.pebl.storage.saveSharedAnnotations(e,[t]));let n=new Date(t.stored).getTime();t instanceof c&&n>=(this.notificationTimestamps["sa"+t.book]||0)&&!this.clearedNotifications[t.id]&&(e.identity!==t.getActorId()?(this.pebl.storage.saveNotification(e,t),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[t])):this.pebl.storage.saveOutgoingXApi(e,{id:t.id,identity:e.identity,requestType:"deleteNotification",records:[{id:t.id,type:"sharedAnnotation",location:t.book,stored:t.stored}]})),n>i&&(i=n),this.pebl.storage.saveSyncTimestamps(e.identity,Y(t.groupId),i,()=>{this.pebl.emitEvent(this.pebl.events.incomingSharedAnnotations,[t])})})}),this.messageHandlers.loggedOut=((e,i)=>{window.PeBLConfig&&window.PeBLConfig.guestLogin&&"guest"===e.identity||t.pebl.storage.removeCurrentUser(()=>{this.notificationTimestamps={},this.clearedNotifications={},t.pebl.emitEvent(t.pebl.events.eventRefreshLogin,null)})}),this.messageHandlers.requestUpload=((e,t)=>{this.pebl.network.uploadAsset(t.filename,t.activityId)}),this.messageHandlers.error=((e,t)=>{N("Message failed",t)}),this.messageHandlers.getChapterCompletionPercentages=((e,t)=>{this.pebl.emitEvent(this.pebl.events.getChapterCompletionPercentages,t.data)}),this.messageHandlers.getMostAnsweredQuestions=((e,t)=>{this.pebl.emitEvent(this.pebl.events.getMostAnsweredQuestions,t.data)}),this.messageHandlers.getLeastAnsweredQuestions=((e,t)=>{this.pebl.emitEvent(this.pebl.events.getLeastAnsweredQuestions,t.data)}),this.messageHandlers.getQuizAttempts=((e,t)=>{this.pebl.emitEvent(this.pebl.events.getQuizAttempts,t.data)}),this.messageHandlers.getReportedThreadedMessages=((e,t)=>{this.pebl.emitEvent(this.pebl.events.getReportedThreadedMessages,t.data)})}activate(e){if(!this.active){this.active=!0,this.reconnectionBackoff=this.DEFAULT_RECONNECTION_BACKOFF;let e=()=>{this.pebl.config&&this.pebl.config.PeBLServicesWSURL&&(this.websocket&&(this.websocket.close(),this.websocket=void 0),this.websocket=new WebSocket(this.pebl.config.PeBLServicesWSURL),this.websocket.onopen=(()=>{N("websocket opened"),this.reconnectionBackoffResetHandler=setTimeout(()=>{this.reconnectionBackoff=this.DEFAULT_RECONNECTION_BACKOFF},this.DEFAULT_RECONNECTION_BACKOFF)}),this.websocket.onclose=(()=>{N("Web socket closed retrying in "+this.reconnectionBackoff,event),this.serverReady=!1,this.active&&(this.reconnectionBackoffResetHandler&&(clearTimeout(this.reconnectionBackoffResetHandler),this.reconnectionBackoffResetHandler=void 0),this.reconnectionTimeoutHandler&&clearTimeout(this.reconnectionTimeoutHandler),this.reconnectionTimeoutHandler=setTimeout(()=>{e(),this.reconnectionBackoff*=2,this.reconnectionBackoff>6e4&&(this.reconnectionBackoff=6e4)},this.reconnectionBackoff))}),this.websocket.onerror=(t=>{N("Web socket error retrying in "+this.reconnectionBackoff,t),this.serverReady=!1,this.active&&(this.reconnectionBackoffResetHandler&&(clearTimeout(this.reconnectionBackoffResetHandler),this.reconnectionBackoffResetHandler=void 0),this.reconnectionTimeoutHandler&&clearTimeout(this.reconnectionTimeoutHandler),this.reconnectionTimeoutHandler=setTimeout(()=>{e(),this.reconnectionBackoff*=2,this.reconnectionBackoff>6e4&&(this.reconnectionBackoff=6e4)},this.reconnectionBackoff))}),this.websocket.onmessage=(e=>{this.pebl.user.getUser(t=>{if(t){N("message recieved");var i=JSON.parse(e.data);this.messageHandlers[i.requestType]?this.messageHandlers[i.requestType](t,i):N("Unknown request type",i.requestType,i)}})}))};e()}e&&e()}disable(e){if(this.active)if(this.active=!1,this.reconnectionTimeoutHandler&&(clearTimeout(this.reconnectionTimeoutHandler),this.reconnectionTimeoutHandler=void 0),this.websocket){let t=()=>{this.websocket&&(this.websocket.bufferedAmount>0?setTimeout(t,50):(this.websocket.close(),e&&e()))};t()}else e&&e();else e&&e()}mergeRequests(e){let t=[],i={};for(let t=0;t<e.length;t++){let n=e[t],s=i[n.identity];s||(s={},i[n.identity]=s),s[n.requestType]||(s[n.requestType]=[]),s[n.requestType].push(n)}for(let e in i){let n=i[e];for(let i in n){let s=n[i],o={requestType:i,identity:e};for(let e of s)for(let t of Object.keys(e))if("id"!==t&&"requestType"!==t&&"identity"!==t){let i=e[t];if(o[t]||(o[t]=[]),i instanceof Array)o[t].push(...i);else{if(!("string"==typeof i||"number"==typeof i||i instanceof Object))throw new Error("unknown merge type");o[t].push(i)}}t.push(o)}}return t}push(e,t){this.pebl.user.getUser(i=>{i&&this.serverReady&&this.websocket&&1===this.websocket.readyState?(this.websocket.send(JSON.stringify({requestType:"bulkPush",identity:i.identity,data:this.mergeRequests(e)})),t(!0)):t(!1)})}pushActivity(e,t){this.pebl.user.getUser(i=>{if(i&&this.serverReady&&this.websocket&&1===this.websocket.readyState){for(let t of e)N(t),this.websocket.send(JSON.stringify(t));t(!0)}else t(!1)})}pullAnnotations(){this.pebl.user.getUser(e=>{e&&this.websocket&&1===this.websocket.readyState&&this.pebl.storage.getSyncTimestamps(e.identity,Q,t=>{let i={identity:e.identity,requestType:"getAnnotations",timestamp:t+1};this.websocket&&this.websocket.send(JSON.stringify(i))})})}pullSharedAnnotations(){this.pebl.user.getUser(e=>{if(e&&this.websocket&&1===this.websocket.readyState&&e.groups)for(let t of e.groups)(t=>{this.pebl.storage.getSyncTimestamps(e.identity,Y(t),i=>{let n={identity:e.identity,requestType:"getSharedAnnotations",timestamp:i+1,groupId:t};this.websocket&&this.websocket.send(JSON.stringify(n))}),this.pebl.storage.saveOutgoingXApi(e,{id:this.pebl.utils.getUuid(),identity:e.identity,requestType:"subscribeSharedAnnotations",groupId:t})})(t)})}pullReferences(){this.pebl.user.getUser(e=>{e&&this.websocket&&1===this.websocket.readyState&&this.pebl.storage.getSyncTimestamps(e.identity,$,t=>{let i={identity:e.identity,requestType:"getReferences",timestamp:t+1};this.websocket&&this.websocket.send(JSON.stringify(i))})})}pullSubscribedThreads(){this.pebl.user.getUser(e=>{if(e&&this.websocket&&1===this.websocket.readyState){let t={identity:e.identity,requestType:"getSubscribedThreads"};this.websocket.send(JSON.stringify(t))}})}handlePrivateMessage(e,t,i,n){let s;g.is(t)?(s=new g(t),this.pebl.storage.removeMessage(e,s.target)):(s=new h(t),this.pebl.storage.saveMessages(e,[s]));let o=new Date(s.stored).getTime();n[i]||(n[i]=1),o>n[i]&&(n[i]=o),this.pebl.emitEvent(i+ee+e.identity,[s])}handleGroupMessage(e,t,i,n,s){let o;g.is(t)?(o=new g(t),this.pebl.storage.removeMessage(e,o.target),this.pebl.storage.removeNotification(e,o.target),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[o])):(o=new h(t),this.pebl.storage.saveMessages(e,[o]));let a=new Date(o.stored).getTime();o instanceof h&&a>=(this.notificationTimestamps[o.thread]||0)&&!this.clearedNotifications[o.id]&&(e.identity!==o.getActorId()?(this.pebl.storage.saveNotification(e,o),this.pebl.emitEvent(this.pebl.events.incomingNotifications,[o])):this.pebl.storage.saveOutgoingXApi(e,{id:o.id,identity:e.identity,requestType:"deleteNotification",records:[{id:o.id,type:"message",location:o.thread,stored:o.stored}]})),s[n]||(s[n]={}),s[n][i]||(s[n][i]=1),a>s[n][i]&&(s[n][i]=a),this.pebl.emitEvent(i+te+n,[o])}handleMessage(e,t,i,n){let s;g.is(t)?(s=new g(t),this.pebl.storage.removeMessage(e,s.target),this.pebl.storage.removeNotification(e,s.target)):(s=new h(t),this.pebl.storage.saveMessages(e,[s]));let o=new Date(s.stored).getTime();n[i]||(n[i]=1),o>n[i]&&(n[i]=o),this.pebl.emitEvent(i,[s])}}class ne{constructor(e){this.pushTimeout=void 0,this.pushActivityTimeout=void 0,this.pullAssetTimeout=void 0,this.pebl=e,this.running=!1,this.syncingProcess=new ie(e)}activate(e){this.running?e&&e():(this.running=!0,this.syncingProcess.activate(()=>{this.push(),this.pushActivity(),this.pullAsset(),e&&e()}))}queueReference(e){let t=this;this.pebl.user.getUser(function(i){i&&t.pebl.storage.saveQueuedReference(i,e,t.pullAsset.bind(t))})}retrievePresence(){}uploadAsset(e,t){return new Promise((i,n)=>{this.pebl.storage.getAsset(e).then(s=>{if(this.pebl.config&&this.pebl.config.PeBLServicesURL){let o=new FormData;o.append("activityId",t),o.append("mediaId",e),o.append("media",s),fetch(this.pebl.config.PeBLServicesURL+"/user/media",{credentials:"include",method:"POST",body:o}).then(e=>{console.log(e),i(e.statusText)}).catch(e=>{console.error(e),n()})}}).catch(()=>{n()})})}fetchAsset(e){return new Promise((t,i)=>{this.pebl.config&&this.pebl.config.PeBLServicesURL&&fetch(this.pebl.config.PeBLServicesURL+"/user/media?mediaId="+e,{credentials:"include",method:"GET"}).then(e=>e.blob()).then(i=>{console.log(i),t(new File([i],e))}).catch(e=>{console.error(e),i()})})}pullAsset(){this.pebl.user.getUser(e=>{e&&e.registryEndpoint?this.pebl.storage.getCurrentBook(t=>{t?this.pebl.storage.getQueuedReference(e,t,t=>{t?this.pebl.storage.getToc(e,t.book,i=>{if(i.length>0){let i={url:t.url,documentName:t.name,section:t.location,pageKey:t.id,docType:t.docType,card:t.card,externalURL:t.externalURL};this.pebl.storage.saveToc(e,t.book,i),this.pebl.emitEvent(this.pebl.events.incomingNotification,t),this.pebl.emitEvent(this.pebl.events.updatedToc,t.book),this.pebl.storage.removeQueuedReference(e,t.id),this.running&&(this.pullAssetTimeout=setTimeout(this.pullAsset.bind(this),5e3))}else this.pullAssetTimeout=setTimeout(this.pullAsset.bind(this),5e3)}):this.running&&(this.pullAssetTimeout=setTimeout(this.pullAsset.bind(this),5e3))}):this.running&&(this.pullAssetTimeout=setTimeout(this.pullAsset.bind(this),5e3))}):this.running&&(this.pullAssetTimeout=setTimeout(this.pullAsset.bind(this),5e3))})}disable(e){this.running?(this.running=!1,this.pushTimeout&&clearTimeout(this.pushTimeout),this.pushTimeout=void 0,this.pullAssetTimeout&&clearTimeout(this.pullAssetTimeout),this.pullAssetTimeout=void 0,this.syncingProcess.disable(()=>{e&&e()})):e&&e()}pushActivity(e){this.pushActivityTimeout&&(clearTimeout(this.pushActivityTimeout),this.pushActivityTimeout=void 0),this.pebl.user.getUser(t=>{t?this.pebl.storage.getOutgoingActivity(t,i=>{i.length>0?this.syncingProcess.pushActivity(i,n=>{n&&this.pebl.storage.removeOutgoingActivity(t,i),this.running&&(this.pushActivityTimeout=setTimeout(this.pushActivity.bind(this),5e3)),e&&e()}):(this.running&&(this.pushActivityTimeout=setTimeout(this.pushActivity.bind(this),5e3)),e&&e())}):this.running&&(this.pushActivityTimeout=setTimeout(this.pushActivity.bind(this),5e3))})}push(e){this.pushTimeout&&(clearTimeout(this.pushTimeout),this.pushTimeout=void 0),this.pebl.user.getUser(t=>{t?this.pebl.storage.getOutgoingXApi(t,i=>{i.length>0?this.syncingProcess.push(i,n=>{n&&this.pebl.storage.removeOutgoingXApi(t,i),this.running&&(this.pushTimeout=setTimeout(this.push.bind(this),2e3)),e&&e()}):(this.running&&(this.pushTimeout=setTimeout(this.push.bind(this),2e3)),e&&e())}):(this.running&&(this.pushTimeout=setTimeout(this.push.bind(this),2e3)),e&&e())})}}class se{constructor(){this.incomingAnnotations="incomingAnnotations",this.incomingSharedAnnotations="incomingSharedAnnotations",this.incomingNotifications="incomingNotifications",this.incomingAssets="incomingAssets",this.incomingEvents="incomingEvents",this.incomingPresence="incomingPresence",this.incomingLearnlet="incomingLearnlet",this.incomingProgram="incomingProgram",this.incomingInstitution="incomingInstitution",this.incomingSystem="incomingSystem",this.incomingArtifact="incomingArtifact",this.incomingMembership="incomingMembership",this.incomingActivityEvents="incomingActivityEvents",this.incomingModuleEvents="incomingModuleEvents",this.incomingErrors="incomingErrors",this.updatedToc="updatedToc",this.saveProgram="saveProgram",this.saveProgramConflict="saveProgramConflict",this.saveProgramSuccess="saveProgramSuccess",this.saveProgramError="saveProgramError",this.saveInstitution="saveInstitution",this.saveSystem="saveSystem",this.newBookNoReset="newBookNoReset",this.newLearnlet="newLearnlet",this.newBook="newBook",this.newMessage="newMessage",this.newActivity="newActivity",this.newAnnotation="newAnnotation",this.newReference="newReference",this.newPresence="newPresence",this.newMembership="newMembership",this.newSharedAnnotation="newSharedAnnotation",this.newArtifact="newArtifact",this.modifiedMembership="modifiedMembership",this.pinnedMessage="pinnedMessage",this.unpinnedMessage="unpinnedMessage",this.pinnedAnnotation="pinnedAnnotation",this.unpinnedAnnotation="unpinnedAnnotation",this.reportedMessage="reportedMessage",this.removedPresence="removedPresence",this.removedMembership="removedMembership",this.removedAnnotation="removedAnnotation",this.removedSharedAnnotation="removedSharedAnnotation",this.removedLearnlet="removedLearnlet",this.removedProgram="removedProgram",this.removedMessage="removedMessage",this.eventRefreshLogin="eventRefreshLogin",this.eventLoggedIn="eventLoggedIn",this.eventLoggedOut="eventLoggedOut",this.eventLogin="eventLogin",this.eventLogout="eventLogout",this.eventFinishedLogin="eventFinishedLogin",this.eventSessionStart="eventSessionStart",this.eventSessionStop="eventSessionStop",this.eventNextPage="eventNextPage",this.eventPrevPage="eventPrevPage",this.eventJumpPage="eventJumpPage",this.eventInitialized="eventInitialized",this.eventTerminated="eventTerminated",this.eventInteracted="eventInteracted",this.eventAttempted="eventAttempted",this.eventPassed="eventPassed",this.eventFailed="eventFailed",this.eventPreferred="eventPreferred",this.eventContentMorphed="eventContentMorphed",this.eventExperienced="eventExperienced",this.eventDisliked="eventDisliked",this.eventLiked="eventLiked",this.eventAccessed="eventAccessed",this.eventHid="eventHid",this.eventShowed="eventShowed",this.eventDisplayed="eventDisplayed",this.eventUndisplayed="eventUndisplayed",this.eventSelected="eventSelected",this.eventDiscarded="eventDiscarded",this.eventBookmarked="eventBookmarked",this.eventUnbookmarked="eventUnbookmarked",this.eventUnsharedAnnotation="eventUnsharedAnnotation",this.eventAnnotated="eventAnnotated",this.eventUnannotated="eventUnannotated",this.eventNoted="eventNoted",this.eventSearched="eventSearched",this.eventCompleted="eventCompleted",this.eventLaunched="eventLaunched",this.eventCompatibilityTested="eventCompatibilityTested",this.eventChecklisted="eventChecklisted",this.eventHelped="eventHelped",this.eventInvited="eventInvited",this.eventUninvited="eventUninvited",this.eventSubmitted="eventSubmitted",this.eventUploadedMedia="eventUploadedMedia",this.eventProgramLevelUp="eventProgramLevelUp",this.eventProgramLevelDown="eventProgramLevelDown",this.eventProgramInvited="eventProgramInvited",this.eventProgramUninvited="eventProgramUninvited",this.eventProgramJoined="eventProgramJoined",this.eventProgramExpelled="eventProgramExpelled",this.eventProgramActivityLaunched="eventProgramActivityLaunched",this.eventProgramActivityCompleted="eventProgramActivityCompleted",this.eventProgramActivityTeamCompleted="eventProgramActivityTeamCompleted",this.eventProgramModified="eventProgramModified",this.eventProgramDeleted="eventProgramDeleted",this.eventProgramCompleted="eventProgramCompleted",this.eventProgramCopied="eventProgramCopied",this.eventProgramDiscussed="eventProgramDiscussed",this.eventModuleRating="eventModuleRating",this.eventModuleFeedback="eventModuleFeedback",this.eventModuleExample="eventModuleExample",this.eventModuleExampleRating="eventModuleExampleRating",this.eventModuleExampleFeedback="eventModuleExampleFeedback",this.moduleRemovedEvent="moduleRemovedEvent",this.totalInstitutionActivities="totalInstitutionActivities",this.getChapterCompletionPercentages="getChapterCompletionPercentages",this.getMostAnsweredQuestions="getMostAnsweredQuestions",this.getLeastAnsweredQuestions="getLeastAnsweredQuestions",this.getQuizAttempts="getQuizAttempts",this.getReportedThreadedMessages="getReportedThreadedMessages"}}i(7);var oe=i(16);class ae{constructor(e){this.pebl=e}getAnnotations(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getCurrentBookId(function(n){n?t.pebl.storage.getAnnotations(i,n,e):e([])}):e([])})}getSharedAnnotations(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getCurrentBookId(function(n){n?t.pebl.storage.getSharedAnnotations(i,n,e):e([])}):e([])})}initializeToc(e){let t=this;this.pebl.user.getUser(function(i){i&&t.pebl.storage.getCurrentBook(function(n){n&&t.pebl.storage.getToc(i,n,function(s){if(0==s.length)for(let s in e){let o=e[s];for(let e in o){let a=o[e];if("DynamicContent"==e){let e=a.documents;for(let s in e){let o=e[s];o.pageKey=s,t.pebl.storage.saveToc(i,n,o)}}else a.pageKey=e,a.section=s,t.pebl.storage.saveToc(i,n,a)}}})})})}getToc(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getCurrentBook(function(n){n?t.pebl.storage.getToc(i,n,function(t){let i={};for(let e=0;e<t.length;e++){let n=t[e],s=n.section;null==i[s]&&(i[s]={});let o=i[s];if("DynamicContent"==s){null==o.documents&&(o.location=n.location,o.documents={}),o.documents[n.pageKey]=n}else o[n.pageKey]=n}e(i)}):e({})}):e({})})}removeToc(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.getCurrentBook(function(s){s&&i.pebl.storage.removeToc(n,s,t,e)})})}pullProgram(e,t){let i=this;i.pebl.user.getUser(function(n){if(n){let n=i.pebl.network;n&&n.syncingProcess&&n.syncingProcess.length>0&&n.syncingProcess[0].pullActivity("program",e,function(e){e?t(e):t()})}})}mergePrograms(e,t){return j.merge(e,t)}mergeInstitutions(e,t){return B.merge(e,t)}mergeSystems(e,t){return U.merge(e,t)}getProgram(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.getActivityById(n,"program",e,function(e){e?t(e):t()})})}getInstitution(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.getActivityById(n,"institution",e,function(e){e?t(e):t()})})}getSystem(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.getActivityById(n,"system",e,function(e){e?t(e):t()})})}isProgramMember(e,t){return j.isMember(e,t)}isInstitutionMember(e,t){return B.isMember(e,t)}isProgramMemberOfInstitution(e,t){return B.isProgram(e,t)}isSystemMember(e,t){return U.isMember(e,t)}removeProgram(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.removeActivity(n,e,"program",t)})}removeInstitution(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.removeActivity(n,e,"institution",t)})}newEmptyProgram(e){e(new j({}))}newEmptyInstitution(e){e(new B({}))}newEmptySystem(e){e(new U({}))}getGroupMemberships(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getGroupMembership(i,e):e([])})}getSpecificGroupMembership(e,t){let i=this;this.pebl.user.getUser(function(n){n?i.pebl.storage.getGroupMembership(n,function(i){let n=null;for(let t of i)t.membershipId===e&&(n=t);t(n)}):t(null)})}removeGroupMembership(e,t){let i=this;this.pebl.user.getUser(function(n){n&&i.pebl.storage.removeGroupMembership(n,e,t)})}getPrograms(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getActivity(i,"program",function(t){e(t)}):e([])})}getInstitutions(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getActivity(i,"institution",function(t){e(t)}):e([])})}getSystems(e){let t=this;this.pebl.user.getUser(function(i){i?t.pebl.storage.getActivity(i,"system",function(t){e(t)}):e([])})}getUuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}getInviteToken(e,t){this.pebl.user.getUser(function(i){if(i){let o=new XMLHttpRequest;var n=i.endpoints[0],s=[{$match:{$and:[{"statement.verb.id":{$in:["http://www.peblproject.com/definitions.html#invited"]}},{"statement.object.definition.name.en-US":{$in:[e]}}]}}];o.addEventListener("load",function(){let e=JSON.parse(o.responseText);for(let t=0;t<e.length;t++){let i=e[t];i.voided?e.splice(t,1):e[t]=i.statement}null!=t&&t(e)}),o.addEventListener("error",function(){t([])}),o.open("GET",n.url+"api/statements/aggregate?pipeline="+encodeURIComponent(JSON.stringify(s)),!0),o.setRequestHeader("Authorization","Basic "+n.token),o.setRequestHeader("Content-Type","application/json"),o.send()}})}getProgramActivityEvents(e,t){let i=this;this.pebl.storage.getActivityEvent(e,function(e){t(e.sort(i.sortByTimestamp))})}sortByTimestamp(e,t){return new Date(t.timestamp).getTime()-new Date(e.timestamp).getTime()}iterateProgramMembers(e,t){j.iterateMembers(e,t)}getProgramMembers(e){return j.getMembers(e)}iterateInstitutionMembers(e,t){B.iterateMembers(e,t)}iterateInstitutionPrograms(e,t){B.iteratePrograms(e,t)}iterateSystemMembers(e,t){U.iterateMembers(e,t)}newTempMember(e,t){t(new I(e))}getNotifications(e){let t=this;t.pebl.user.getUser(function(i){i?t.pebl.storage.getNotifications(i,function(t){e(t)}):e([])})}removeNotification(e){let t=this;t.pebl.user.getUser(function(i){i&&t.pebl.storage.getNotification(i,e,n=>{if(n){let s,o;t.pebl.storage.removeNotification(i,e),c.is(n)?(s="sharedAnnotation",o=n.book):h.is(n)?(s="message",o=n.thread):d.is(n)&&(s="reference",o=n.book),t.pebl.storage.saveOutgoingXApi(i,{id:t.pebl.utils.getUuid(),identity:i.identity,requestType:"deleteNotification",records:[{id:n.id,type:s,location:o,stored:n.stored}]})}})})}getMessages(e,t){let i=this;i.pebl.user.getUser(function(n){n?i.pebl.storage.getMessages(n,e,function(e){t(e)}):t([])})}getModuleEvents(e,t,i){let n=this;n.pebl.user.getUser(function(s){s?n.pebl.storage.getModuleEvent(e,function(e){t(i?e.filter(e=>e.verb.display["en-US"]===i):e)}):t([])})}removeModuleEvent(e,t){let i=this;i.pebl.user.getUser(function(n){n&&i.pebl.storage.removeModuleEvent(e,t)})}getEvents(e){let t=this;t.pebl.user.getUser(function(i){i?t.pebl.storage.getCurrentBook(function(n){n?t.pebl.storage.getEvents(i,n,e):e([])}):e([])})}getThreadTimestamps(e,t){this.pebl.storage.getCompoundSyncTimestamps(e,J,i=>{this.pebl.storage.getCompoundSyncTimestamps(e,Z,n=>{this.pebl.storage.getCompoundSyncTimestamps(e,W,e=>{t(i,n,e)})})})}saveThreadTimestamps(e,t,i,n,s){this.pebl.storage.saveCompoundSyncTimestamps(e,J,t,()=>{this.pebl.storage.saveCompoundSyncTimestamps(e,Z,i,()=>{this.pebl.storage.saveCompoundSyncTimestamps(e,W,n,()=>{s()})})})}}const re="https://www.peblproject.com/definitions.html#",de="http://www.peblproject.com/activities/";class le{addExtensions(e){let t={};for(let i of Object.keys(e))t[re+i]=e[i];return t}addResult(e,t,i,n,s,o,a,r,d){if(e.result||(e.result={}),e.result.success=o,e.result.completion=s,e.result.response=a,e.result.score||(e.result.score={}),e.result.score.raw=t,e.result.score.duration=r,e.result.score.scaled=(t-i)/(n-i),e.result.score.min=i,e.result.score.max=n,d){e.result.extensions||(e.result.extensions={});for(let t of Object.keys(d))e.result.extensions[t]=d[t]}return e}addResultResponse(e,t,i,n,s){if(e.result||(e.result={}),e.result.response=t,e.result.completion=i,n&&(e.result.duration=n),s){e.result.extensions||(e.result.extensions={});for(let t of Object.keys(s))e.result.extensions[t]=s[t]}return e}addObject(e,t,i,n,s,o){return e.object||(e.object={}),e.object.id=t,e.object.objectType="Activity",e.object.definition||(e.object.definition={}),i&&(e.object.definition.name||(e.object.definition.name={}),e.object.definition.name["en-US"]=i),n&&(e.object.definition.description||(e.object.definition.description={}),e.object.definition.description["en-US"]=n),s&&(e.object.definition.type=s),o&&(e.object.definition.extensions=o),e}memberToIndex(e,t){for(let i=0;i<t.length;i++)if(e==t[i])return i;return-1}arrayToIndexes(e,t){let i=e.slice(0);for(let n=0;n<e.length;n++)i[n]=this.memberToIndex(e[n],t).toString();return i}addObjectInteraction(e,t,i,n,s,o,a,r){e.object||(e.object={}),e.object.id=t,e.object.objectType="Activity",e.object.definition||(e.object.definition={}),e.object.definition.name||(e.object.definition.name={}),e.object.definition.type="http://adlnet.gov/expapi/activities/cmi.interaction",e.object.definition.interactionType=s;let d=[];for(let e of a)d.push(this.arrayToIndexes(e,o).join("[,]"));if(e.object.definition.correctResponsesPattern=d,"choice"==s){e.object.definition.choices=[];let t=0;for(let i of o)e.object.definition.choices.push({id:t.toString(),description:{"en-US":i}}),t++}return e.object.definition.name["en-US"]=i,e.object.definition.description||(e.object.definition.description={}),e.object.definition.description["en-US"]=n,r&&(e.object.definition.extensions=r),e}addVerb(e,t,i){return e.verb={id:t,display:{"en-US":i}},e}addActorAccount(e,t){return e.actor||(e.actor={}),e.actor.objectType="Agent",e.actor.name=t.name||t.identity,e.actor.account={homePage:t.homePage,name:t.identity},e}addActorMBox(e,t){return e.actor||(e.actor={}),e.actor.objectType="Agent",e.actor.name=t.name,e.actor.mbox=t.identity,e}addTimestamp(e){return e.timestamp||(e.timestamp=(new Date).toISOString()),e}addStatementRef(e,t){return e.object||(e.object={}),e.object.objectType="StatementRef",e.object.id=t,e}addId(e){
/*!
          Excerpt from: Math.uuid.js (v1.4)
          http://www.broofa.com
          mailto:robert@broofa.com
          Copyright (c) 2010 Robert Kieffer
          Dual licensed under the MIT and GPL licenses.
        */
return e.id="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}),e}addContext(e,t){return e.context=t,e}addParentActivity(e,t){return e.context||(e.context={}),e.context.contextActivities||(e.context.contextActivities={}),e.context.contextActivities.parent||(e.context.contextActivities.parent=[]),e.context.contextActivities.parent.push({objectType:"Activity",id:t}),e}addPeblContextExtensions(e,t,i,n){let s=oe;return e.browserName=s.name,e.browserVersion=s.version,e.osName=s.os.family,e.osVersion=s.os.version,e.contextOrigin=window.location.origin,e.contextUrl=window.location.href,t.currentTeam&&(e.currentTeam=t.currentTeam),t.currentClass&&(e.currentClass=t.currentClass),i&&(e.bookTitle=i),n&&(e.bookId=n),e}addPeblActivity(e,t,i){if(e)return e;if(t){var n=de+t;return i&&(n+="?id="+i),n}return"pebl://deprecated"}addAttachments(e,t){return e.attachments||(e.attachments=t),e}}const ce="",pe="peblThread://user-",ue="peblThread://group-";class he{constructor(e){this.pebl=e,this.xapiGen=new le}newBook(e){let t=e.detail,i=t.book,n=t.bookTitle,s=t.bookId,o=this;this.pebl.storage.getCurrentBook(function(e){e!=i?(e&&o.pebl.emitEvent(o.pebl.events.eventTerminated,{activityURI:e,activityType:"book"}),o.pebl.storage.removeCurrentActivity(),o.pebl.unsubscribeAllEvents(),o.pebl.unsubscribeAllThreads(),o.pebl.storage.saveCurrentBook(i),o.pebl.storage.saveCurrentBookTitle(n),o.pebl.storage.saveCurrentBookId(s)):o.pebl.emitEvent(o.pebl.events.eventJumpPage,{}),o.pebl.emitEvent(o.pebl.events.eventLaunched,{activityType:"book"})})}newBookNoReset(e){let t=e.detail,i=t.book,n=t.bookTitle,s=t.bookId,o=this;this.pebl.storage.getCurrentBook(function(e){e!=i?(e&&o.pebl.emitEvent(o.pebl.events.eventTerminated,e),o.pebl.storage.removeCurrentActivity(),o.pebl.emitEvent(o.pebl.events.eventInteracted,{activity:i,target:i}),o.pebl.storage.saveCurrentBook(i),o.pebl.storage.saveCurrentBookTitle(n),o.pebl.storage.saveCurrentBookId(s)):o.pebl.emitEvent(o.pebl.events.eventJumpPage,{})})}newActivity(e){let t=e.detail,i=this;this.pebl.storage.getCurrentActivity(function(e){t.activity!=e&&(e&&i.pebl.emitEvent(i.pebl.events.eventTerminated,e),i.pebl.emitEvent(i.pebl.events.eventInitialized,{name:t.name,description:t.description})),i.pebl.storage.saveCurrentActivity(t.activity)})}newReference(e){let t=e.detail,i={},n=this,s={docType:t.docType,location:t.location,card:t.card,url:t.url,book:t.book,externalURL:t.externalURL,target:t.target};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(l){if(l){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,l),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,l,a,r)));var c=l.identity==t.target;c?n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#pulled","pulled"):n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#pushed","pushed"),(e||o)&&n.xapiGen.addParentActivity(i,ce+(e||o));let p=new d(i);n.pebl.storage.saveOutgoingXApi(l,{identity:l.identity,id:p.id,requestType:"saveReferences",references:[p]}),n.pebl.storage.saveQueuedReference(l,p),c&&n.pebl.emitEvent(pe+t.target,[p])}})})})})})}newMessage(e){let t=e.detail,i={},n=this,s={access:t.access,type:t.type,replyThread:t.replyThread,groupId:t.groupId,isPrivate:t.isPrivate,book:t.book,idRef:t.idRef,cfi:t.cfi,peblAction:t.peblAction,thread:t.thread};n.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/responded","responded"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.prompt,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addResultResponse(i,t.text,!0,t.duration,t.additionalResultData?n.xapiGen.addExtensions(t.additionalResultData):void 0),n.xapiGen.addActorAccount(i,e);let l=new h(i),c=JSON.parse(JSON.stringify(l));n.pebl.storage.saveMessages(e,l),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveThreadedMessage",message:c}),n.pebl.emitEvent(l.thread,[l])})})})})})}reportedMessage(e){let t=e.detail;t.message=new h(t.message),this.pebl.user.getUser(e=>{if(e){let i=JSON.parse(JSON.stringify(t.message));this.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:t.message.id,requestType:"reportThreadedMessage",message:i})}})}pinnedMessage(e){let t=e.detail;t.message.pinned=!0,t.message=new h(t.message);let i=this;i.pebl.user.getUser(function(e){if(e){let n=JSON.parse(JSON.stringify(t.message));i.pebl.storage.saveMessages(e,[t.message]),i.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:t.message.id,requestType:"pinThreadedMessage",message:n})}})}unpinnedMessage(e){let t=e.detail;t.message.pinned=!1,t.message=new h(t.message);let i=this;i.pebl.user.getUser(function(e){if(e){let n=JSON.parse(JSON.stringify(t.message));i.pebl.storage.saveMessages(e,[t.message]),i.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:t.message.id,requestType:"unpinThreadedMessage",message:n})}})}eventNoted(e){let t=e.detail,i={},n=this,s={access:t.access,type:t.type,isPrivate:t.isPrivate,book:t.book,idRef:t.idRef,cfi:t.cfi,peblAction:t.peblAction,thread:t.thread};n.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/noted","noted"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.prompt,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addResultResponse(i,t.text,!0,t.duration,t.additionalResultData?n.xapiGen.addExtensions(t.additionalResultData):void 0),n.xapiGen.addActorAccount(i,e);let l=new h(i),c=JSON.parse(JSON.stringify(l));n.pebl.storage.saveMessages(e,l),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveThreadedMessage",message:c}),n.pebl.emitEvent(l.thread,[l])})})})})})}removedMessage(e){let t=e.detail;t.message=new h(t.message);let i={},n=this,s={groupId:t.message.groupId,isPrivate:t.message.isPrivate,thread:t.message.thread,messageId:t.message.id};n.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#removed","removed"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.message.prompt,t.message.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addActorAccount(i,e);let l=JSON.parse(JSON.stringify(t.message));n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:t.message.id,requestType:"deleteThreadedMessage",message:l}),n.pebl.storage.removeMessage(e,t.message.id)})})})})})}newLearnlet(e){let t={},i=this;this.pebl.user.getUser(function(e){e&&i.pebl.storage.getCurrentActivity(function(n){i.pebl.storage.getCurrentBook(function(n){let s=new O(t);i.pebl.storage.saveOutgoingActivity(e,{identity:e.identity,id:s.id,requestType:"saveActivities",activities:[s]})})})})}saveProgram(e){let t=e.detail,i=e.detail,n={},s=this;this.pebl.user.getUser(function(e){if(e){let o={role:"owner",activityType:"program"};s.pebl.storage.getCurrentActivity(function(a){s.pebl.storage.getCurrentBook(function(r){if(j.isNew(i)){s.xapiGen.addId(n),s.xapiGen.addTimestamp(n),s.xapiGen.addActorAccount(n,e),s.xapiGen.addObject(n,pe+e.identity,i.id,i.programShortDescription,s.xapiGen.addPeblActivity(void 0,t.activityType,void 0),s.xapiGen.addExtensions(o)),s.xapiGen.addVerb(n,"http://www.peblproject.com/definitions.html#joined","joined"),(r||a)&&s.xapiGen.addParentActivity(n,ce+(r||a));let d=new m(n);i.addMember(d),s.pebl.storage.saveGroupMembership(e,d),s.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveMemberships",memberships:[d]})}s.pebl.storage.saveOutgoingActivity(e,{identity:e.identity,id:i.id,requestType:"saveActivities",activities:[i]}),s.pebl.storage.saveActivity(e,i),s.pebl.emitEvent(s.pebl.events.incomingProgram,[i])})})}})}saveInstitution(e){let t=e.detail,i=new B(e.detail),n={},s=this;this.pebl.user.getUser(function(e){if(e){let o={role:"owner",activityType:"institution"};s.pebl.storage.getCurrentActivity(function(a){s.pebl.storage.getCurrentBook(function(r){if(B.isNew(i)){s.xapiGen.addId(n),s.xapiGen.addTimestamp(n),s.xapiGen.addActorAccount(n,e),s.xapiGen.addObject(n,pe+e.identity,i.id,i.description,s.xapiGen.addPeblActivity(void 0,t.activityType,void 0),s.xapiGen.addExtensions(o)),s.xapiGen.addVerb(n,"http://www.peblproject.com/definitions.html#joined","joined"),(r||a)&&s.xapiGen.addParentActivity(n,ce+(r||a));let d=new m(n);i.addMember(d),s.pebl.storage.saveGroupMembership(e,d),s.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveMemberships",memberships:[d]})}s.pebl.storage.saveOutgoingActivity(e,{identity:e.identity,id:i.id,requestType:"saveActivities",activities:[i]}),s.pebl.storage.saveActivity(e,i),s.pebl.emitEvent(s.pebl.events.incomingInstitition,[i])})})}})}saveSystem(e){let t=e.detail,i=new U(e.detail),n={},s=this;this.pebl.user.getUser(function(e){if(e){let o={role:"owner",activityType:"system"};s.pebl.storage.getCurrentActivity(function(a){s.pebl.storage.getCurrentBook(function(r){if(U.isNew(i)){s.xapiGen.addId(n),s.xapiGen.addTimestamp(n),s.xapiGen.addActorAccount(n,e),s.xapiGen.addObject(n,pe+e.identity,i.id,i.description,s.xapiGen.addPeblActivity(void 0,t.activityType,void 0),s.xapiGen.addExtensions(o)),s.xapiGen.addVerb(n,"http://www.peblproject.com/definitions.html#joined","joined"),(r||a)&&s.xapiGen.addParentActivity(n,ce+(r||a));let d=new m(n);i.addMember(d),s.pebl.storage.saveGroupMembership(e,d),s.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveMemberships",memberships:[d]})}s.pebl.storage.saveOutgoingActivity(e,{identity:e.identity,id:i.id,requestType:"saveActivities",activities:[i]}),s.pebl.storage.saveActivity(e,i),s.pebl.emitEvent(s.pebl.events.incomingSystem,[i])})})}})}newMembership(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){if(e){let s={role:t.role,activityType:t.activityType,organization:t.organization,organizationName:t.organizationName};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,pe+t.thread,t.groupId,t.groupDescription,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s)),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#joined","joined"),(a||o)&&n.xapiGen.addParentActivity(i,ce+(a||o));let r=new m(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:r.id,requestType:"saveMemberships",memberships:[r]}),n.pebl.emitEvent(n.pebl.events.incomingMembership,[r]),t.thread==e.identity&&n.pebl.storage.saveGroupMembership(e,r)})})}})}modifiedMembership(e){let t=e.detail,i=t.oldMembership,n=t.newMembership,s={},o={id:""},a=this;this.pebl.user.getUser(function(e){if(e){let r=new E({identity:i.actor.account.name,name:i.actor.name,homePage:i.actor.account.homePage,preferredName:i.actor.name});a.xapiGen.addId(s),a.xapiGen.addVerb(s,"http://adlnet.gov/expapi/verbs/voided","voided"),a.xapiGen.addTimestamp(s),a.xapiGen.addStatementRef(s,i.id),a.xapiGen.addActorAccount(s,r),a.xapiGen.addParentActivity(s,ce+i.id);let d=new g(s);if(a.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,xId:i.id,requestType:"deleteMembership"}),r.identity===e.identity&&a.pebl.storage.removeGroupMembership(r,i.id),a.pebl.emitEvent(a.pebl.events.incomingMembership,[d]),n){let i={role:n.role,activityType:n.activityType,organization:n.organization,organizationName:n.organizationName};a.pebl.storage.getCurrentActivity(function(s){a.pebl.storage.getCurrentBook(function(d){o.id=n.id,a.xapiGen.addTimestamp(o),a.xapiGen.addActorAccount(o,r),a.xapiGen.addObject(o,pe+r.identity,n.membershipId,n.groupDescription,a.xapiGen.addPeblActivity(void 0,t.activityType,void 0),a.xapiGen.addExtensions(i)),a.xapiGen.addVerb(o,"http://www.peblproject.com/definitions.html#joined","joined"),(d||s)&&a.xapiGen.addParentActivity(o,ce+(d||s));let l=new m(o);a.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveMemberships",memberships:[l]}),a.pebl.emitEvent(a.pebl.events.incomingMembership,[l]),r.identity===e.identity&&a.pebl.storage.saveGroupMembership(e,l)})})}}})}removedMembership(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(s){n.pebl.storage.getCurrentBook(function(s){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/voided","voided"),n.xapiGen.addTimestamp(i),n.xapiGen.addStatementRef(i,t),n.xapiGen.addActorAccount(i,e),n.xapiGen.addParentActivity(i,ce+t);let o=new g(i);n.pebl.storage.removeGroupMembership(e,t),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,xId:t,requestType:"deleteMembership"}),n.pebl.emitEvent(n.pebl.events.incomingMembership,[o])})})})}newAnnotation(e){let t=e.detail,i={},n=this;n.pebl.user.getUser(function(e){if(e){let s={type:t.type,cfi:t.cfi,idRef:t.idRef,style:t.style};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/commented","commented"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,ce+a,t.title,t.text,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addActorAccount(i,e);let c=new l(i);n.pebl.storage.saveAnnotations(e,c),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:c.id,requestType:"saveAnnotations",stmts:[c]}),n.pebl.emitEvent(n.pebl.events.incomingAnnotations,[c])})})})})}})}eventBookmarked(e){let t=e.detail,i={},n=this;n.pebl.user.getUser(function(e){if(e){let s={type:t.type,cfi:t.cfi,idRef:t.idRef,style:t.style};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#bookmarked","bookmarked"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,ce+a,t.title,t.text,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addActorAccount(i,e);let c=new l(i);n.pebl.storage.saveAnnotations(e,c),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:c.id,requestType:"saveAnnotations",stmts:[c]}),n.pebl.emitEvent(n.pebl.events.incomingAnnotations,[c])})})})})}})}eventUnbookmarked(e){let t=e.detail,i={},n=this,s={idref:t.idref,cfi:t.cfi};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+o,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#unbookmarked","unbookmarked"),n.xapiGen.addParentActivity(i,ce+e);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventAnnotated(e){let t=e.detail,i={},n=this;n.pebl.user.getUser(function(e){if(e){let s={type:t.type,cfi:t.cfi,idRef:t.idRef,style:t.style};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#annotated","annotated"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.title,t.text,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addActorAccount(i,e);let c=new l(i);n.pebl.storage.saveAnnotations(e,c),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:c.id,requestType:"saveAnnotations",stmts:[c]}),n.pebl.emitEvent(n.pebl.events.incomingAnnotations,[c])})})})})}})}newSharedAnnotation(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){if(e){let s={type:t.type,cfi:t.cfi,idRef:t.idRef,style:t.style,groupId:t.groupId};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addParentActivity(i,ce+(o||a)),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/shared","shared"),n.xapiGen.addTimestamp(i),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.title,t.text,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addActorAccount(i,e);let l=new c(i);n.pebl.storage.saveSharedAnnotations(e,l),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveSharedAnnotations",stmts:[l]}),n.pebl.emitEvent(n.pebl.events.incomingSharedAnnotations,[l])})})})})}})}pinnedAnnotation(e){let t=e.detail;t.pinned=!0;let i=this;this.pebl.user.getUser(function(e){if(e){let n=JSON.parse(JSON.stringify(t));i.pebl.storage.saveSharedAnnotations(e,[t]),i.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:n.id,requestType:"pinSharedAnnotation",annotation:n})}})}unpinnedAnnotation(e){let t=e.detail;t.pinned=!1;let i=this;this.pebl.user.getUser(function(e){if(e){let n=JSON.parse(JSON.stringify(t));i.pebl.storage.saveSharedAnnotations(e,[t]),i.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:n.id,requestType:"unpinSharedAnnotation",annotation:n})}})}eventUnsharedAnnotation(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){if(e){let s={cfi:t.cfi,idRef:t.idRef};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#unshared","unshared"),n.xapiGen.addParentActivity(i,ce+o);let d=new p(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(e,d)})})})})}})}eventUnannotated(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){if(e){let s={cfi:t.cfi,idRef:t.idRef};n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#unannotated","unannotated"),n.xapiGen.addParentActivity(i,ce+o);let d=new p(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(e,d)})})})})}})}removedAnnotation(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(s){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(a){s?n.xapiGen.addParentActivity(i,ce+s):n.xapiGen.addParentActivity(i,ce+o),n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/voided","voided"),n.xapiGen.addTimestamp(i),n.xapiGen.addStatementRef(i,t),n.xapiGen.addActorAccount(i,e);let r=new g(i);n.pebl.storage.removeAnnotation(e,t),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:r.id,xId:t,requestType:"deleteAnnotation"}),n.pebl.emitEvent(n.pebl.events.incomingAnnotations,[r])})})})})})}removedSharedAnnotation(e){let t=e.detail,i={},n=this;n.pebl.user.getUser(function(e){e&&(n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/voided","voided"),n.xapiGen.addTimestamp(i),n.pebl.storage.getCurrentActivity(function(s){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(a){s?n.xapiGen.addParentActivity(i,ce+s):n.xapiGen.addParentActivity(i,ce+o),n.xapiGen.addStatementRef(i,t.id),n.xapiGen.addActorAccount(i,e);let r=new g(i);n.pebl.storage.removeSharedAnnotation(e,t.id),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:t.id,annotation:t,requestType:"deleteSharedAnnotation"}),n.pebl.emitEvent(n.pebl.events.incomingSharedAnnotations,[r])})})})}))})}eventLoggedIn(e){let t=new E(e.detail),i=this;this.pebl.user.getUser(function(e){i.pebl.storage.saveUserProfile(t,function(){i.pebl.network.activate(()=>{e&&e.identity===t.identity&&e.currentTeam===t.currentTeam&&e.currentClass===t.currentClass||i.pebl.emitEvent(i.pebl.events.eventLogin,{userProfile:t,activityType:"login"})})})})}eventLoggedOut(e){let t=this;this.pebl.user.getUser(function(e){t.pebl.network.disable(function(){t.pebl.storage.removeCurrentUser(()=>{t.pebl.emitEvent(t.pebl.events.eventLogout,{userProfile:e,activityType:"login"})})})})}eventSessionStart(e){let t=e.detail,i={},n=this,s={};this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ce+a,void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#entered","entered"),(a||o)&&n.xapiGen.addParentActivity(i,ce+(a||o));let l=new f(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveSessions",sessions:[l]}),n.pebl.storage.saveEvent(e,l)})})})})})}eventSessionStop(e){let t=e.detail,i={},n=this,s={};this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ce+a,void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#exited","exited"),(a||o)&&n.xapiGen.addParentActivity(i,ce+(a||o));let l=new f(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveSessions",sessions:[l]}),n.pebl.storage.saveEvent(e,l)})})})})})}eventLaunched(e){let t=e.detail,i={},n=this,s={};this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBook(function(a){n.pebl.storage.getCurrentBookTitle(function(r){n.pebl.storage.getCurrentBookId(function(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ce+a,void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,r,d))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#launched","launched"),(a||o)&&n.xapiGen.addParentActivity(i,ce+(a||o));let l=new f(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:l.id,requestType:"saveSessions",sessions:[l]}),n.pebl.storage.saveEvent(e,l)})})})})})}eventTerminated(e){let t=e.detail,i={},n=this,s={};this.pebl.user.getUser(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){if(e){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,a,r))),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/terminated","terminated"),o&&n.xapiGen.addParentActivity(i,o);let d=new f(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveSessions",sessions:[d]}),n.pebl.storage.saveEvent(e,d)}})})})})}eventInitialized(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r&&e){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/initialized","initialized"),n.xapiGen.addParentActivity(i,ce+t.activity);let d=new f(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveSessions",sessions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})}eventInteracted(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.user.getUser(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){if(e){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,o,a))),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/interacted","interacted"),n.xapiGen.addParentActivity(i,ce+t.activity);let r=new p(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:r.id,requestType:"saveActions",actions:[r]}),n.pebl.storage.saveEvent(e,r)}})})})}eventJumpPage(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.storage.getCurrentActivity(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#paged-jump","paged-jump"),r&&n.xapiGen.addParentActivity(i,ce+r);let l=new u(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveNavigations",navigations:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventAttempted(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObjectInteraction(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.prompt,"choice",t.answers,t.correctAnswers,n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addResult(i,t.score,t.minScore,t.maxScore,t.complete,t.success,t.answered),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#attempted","attempted"),n.xapiGen.addParentActivity(i,ce+(e||o));let l=new b(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveQuestions",questions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventPassed(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addResult(i,t.score,t.minScore,t.maxScore,t.complete,t.success),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/passed","passed"),n.xapiGen.addParentActivity(i,ce+(e||o));let l=new v(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveQuizes",quizes:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventFailed(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addResult(i,t.score,t.minScore,t.maxScore,t.complete,t.success),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/failed","failed"),n.xapiGen.addParentActivity(i,ce+(e||o));let l=new v(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveQuizes",quizes:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventPreferred(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/preferred","preferred"),n.xapiGen.addParentActivity(i,ce+(e||o));let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventUploadedMedia(e){let t=e.detail,i={},n=this,s={target:t.mediaId};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#uploaded","uploaded"),n.xapiGen.addParentActivity(i,ce+(e||o)),n.xapiGen.addAttachments(i,t.attachments);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventContentMorphed(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#morphed","morphed"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventExperienced(e){let t=e.detail,i={},n=this,s={idref:t.idref,cfi:t.cfi,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#experienced","experienced"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventDisliked(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#disliked","disliked"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventLiked(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#liked","liked"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventAccessed(e){let t=e.detail,i={},n=this,s={idref:t.idref,cfi:t.cfi,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#accessed","accessed"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventSubmitted(e){let t=e.detail,i={},n=this,s={idref:t.idref,cfi:t.cfi,target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#submitted","submitted"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventHid(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#hid","hid"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventShowed(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#showed","showed"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventDisplayed(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#displayed","displayed"),n.xapiGen.addParentActivity(i,ce+e);let d=new p(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveActions",actions:[d]}),n.pebl.storage.saveEvent(r,d)}})})})})})}eventUndisplayed(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+o,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#undisplayed","undisplayed"),n.xapiGen.addParentActivity(i,ce+e);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventSearched(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+o,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#searched","searched"),n.xapiGen.addParentActivity(i,ce+e);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventSelected(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+o,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#selected","selected"),n.xapiGen.addParentActivity(i,ce+e);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventDiscarded(e){let t=e.detail,i={},n=this,s={target:t.target,type:t.type};this.pebl.storage.getCurrentActivity(function(e){n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+o,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,a,r))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#discarded","discarded"),n.xapiGen.addParentActivity(i,ce+e);let l=new p(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveActions",actions:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventNextPage(e){let t=e.detail,i={},n=this,s={firstCfi:t.firstCfi,lastCfi:t.lastCfi};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.storage.getCurrentActivity(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#paged-next","paged-next"),r&&n.xapiGen.addParentActivity(i,ce+r);let l=new u(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveNavigations",navigations:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventPrevPage(e){let t=e.detail,i={},n=this,s={firstCfi:t.firstCfi,lastCfi:t.lastCfi};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.storage.getCurrentActivity(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#paged-prev","paged-prev"),r&&n.xapiGen.addParentActivity(i,ce+r);let l=new u(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveNavigations",navigations:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventCompleted(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.storage.getCurrentActivity(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,o,a))),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/completed","completed"),r&&n.xapiGen.addParentActivity(i,ce+r);let l=new u(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveNavigations",navigations:[l]}),n.pebl.storage.saveEvent(d,l)}})})})})})}eventCompatibilityTested(e){let t=e.detail,i={},n=this,s={readerName:t.readerName,osName:t.osName,osVersion:t.osVersion,browserName:t.browserName,browserVersion:t.browserVersion,userAgent:t.userAgent,appVersion:t.appVersion,platform:t.platform,vendor:t.vendor,testResults:t.testResults};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(o){n.pebl.storage.getCurrentBookId(function(a){n.pebl.storage.getCurrentActivity(function(r){n.pebl.user.getUser(function(d){if(d){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,d),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,d,o,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#compatibilityTested","compatibilityTested"),r&&n.xapiGen.addParentActivity(i,ce+r);let l=new w(i);n.pebl.storage.saveOutgoingXApi(d,{identity:d.identity,id:l.id,requestType:"saveCompatibilityTests",tests:[l]})}})})})})})}eventChecklisted(e){}eventHelped(e){let t=e.detail,i={},n=this,s={};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.user.getUser(function(a){if(a){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,a),n.xapiGen.addObject(i,ce+e,t.name,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,a))),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#helped","helped"),o&&n.xapiGen.addParentActivity(i,ce+o);let r=new u(i);n.pebl.storage.saveOutgoingXApi(a,{identity:a.identity,id:r.id,requestType:"saveNavigations",navigations:[r]}),n.pebl.storage.saveEvent(a,r)}})})})}eventInvited(e){let t=e.detail,i={},n=this,s={programId:t.programId,programRole:t.programRole};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(e){n.pebl.user.getUser(function(o){if(o){n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,o),n.xapiGen.addObject(i,ce+"Harness",t.token,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s)),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#invited","invited"),e&&n.xapiGen.addParentActivity(i,ce+e);let a=new y(i);n.pebl.storage.saveOutgoingXApi(o,{identity:o.identity,id:a.id,requestType:"saveInvites",invites:[a]})}})})})}eventUninvited(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(s){n.pebl.storage.getCurrentBook(function(s){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/voided","voided"),n.xapiGen.addTimestamp(i),n.xapiGen.addStatementRef(i,t),n.xapiGen.addActorAccount(i,e),n.xapiGen.addParentActivity(i,ce+"Harness");let o=new g(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,xId:t,requestType:"deleteInvite"})})})})}eventProgramLevelUp(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programLevelUp","programLevelUp"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramLevelDown(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programLevelDown","programLevelDown"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramInvited(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programInvited","programInvited"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramUninvited(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programUninvited","programUninvited"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramJoined(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programJoined","programJoined"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramExpelled(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programExpelled","programExpelled"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramActivityLaunched(e){let t=e.detail,i={},n=this,s={newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programActivityLaunched","programActivityLaunched"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramActivityCompleted(e){let t=e.detail,i={},n=this,s={newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programActivityCompleted","programActivityCompleted"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramActivityTeamCompleted(e){let t=e.detail,i={},n=this,s={newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programActivityTeamCompleted","programActivityTeamCompleted"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramModified(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programModified","programModified"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramDeleted(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programDeleted","programDeleted"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramCompleted(e){let t=e.detail,i={},n=this,s={action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programCompleted","programCompleted"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramCopied(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programCopied","programCopied"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventProgramDiscussed(e){let t=e.detail,i={},n=this,s={previousValue:t.previousValue,newValue:t.newValue,action:t.action};this.pebl.user.getUser(function(e){if(e){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#programDiscussed","programDiscussed"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,e),n.xapiGen.addObject(i,ue+t.programId,t.programId,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s));let o=new x(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:o.id,requestType:"saveActivityEvents",events:[o]})}})}eventLogin(e){let t=e.detail,i=t.userProfile,n={},s=this,o={};this.pebl.storage.saveCurrentUser(i,function(){i&&(s.xapiGen.addId(n),s.xapiGen.addTimestamp(n),s.xapiGen.addVerb(n,"http://adlnet.gov/expapi/verbs/logged-in","logged-in"),s.pebl.storage.getCurrentBook(function(e){s.pebl.storage.getCurrentBookTitle(function(a){s.pebl.storage.getCurrentBookId(function(r){e?s.xapiGen.addObject(n,ce+e,void 0,void 0,s.xapiGen.addPeblActivity(void 0,t.activityType,void 0),s.xapiGen.addExtensions(s.xapiGen.addPeblContextExtensions(o,i,a,r))):s.xapiGen.addObject(n,window.location.origin,void 0,void 0,s.xapiGen.addPeblActivity(void 0,t.activityType,void 0),s.xapiGen.addExtensions(s.xapiGen.addPeblContextExtensions(o,i))),s.xapiGen.addActorAccount(n,i);let d=new f(n);s.pebl.storage.saveEvent(i,d),s.pebl.storage.saveOutgoingXApi(i,{identity:i.identity,id:d.id,requestType:"saveSessions",sessions:[d]})})})}))})}eventLogout(e){let t=e.detail,i={},n=this,s={};n.pebl.user.getUser(function(e){e&&(n.xapiGen.addId(i),n.xapiGen.addTimestamp(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/logged-out","logged-out"),n.pebl.storage.getCurrentBook(function(o){n.pebl.storage.getCurrentBookTitle(function(a){n.pebl.storage.getCurrentBookId(function(r){o?n.xapiGen.addObject(i,ce+o,void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e,a,r))):n.xapiGen.addObject(i,window.location.origin,void 0,void 0,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,e))),n.xapiGen.addActorAccount(i,e);let d=new f(i);n.pebl.storage.saveEvent(e,d),n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:d.id,requestType:"saveSessions",sessions:[d]})})})}))})}eventModuleRating(e){let t=e.detail,i={},n=this,s={idref:t.idref,programId:t.programId};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.user.getUser(function(a){if(a){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#moduleRating","moduleRating"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,a),n.xapiGen.addObject(i,ce+e,t.rating,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,a))),o&&n.xapiGen.addParentActivity(i,ce+o);let r=new k(i);n.pebl.storage.saveOutgoingXApi(a,{identity:a.identity,id:r.id,requestType:"saveModuleEvents",events:[r]})}})})})}eventModuleFeedback(e){let t=e.detail,i={},n=this,s={willingToDiscuss:t.willingToDiscuss,idref:t.idref,programId:t.programId};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentBookTitle(function(e){n.pebl.storage.getCurrentBookId(function(o){n.pebl.storage.getCurrentActivity(function(a){n.pebl.user.getUser(function(r){if(r){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#moduleFeedback","moduleFeedback"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,r),n.xapiGen.addObject(i,n.xapiGen.addPeblActivity(t.activityURI,t.activityType,t.activityId),t.feedback,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,r,e,o))),a&&n.xapiGen.addParentActivity(i,ce+a);let d=new _(i);n.pebl.storage.saveOutgoingXApi(r,{identity:r.identity,id:d.id,requestType:"saveModuleEvents",events:[d]})}})})})})})}eventModuleExample(e){let t=e.detail,i={},n=this,s={idref:t.idref,youtubeUrl:t.youtubeUrl,imageUrl:t.imageUrl,websiteUrl:t.websiteUrl,quotedPerson:t.quotedPerson,quotedTeam:t.quotedTeam};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.user.getUser(function(a){if(a){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#moduleExample","moduleExample"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,a),n.xapiGen.addObject(i,ce+e,t.example,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(n.xapiGen.addPeblContextExtensions(s,a))),o&&n.xapiGen.addParentActivity(i,ce+o);let r=new G(i);n.pebl.storage.saveOutgoingXApi(a,{identity:a.identity,id:r.id,requestType:"saveModuleEvents",events:[r]}),n.pebl.emitEvent(n.pebl.events.incomingModuleEvents,[r])}})})})}eventModuleExampleRating(e){let t=e.detail,i={},n=this,s={idref:t.idref,programId:t.programId,exampleId:t.exampleId};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.user.getUser(function(a){if(a){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#moduleExampleRating","moduleExampleRating"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,a),n.xapiGen.addObject(i,ce+e,t.rating,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s)),o&&n.xapiGen.addParentActivity(i,ce+o);let r=new T(i);n.pebl.storage.saveOutgoingXApi(a,{identity:a.identity,id:r.id,requestType:"saveModuleEvents",events:[r]})}})})})}eventModuleExampleFeedback(e){let t=e.detail,i={},n=this,s={willingToDiscuss:t.willingToDiscuss,idref:t.idref,programId:t.programId,exampleId:t.exampleId};this.pebl.storage.getCurrentBook(function(e){n.pebl.storage.getCurrentActivity(function(o){n.pebl.user.getUser(function(a){if(a){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://www.peblproject.com/definitions.html#moduleExampleFeedback","moduleExampleFeedback"),n.xapiGen.addTimestamp(i),n.xapiGen.addActorAccount(i,a),n.xapiGen.addObject(i,ce+e,t.feedback,t.description,n.xapiGen.addPeblActivity(void 0,t.activityType,void 0),n.xapiGen.addExtensions(s)),o&&n.xapiGen.addParentActivity(i,ce+o);let r=new S(i);n.pebl.storage.saveOutgoingXApi(a,{identity:a.identity,id:r.id,requestType:"saveModuleEvents",events:[r]})}})})})}moduleRemovedEvent(e){let t=e.detail,i={},n=this;this.pebl.user.getUser(function(e){e&&n.pebl.storage.getCurrentActivity(function(s){n.pebl.storage.getCurrentBook(function(o){n.xapiGen.addId(i),n.xapiGen.addVerb(i,"http://adlnet.gov/expapi/verbs/voided","voided"),n.xapiGen.addTimestamp(i),n.xapiGen.addStatementRef(i,t.eventId),n.xapiGen.addActorAccount(i,e),s&&n.xapiGen.addParentActivity(i,ce+s);let a=new g(i);n.pebl.storage.saveOutgoingXApi(e,{identity:e.identity,id:a.id,xId:t.eventId,requestType:"deleteModuleEvent"})})})})}incomingModuleEvents(e){let t=this,i=e.detail;for(let e of i)"moduleRemovedEvent"===e.verb.display["en-US"]&&t.pebl.storage.removeModuleEvent(e.idref,e.eventId)}}const ge="_user-",be="_group-";i.d(t,"install",function(){return fe});let ve=new class{constructor(e,t){this.firedEvents=[],this.subscribedEventHandlers={},this.subscribedSingularEventHandlers={},this.subscribedThreadHandlers={},this.loaded=!1,this.extension={},this.config=e,e?(this.teacher=e.teacher,this.enableDirectMessages=e.enableDirectMessages,this.useIndexedDB=e.useIndexedDB):(this.teacher=!1,this.enableDirectMessages=!0,this.useIndexedDB=!0),this.utils=new ae(this),this.eventHandlers=new he(this),this.events=new se,this.user=new H(this),this.network=new ne(this);let i=this;this.storage=new F(this,function(){i.loaded=!0,i.addSystemEventListeners(),t&&t(i),i.processQueuedEvents()})}addListener(e,t){document.removeEventListener(e,t),document.addEventListener(e,t)}addSystemEventListeners(){let e=Object.keys(this.events);for(let t of e){let e=this.eventHandlers[t];if(e){let i=e.bind(this.eventHandlers);this.addListener(t,i)}}}processQueuedEvents(){for(let e of this.firedEvents)document.dispatchEvent(e);this.firedEvents=[]}unsubscribeAllEvents(){for(let e of Object.keys(this.subscribedEventHandlers)){for(let t of this.subscribedEventHandlers[e])document.removeEventListener(e,t.modifiedFn);delete this.subscribedEventHandlers[e]}for(let e of Object.keys(this.subscribedSingularEventHandlers)){for(let t of Object.keys(this.subscribedSingularEventHandlers[e]))document.removeEventListener(e,this.subscribedSingularEventHandlers[e][t].modifiedFn);delete this.subscribedSingularEventHandlers[e]}}unsubscribeAllThreads(){for(let e of Object.keys(this.subscribedEventHandlers)){for(let t of this.subscribedEventHandlers[e])document.removeEventListener(e,t.modifiedFn);delete this.subscribedEventHandlers[e]}}unsubscribeEvent(e,t,i){let n=0;if(this.subscribedEventHandlers[e])for(let s of this.subscribedEventHandlers[e]){if(s.once==t&&s.fn==i)return document.removeEventListener(e,s.modifiedFn),void this.subscribedEventHandlers[e].splice(n,1);n++}}unsubscribeSingularEvent(e,t){this.subscribedSingularEventHandlers[e]&&this.subscribedSingularEventHandlers[e][t]&&(document.removeEventListener(e,this.subscribedSingularEventHandlers[e][t].modifiedFn),delete this.subscribedSingularEventHandlers[e][t])}unsubscribeThread(e,t,i,n){this.user.getUser(s=>{if(s){let o=e;n&&n.groupId?o=e+be+n.groupId:n&&n.isPrivate&&(o=e+ge+s.identity);let a={id:this.utils.getUuid(),identity:s.identity,requestType:"unsubscribeThread",thread:e,options:n};this.storage.saveOutgoingXApi(s,a);let r=0;if(this.subscribedThreadHandlers[o])for(let e of this.subscribedThreadHandlers[o]){if(e.once==t&&e.fn==i)return document.removeEventListener(o,e.modifiedFn),void this.subscribedThreadHandlers[o].splice(r,1);r++}}})}subscribeEvent(e,t,i){this.subscribedEventHandlers[e]||(this.subscribedEventHandlers[e]=[]);let n=this;if(t){var s=function(s){n.unsubscribeEvent(e,t,i),i(s.detail)};document.addEventListener(e,s,{once:t}),this.subscribedEventHandlers[e].push({once:t,fn:i,modifiedFn:s})}else s=function(e){i(e.detail)},document.addEventListener(e,s),this.subscribedEventHandlers[e].push({once:t,fn:i,modifiedFn:s});e==n.events.incomingAnnotations?n.utils.getAnnotations(function(e){i(e)}):e==n.events.incomingSharedAnnotations?n.utils.getSharedAnnotations(function(e){i(e)}):e==n.events.incomingPresence?n.network.retrievePresence():e==n.events.incomingProgram?n.utils.getPrograms(function(e){i(e)}):e==n.events.incomingMembership&&n.utils.getGroupMemberships(function(e){i(e)})}subscribeSingularEvent(e,t,i,n){this.unsubscribeSingularEvent(e,t),this.subscribedSingularEventHandlers[e]||(this.subscribedSingularEventHandlers[e]={});let s=this;if(i){var o=function(i){s.unsubscribeSingularEvent(e,t),n(i.detail)};document.addEventListener(e,o,{once:i}),this.subscribedSingularEventHandlers[e][t]={once:i,fn:n,modifiedFn:o}}else o=function(e){n(e.detail)},document.addEventListener(e,o),this.subscribedSingularEventHandlers[e][t]={once:i,fn:n,modifiedFn:o};e==s.events.incomingAnnotations?s.utils.getAnnotations(function(e){n(e)}):e==s.events.incomingSharedAnnotations?s.utils.getSharedAnnotations(function(e){n(e)}):e==s.events.incomingPresence?s.network.retrievePresence():e==s.events.incomingProgram?s.utils.getPrograms(function(e){n(e)}):e==s.events.incomingMembership&&s.utils.getGroupMemberships(function(e){n(e)})}subscribeThread(e,t,i,n){this.user.getUser(s=>{if(s){let a=e;n&&n.groupId?a=a+be+n.groupId:n&&n.isPrivate&&(a=a+ge+s.identity);let r=!0,d=this.subscribedThreadHandlers[a];if(d?r=!1:(d=[],this.subscribedThreadHandlers[a]=d),t){var o=e=>{this.unsubscribeEvent(a,t,i),i(e.detail)};document.addEventListener(a,o,{once:t}),d.push({once:t,fn:i,modifiedFn:o})}else o=(e=>{i(e.detail)}),document.addEventListener(a,o),d.push({once:t,fn:i,modifiedFn:o});r&&(this.storage.saveOutgoingXApi(s,{id:this.utils.getUuid(),identity:s.identity,requestType:"getThreadedMessages",requests:[{thread:e,options:n||{},timestamp:1}]}),this.storage.saveOutgoingXApi(s,{id:this.utils.getUuid(),identity:s.identity,requestType:"subscribeThread",thread:e,options:n||{}})),this.storage.getMessages(s,a,i)}else i([])})}emitEvent(e,t){let i=document.createEvent("CustomEvent");i.initCustomEvent(e,!0,!0,t),this.loaded?document.dispatchEvent(i):this.firedEvents.push(i)}}(window.PeBLConfig,window.PeBLLoaded);const fe=function(e,t){e.prototype.$PeBL=ve,e.prototype.$PeBLEvents=ve.events,e.prototype.$PeBLUtils=ve.utils,e.prototype.$PeBLUser=ve.user};"undefined"!=typeof window&&(window.PeBL=ve,window.Vue&&window.Vue.use({install:fe}))}]);